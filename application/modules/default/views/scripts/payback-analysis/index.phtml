<?php
//echo "Path : Default_payback-analysis_index";
//User

$sessUser = new Zend_Session_Namespace('user');
//echo $sessUser->user_Id . '--' . $sessUser->email_Id . '--' . $sessUser->fname.'--'.$sessUser->lname ;
// GET PROJECT AND ITS PRODUCTS ARRAY OF VALUES
$objField = new Product_Model_Product();
$ProdGPM = "";
$costSaving = "";
$projInfo = $this->projInfo;

if (!empty($projInfo)) {
    $projectDetail = $projInfo[0];
    $productDetail = $projInfo[1];
} else {
    echo "<div class='container' style='text-align:center;'>No product found under this project</div>";
}

$LOA = $projectDetail['length_analysis'];

$qtyUsesWKInfo = $this->qty_usesWK_Info;
$updated_base_price = $this->updated_base_price;

//print_r($qtyUsesWKInfo);

if (!empty($qtyUsesWKInfo)) {
    foreach ($productDetail as $key => $value) {
        foreach ($qtyUsesWKInfo as $k1 => $v1) {
            if ($value['product_id'] == $v1['product_id']) {
                $value['qty_value'] = $v1['qty_value'];
                $value['uses_wk_value'] = $v1['uses_wk_value'];
                $value['prod_updated_price'] = $v1['price'];
                $productDetail[$key] = $value;
            }
        }
    }
}

//ECHO "<pre>"; print_r($updated_base_price); die;
if (!empty($updated_base_price)) {
    foreach ($productDetail as $key => $value) {
        foreach ($updated_base_price as $k2 => $v2) {
            if ($value['product_id'] == $v2['product_id']) {
                $value['base_updated_price'] = $v2['price'];
                if ($v2['sub_name'] != "") {
                    $subatt_names = explode(',', $v2['sub_name']);
                    $subatt_value = explode(',', $v2['value']);
                    for ($ii = 0; $ii < count($subatt_names); $ii++) {
                        $value["Base_updated_" . $subatt_names[$ii]] = $subatt_value[$ii];
                    }
                }

                $productDetail[$key] = $value;
            }
        }
    }
}


foreach ($productDetail as $key => $value) {
    if (!empty($value['baseline_id'])) {
        $res = $objField->fetchProductInfoById($value['baseline_id']);
        $value['baseline_info'] = $res;
        $productDetail[$key] = $value;
    }
}

/////////////////////////////////////---------------- PLANET/HUMAN HEALT CALC VARIABLES----------////////////////////

$totalHumanYes = $this->totalHumanYes;
$totalHumanNo = $this->totalHumanNo;
$totalPlanetYes = $this->totalPlanetYes;
$totalPlanetNo = $this->totalPlanetNo;

//BASE PRICES
$BasePrices = $this->BasePrices;

function setSubattWithProd($subName, $productDetail, $calcHolder, $arrKey) {
    //echo "<pre>";print_r($subName);
    if (!empty($subName)) {
        foreach ($productDetail as $key => $value) {
            foreach ($subName as $subatt)
                if ($value['product_id'] == $subatt['product_id']) {

                    $value[$arrKey] = $subatt[$calcHolder];
                    $productDetail[$key] = $value;
                }
        }
    }
    return $productDetail;
}

///////////////////////////////////////////////////////////////////////////
// Water variables
$CumulativeGPM = array();
$CumulativeCost = array();
$CumulativeBaseGPM = array();

// Energy Variables
$CumulativeEnergyCost = array();
$CumulativeEnergy = array();

// Carbon Variables
$CumulativeEnergyCostCarbon = array();
$CumulativeEnergyCarbon = array();

// Life Cycle Variables
$prodMonthCost = array();
$baseMonthCost = array();
$CumulativeLifeCycleCost = array();
$CumulativeLifeCycle = array();

//Define Leed Output
/////////LEED NC 2009 - New Construction/////////
$LEED_NC_2009_WEp1OP_TOTAL = '-'; //Contributes  		1
$LEED_NC_2009_WEc3OP_TOTAL = '-'; //Contributes 		2
/////////LEED CI 2009 - Commercial Interiors/////
$LEED_CI_2009_WEp1OP_TOTAL = '-'; //Contributes 		8
$LEED_CI_2009_WEc1OP_TOTAL = '-'; //Contributes  		9
/////////LEED EBOM 2009 - Existing Building Operations////////
$LEED_EBOM_2009_WEp1OP_TOTAL = '-'; //Contributes		15
$LEED_EBOM_2009_WEc2OP_TOTAL = '-'; //Contributes		16
/////////LEED CS 2009 - Core & Shell///////////
$LEED_CS_2009_WEp1OP_TOTAL = '-'; //Contributes			18
$LEED_CS_2009_WEc2OP_TOTAL = '-'; //Contributes			19
/////////LEED Schools 2009 - Schools/////
$LEED_Schools_2009_WEp1OP_TOTAL = '-'; //Contributes	24
$LEED_Schools_2009_WEc3OP_TOTAL = '-'; //Contributes	25
/////////LEED Healthcare 2009 - Healthcare/////
$LEED_HC_2009_WEp1OP_TOTAL = '-'; //Contributes			32
$LEED_HC_2009_WEc3OP_TOTAL = '-'; //Contributes			33
/////////LEED NC v4 - New Construction/////
$LEED_NC_v4_WEp2OP_TOTAL = '-'; //Contributes			36
$LEED_NC_v4_WEc2OP_TOTAL = '-'; //Contributes			37
/////////LEED CI v4 - Commercial Interiors/////
$LEED_CI_v4_WEp1OP_TOTAL = '-'; //Contributes			43
$LEED_CI_v4_WEc1OP_TOTAL = '-'; //Contributes			44
/////////LEED EBOM v4 - Existing Buildings/////
$LEED_EBOM_v4_WEp1OP_TOTAL = '-'; //Contributes			49
$LEED_EBOM_v4_WEc1OP_TOTAL = '-'; //Contributes			50



/////////LEED NC 2009 - New Construction/////////
$LEED_NC_2009_MRc4OP_TOTAL = 0; //$Contributes   		3
$LEED_NC_2009_MRc5OP_TOTAL = 0; //$Contributes   		4
$LEED_NC_2009_MRc6OP_TOTAL = 0; //$Contributes	 		5
$LEED_NC_2009_MRc7OP_TOTAL = 0; //$Contributes	 		6
$LEED_NC_2009_IEQc44OP_TOTAL = '-'; //Contributes 		7

/////////LEED CI 2009 - Commercial Interiors/////
$LEED_CI_2009_MRc4OP_TOTAL = 0; //$Contributes   		10
$LEED_CI_2009_MRc5OP_TOTAL = 0; //$Contributes			11
$LEED_CI_2009_MRc6OP_TOTAL = 0; //$Contributes			12
$LEED_CI_2009_MRc7OP_TOTAL = 0; //$Contributes			13
$LEED_CI_2009_IEQc44OP_TOTAL = '-'; //Contributes		14

/////////LEED EBOM 2009 - Existing Building Operations////////
$LEED_EBOM_2009_MRc3OP_TOTAL = 0; //$Contributes		17

/////////LEED CS 2009 - Core & Shell///////////
$LEED_CS_2009_MRc4OP_TOTAL = 0; //$Contributes			20
$LEED_CS_2009_MRc5OP_TOTAL = 0; //$Contributes			21
$LEED_CS_2009_MRc6OP_TOTAL = 0; //$Contributes			22
$LEED_CS_2009_IEQc44OP_TOTAL = '-'; //Contributes		23

/////////LEED Schools 2009 - Schools/////
$LEED_Schools_2009_MRc4OP_TOTAL = 0; //$Contributes		26
$LEED_Schools_2009_MRc5OP_TOTAL = 0; //$Contributes		27
$LEED_Schools_2009_MRc6OP_TOTAL = 0; //$Contributes		28
$LEED_Schools_2009_MRc7OP_TOTAL = 0; //$Contributes		29
$LEED_Schools_2009_IEQc44OP_TOTAL = '-'; //Contributes	30
$LEED_Schools_2009_IEQc46OP_TOTAL = '-'; //Contributes	31

/////////LEED Healthcare 2009 - Healthcare/////
$LEED_HC_2009_MRc3OP_TOTAL = 0; //$Contributes			34
$LEED_HC_2009_IEQc4OP_TOTAL = '-'; //Contributes		35

/////////LEED NC v4 - New Construction/////
$LEED_NC_v4_MRc1OP_TOTAL = '-'; //Contributes			38
$LEED_NC_v4_MRc2OP_TOTAL = '-'; //Contributes			39
$LEED_NC_v4_MRc3OP_TOTAL = '-'; //Contributes			40
$LEED_NC_v4_MRc4OP_TOTAL = '-'; //Contributes			41
$LEED_NC_v4_EQ2OP_TOTAL = '-'; //Contributes			42

/////////LEED CI v4 - Commercial Interiors/////
$LEED_CI_v4_MRc3OP_TOTAL = '-'; //Contributes			45
$LEED_CI_v4_MRc4OP_TOTAL = '-'; //Contributes			46
$LEED_CI_v4_MRc5OP_TOTAL = '-'; //Contributes			47
$LEED_CI_v4_EQ2OP_TOTAL = '-'; //Contributes			48

/////////LEED EBOM v4 - Existing Buildings/////
$LEED_EBOM_v4_MRc5OP_TOTAL = '-'; //Contributes			51


$showEnergyChart = 0;
$totalLeedCost = 0;
$totalProductMaterialCost = 0;
$totalEngQty = array();
$totalProductMaterialCostArr = array();
$leedActive = 0;
//echo "<pre>";print_r($productDetail);
// Calculation Begins
foreach ($this->fetchShortCodeList as $value) {
    //Create array of Key and Value, as short_code key and subatt_id as  value
    $fetchShortCodeList[$value['short_code']] = $value['subatt_id'];
}

//       print_r("<pre>");
//            print_r($projectDetail);
//            print_r("</pre>");
          //  die       ;   

try {

    for ($p = 0; $p < count($productDetail); $p++) {
        $leedCalcsDetail = array();
        $energyCalcsDetail = array();
        $lifecycleCalcsDetail = array();
        $waterCalcsDetail = array();
        $blName = "";
        $blNameType = "";
        $bl = explode('-', $productDetail[$p]['baseline_info']['product_num']);
        $blName = strtolower($bl[1]);
        $blNameType = strtolower($bl[2]);
        $residential_household_member = ($projectDetail['residential_household_member']) ? $projectDetail['residential_household_member'] : 10;
        $commertial_male_occupants = ($projectDetail['commertial_male_occupants']) ? $projectDetail['commertial_male_occupants'] : 50;
        $commertial_female_occupants = ($projectDetail['commertial_female_occupants']) ? $projectDetail['commertial_female_occupants'] : 50;
        $bike_occupants = ($projectDetail['Bike_occupants']) ? $projectDetail['Bike_occupants'] : 5;
        $hrs_a_day = ($projectDetail['hrs_a_day']) ? $projectDetail['hrs_a_day'] : 8;
        $days_a_week = ($projectDetail['Days_a_week']) ? $projectDetail['Days_a_week'] : 7;
        $days_a_year = ($projectDetail['days_a_year']) ? $projectDetail['days_a_year'] : 365;
        $length_analysis = ($projectDetail['length_analysis']) ? $projectDetail['length_analysis'] : 10;
        $electricity_rate = ($projectDetail['electricity_rate']) ? $projectDetail['electricity_rate'] : 0.15;
        $energy_inflation = ($projectDetail['electricity_inflation']) ? $projectDetail['electricity_inflation'] / 100 : 0.05;
        $water_rate = ($projectDetail['water_rate']) ? $projectDetail['water_rate'] : 1.75;
        $water_inflation = ($projectDetail['water_inflation']) ? $projectDetail['water_inflation'] / 100 : 0.05;
        $PROJECT_ZIP = $projectDetail['zip'];
        $qty = ($qtyUsesWKInfo[$p]['qty_value']) ? $qtyUsesWKInfo[$p]['qty_value'] : 1;
        $uses_wk_value = ($qtyUsesWKInfo[$p]['uses_wk_value']) ? $qtyUsesWKInfo[$p]['uses_wk_value'] : 1;
        // uses per day
        //$formula                        = ($productDetail[$p]['calc'])? $productDetail[$p]['calc']:0;
        // Determine the project type and select Calc module accrodungly
        $projType = $projectDetail['project_type'];
       
        if($productDetail[$p]['prod_updated_price'] != ""){
            $productDetail[$p]['totalProductMaterialCost'] = $qty * $productDetail[$p]['prod_updated_price'];
            $totalProductMaterialCost = $totalProductMaterialCost + ($qty * $productDetail[$p]['prod_updated_price']);
        }else{
            $productDetail[$p]['totalProductMaterialCost'] = $qty * $productDetail[$p]['purchase_price'];
            $totalProductMaterialCost = $totalProductMaterialCost + ($qty * $productDetail[$p]['purchase_price']);
        }
//         print_r("<pre>");
//        print_r($productDetail[$p]['totalProductMaterialCost']);
//        print_r("</pre>");
////         print_r("<pre>");
////        print_r($productDetail[$p]);
////        print_r("</pre>");
////        print_r("<pre>");
////        print_r($productDetail[$p]['prod_updated_price']);
////        print_r("</pre>");
//        die;
        //$prodcalCode = $productDetail[$p]['cal_code'];
        $productSubAttValuesDetail = $objField->getProductSubattValues($productDetail[$p]['product_id']);
        $productAttribites = $objField->fetchProductInfoByIdWithDetail($productDetail[$p]['product_id']);
        $productDetail[$p]['productAttributes'] = $productAttribites[2];

        if ($productSubAttValuesDetail['subatt_id'] != "") {
            $subAttID = explode(',', $productSubAttValuesDetail['subatt_id']);
            $subAttValue = explode(',', $productSubAttValuesDetail['value']);
        }
        $output = array();
        foreach ($subAttID as $key => $value) {
            $output[$value] = $subAttValue[$key];
        }

        $DF_RATE_HIGH = $output[$fetchShortCodeList['DF_RATE_HIGH']];
        $DF_RATE_LOW = $output[$fetchShortCodeList['DF_RATE_LOW']];
        $FLUSH_RATE = $output[$fetchShortCodeList['FLUSH_RATE']];
        $FLOW_RATE = $output[$fetchShortCodeList['FLOW_RATE']];
        $EU = $output[$fetchShortCodeList['EU']];
        $TIP = $output[$fetchShortCodeList['TIP']];
        $EUPC = $output[$fetchShortCodeList['EUPC']];
        $AEU = $output[$fetchShortCodeList['AEU']];
        $WUPC = $output[$fetchShortCodeList['WUPC']];
        $MMC = $output[$fetchShortCodeList['MMC']];
        $BAT_REP_SAV = $output[$fetchShortCodeList['BAT_REP_SAV']];
        $BULB_LIFE = $output[$fetchShortCodeList['BULB_LIFE']];

        //Get Product's baseline subattribute values
        $baseproductSubAttValuesDetail = $objField->getProductSubattValues($productDetail[$p]['baseline_id']);
        if ($baseproductSubAttValuesDetail['subatt_id'] != "") {
            $baseSubAttID = explode(',', $baseproductSubAttValuesDetail['subatt_id']);
            $baseSubAttValue = explode(',', $baseproductSubAttValuesDetail['value']);
        }

        $baseProductOutput = array();
        foreach ($baseSubAttID as $key => $value) {
            $baseProductOutput[$value] = $baseSubAttValue[$key];
        }
//        print_r("<pre>");
//        print_r($baseProductOutput);
//print_r("</pre>");
//die;
        //Get Product's baseline updated subattribute values
        $baseupdatedproductSubAttValuesDetail = $objField->getBaselineProductUpdatedSubattValues($projectDetail['project_id'], $productDetail[$p]['product_id'], $productDetail[$p]['baseline_id']);
        if ($baseupdatedproductSubAttValuesDetail['subatt_id'] != "") {
            $baseupdatedSubAttID = explode(',', $baseupdatedproductSubAttValuesDetail['subatt_id']);
            $baseupdatedSubAttValue = explode(',', $baseupdatedproductSubAttValuesDetail['value']);
        }

        $baseupdatedProductOutput = array();
        foreach ($baseupdatedSubAttID as $key => $value) {
            $baseupdatedProductOutput[$value] = $baseupdatedSubAttValue[$key];
        }

        $formula = array();
        $prodcalCode = array();
        for ($f = 0; $f < count($productDetail[$p]['calcmod_id']); $f++) {

            $formula[] = $productDetail[$p]['calcmod_id'][$f]['calc'];
            $prodcalCode[] = $productDetail[$p]['calcmod_id'][$f]['cal_code'];
            $calcDetail[$productDetail[$p]['calcmod_id'][$f]['cal_code']] = $productDetail[$p]['calcmod_id'][$f]['name'];
        }
       
        if ($projectDetail['leed_list'] != "") {
            $leedList = array();
           
            $leedList = explode(',', $projectDetail['leed_list']);
               
        }
       
        $base_DF_RATE_HIGH = "";
        $base_DF_RATE_LOW = "";
        $base_FLUSH_RATE = "";
        $base_FLOW_RATE = "";
        $base_EU = "";
        $base_TIP = "";
        $base_EUPC = "";
        $base_AEU = "";
        $base_WUPC = "";
        $base_MMC = "";
        $base_BAT_REP_SAV = "";
        $base_BULB_LIFE = "";


        if (isset($baseupdatedProductOutput[$fetchShortCodeList['DF_RATE_HIGH']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['DF_RATE_HIGH']]) {
            $base_DF_RATE_HIGH = $baseupdatedProductOutput[$fetchShortCodeList['DF_RATE_HIGH']];
        }else{
            $base_DF_RATE_HIGH = $baseProductOutput[$fetchShortCodeList['DF_RATE_HIGH']];
        }
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['DF_RATE_LOW']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['DF_RATE_LOW']]) {
            $base_DF_RATE_LOW = $baseupdatedProductOutput[$fetchShortCodeList['DF_RATE_LOW']];
        }else{
            $base_DF_RATE_LOW = $baseProductOutput[$fetchShortCodeList['DF_RATE_LOW']];
        }
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['FLUSH_RATE']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['FLUSH_RATE']]) {
            $base_FLUSH_RATE = $baseupdatedProductOutput[$fetchShortCodeList['FLUSH_RATE']];
        }else{
            $base_FLUSH_RATE = $baseProductOutput[$fetchShortCodeList['FLUSH_RATE']];
        }
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['FLOW_RATE']]) && $baseupdatedProductOutput[$fetchShortCodeList['FLOW_RATE']] != "") {
            $base_FLOW_RATE = $baseupdatedProductOutput[$fetchShortCodeList['FLOW_RATE']];
        }else{
            $base_FLOW_RATE = $baseProductOutput[$fetchShortCodeList['FLOW_RATE']];
        }
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['EU']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['EU']]) {
            $base_EU = $baseupdatedProductOutput[$fetchShortCodeList['EU']];
        }else{
            $base_EU = $baseProductOutput[$fetchShortCodeList['EU']];
        }
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['TIP']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['TIP']]) {
            $base_TIP = $baseupdatedProductOutput[$fetchShortCodeList['TIP']];
        }else{
            $base_TIP = $baseProductOutput[$fetchShortCodeList['TIP']];
        }
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['EUPC']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['EUPC']]) {
            $base_EUPC = $baseupdatedProductOutput[$fetchShortCodeList['EUPC']];
        }else{
            $base_EUPC = $baseProductOutput[$fetchShortCodeList['EUPC']];
        }
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['AEU']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['AEU']]) {
            $base_AEU = $baseupdatedProductOutput[$fetchShortCodeList['AEU']];
        }else{
            $base_AEU = $baseProductOutput[$fetchShortCodeList['AEU']];
        }
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['WUPC']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['WUPC']]) {
            $base_WUPC = $baseupdatedProductOutput[$fetchShortCodeList['WUPC']];
        }else{
            $base_WUPC = $baseProductOutput[$fetchShortCodeList['WUPC']];
        }
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['MMC']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['MMC']]) {
            $base_MMC = $baseupdatedProductOutput[$fetchShortCodeList['MMC']];
        }else{
            $base_MMC = $baseProductOutput[$fetchShortCodeList['MMC']];
        }
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['BAT_REP_SAV']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['BAT_REP_SAV']]) {
            $base_BAT_REP_SAV = $baseupdatedProductOutput[$fetchShortCodeList['BAT_REP_SAV']];
        }else{
            $base_BAT_REP_SAV = $baseProductOutput[$fetchShortCodeList['BAT_REP_SAV']];
        }
       
        if (isset($baseupdatedProductOutput[$fetchShortCodeList['BULB_LIFE']]) && "" != $baseupdatedProductOutput[$fetchShortCodeList['BULB_LIFE']]) {
            $base_BULB_LIFE = $baseupdatedProductOutput[$fetchShortCodeList['BULB_LIFE']];
        }else{
            $base_BULB_LIFE = $baseProductOutput[$fetchShortCodeList['BULB_LIFE']];
        }
        // DETERMINE WHICH TYPE OF PROJECT COMMERCIAL/RESIDENTIAL
        //  echo '-'.$formula;die;
//        print_r("<pre>");
//        print_r($productDetail);
//        print_r("</pre>");
//        die;
//           print_r("<pre>");
//        print_r($leedList);
//        print_r("</pre>");
//         print_r("<pre>");
//        print_r($formula);
//        print_r("</pre>");
//         print_r("<pre>");
//        print_r($prodcalCode);
//        print_r("</pre>");
       
        for ($n = 0; $n < count($formula); $n++) {

            if (in_array('LEED NC 2009 - New Construction', $leedList)) {

                switch ($prodcalCode[$n]) {
                case "LEED_NC_2009_WEp1":
                   
       
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.8 <= 1.6) {
                                    $LEED_NC_2009_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.8 <= 2.2) {
                                    $LEED_NC_2009_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.8 <= 1.0) {
                                        $LEED_NC_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.8 <= 2.5) {
                                        $LEED_NC_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_NC_2009_WEp1OP == "contributes") {
                            $LEED_NC_2009_WEp1OP_TOTAL = $LEED_NC_2009_WEp1OP;
                        }
                        $leedCalcsDetail['LEED NC 2009 - New Construction']['LEED_NC_2009_WEp1'] =  $LEED_NC_2009_WEp1OP;
                        if ($LEED_NC_2009_WEp1OP != "" || empty($LEED_NC_2009_WEp1OP)) {
                            $LEED_NC_2009_WEp1OPArr[] = $LEED_NC_2009_WEp1OP;
                        }

                        $leedActive++;
                        break;
                case "LEED_NC_2009_WEc3":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.7 <= 1.6) {
                                    $LEED_NC_2009_WEc3OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.7 <= 2.2) {
                                    $LEED_NC_2009_WEc3OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.7 <= 1.0) {
                                        $LEED_NC_2009_WEc3OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.7 <= 2.5) {
                                        $LEED_NC_2009_WEc3OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_NC_2009_WEc3OP == "contributes") {
                            $LEED_NC_2009_WEc3OP_TOTAL = $LEED_NC_2009_WEc3OP;
                        }
                        $leedCalcsDetail['LEED NC 2009 - New Construction']['LEED_NC_2009_WEc3'] =  $LEED_NC_2009_WEc3OP;
                        if ($LEED_NC_2009_WEc3OP != "" || empty($LEED_NC_2009_WEc3OP)) {
                            $LEED_NC_2009_WEc3OPArr[] = $LEED_NC_2009_WEc3OP;
                        }
                        $leedActive++;
                        break;
                case "LEED_NC_2009_MRc4":
                    //QTY*UNIT_PRICE*((1*RC_POST)+(0.5*RC_PRE))
                    if ($output[$fetchShortCodeList['RC_POST']] != "" && $output[$fetchShortCodeList['RC_POST']] != 0) {
                        $RC_POST = $output[$fetchShortCodeList['RC_POST']] / 100;
                    } else {
                        $RC_POST = 0;
                    }
                    if ($output[$fetchShortCodeList['RC_PRE']] != "" && $output[$fetchShortCodeList['RC_PRE']] != 0) {
                        $RC_PRE = $output[$fetchShortCodeList['RC_PRE']] / 100;
                    } else {
                        $RC_PRE = 0;
                    }
                    $mathStringProdGallon = str_replace('RC_POST', $RC_POST, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('RC_PRE', $RC_PRE, $mathStringProdGallon);
                   
                    $LEED_NC_2009_MRc4OP = round(calculate_string($mathStringProdGallon), 2);
                    $LEED_NC_2009_MRc4OP_TOTAL = $LEED_NC_2009_MRc4OP_TOTAL + $LEED_NC_2009_MRc4OP;
                   
                    $leedCalcsDetail['LEED NC 2009 - New Construction']['LEED_NC_2009_MRc4'] =  $LEED_NC_2009_MRc4OP;
                    if($LEED_NC_2009_MRc4OP != "" || empty($LEED_NC_2009_MRc4OP)){
                       $totalLeedCost = $totalLeedCost + $LEED_NC_2009_MRc4OP;

                       $LEEDv2009_MR4OPArr[] = $LEED_NC_2009_MRc4OP;
                   }
                   $leedActive++;
                    break;
                case "LEED_NC_2009_MRc5":
               
                    if (is_numeric($output[$fetchShortCodeList['REG_ZIP_EXT']]) && $output[$fetchShortCodeList['REG_ZIP_EXT']] != "" && $projectDetail['zip'] != "" && is_numeric($projectDetail['zip']) && is_numeric($output[$fetchShortCodeList['REG_ZIP_MAN']]) && $output[$fetchShortCodeList['REG_ZIP_MAN']] != "") {
                        $curl1 = curl_init();
                        curl_setopt_array($curl1, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_EXT']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_1 = curl_exec($curl1);

                        $mile_1 = json_decode($mile_1);
                      
                         $curl2 = curl_init();
                        curl_setopt_array($curl2, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_MAN']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_2 = curl_exec($curl2);

                        $mile_2 = json_decode($mile_2);
                        
//                        $mile_1 = file_get_contents('https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_EXT']] . '/' . $projectDetail['zip'] . '/mile');
//                        $mile_1 = json_decode($mile_1);
//                      
//                        $mile_2 = file_get_contents('https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_MAN']] . '/' . $projectDetail['zip'] . '/mile');
//                        $mile_2 = json_decode($mile_2); 
                  
                        if ($mile_1->distance < 500 && $mile_2->distance < 500) {
                           
                            $LEED_NC_2009_MRc5Formula = "QTY*UNIT_PRICE*REG_MAT_PERCENT";
                            //$REG_ZIP_EXT = $output[$fetchShortCodeList['REG_MAT_PERCENT']];
                            if ($output[$fetchShortCodeList['REG_MAT_PERCENT']] != "" && $output[$fetchShortCodeList['REG_MAT_PERCENT']] != 0) {
                                $REG_MAT_PERCENT = $output[$fetchShortCodeList['REG_MAT_PERCENT']] / 100;
                            } else {
                                $REG_MAT_PERCENT = 0;
                            }
                                $mathStringProdGallon = str_replace('REG_MAT_PERCENT', $REG_MAT_PERCENT, $LEED_NC_2009_MRc5Formula);
                                $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                                $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);

                                $LEED_NC_2009_MRc5OP = round(calculate_string($mathStringProdGallon), 2);
                                $leedCalcsDetail['LEED NC 2009 - New Construction']['LEED_NC_2009_MRc5'] =  $LEED_NC_2009_MRc5OP;
                               $LEED_NC_2009_MRc5OP_TOTAL = $LEED_NC_2009_MRc5OP_TOTAL + $LEED_NC_2009_MRc5OP;
                                
                                if ($LEED_NC_2009_MRc5OP != "" || empty($LEED_NC_2009_MRc5OP)) {
                                    $totalLeedCost = $totalLeedCost + $LEED_NC_2009_MRc5OP;
                                 
                                    $LEED_NC_2009_MRc5OPArr[] = $LEED_NC_2009_MRc5OP;
                                }
                          
                        } else {
                                $LEED_NC_2009_MRc5OP_TOTAL = $LEED_NC_2009_MRc5OP_TOTAL + 0;
                            }
                    } else {
                        $LEED_NC_2009_MRc5OP_TOTAL = $LEED_NC_2009_MRc5OP_TOTAL + 0;
                    }
                    
                    $leedActive++;
                    break;
                case "LEED_NC_2009_MRc6":
                    //QTY*UNIT_PRICE*(RAP_REN_PERCENT)
                    if ($output[$fetchShortCodeList['RAP_REN_PERCENT']] != "" && $output[$fetchShortCodeList['RAP_REN_PERCENT']] != 0) {
                        $RAP_REN_PERCENT = $output[$fetchShortCodeList['RAP_REN_PERCENT']] / 100;
                    } else {
                        $RAP_REN_PERCENT = 0;
                    }
                    $mathStringProdGallon = str_replace('RAP_REN_PERCENT', $RAP_REN_PERCENT, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                  
                    $LEED_NC_2009_MRc6OP = round(calculate_string($mathStringProdGallon, 2));
                    $leedCalcsDetail['LEED NC 2009 - New Construction']['LEED_NC_2009_MRc6'] =  $LEED_NC_2009_MRc6OP;
                    $LEED_NC_2009_MRc6OP_TOTAL = $LEED_NC_2009_MRc6OP_TOTAL + $LEED_NC_2009_MRc6OP;
                    if ($LEED_NC_2009_MRc6OP != "" || empty($LEED_NC_2009_MRc6OP)) {
                         $totalLeedCost = $totalLeedCost + $LEED_NC_2009_MRc6OP;
                         
                        $LEED_NC_2009_MRc6OPArr[] = $LEED_NC_2009_MRc6OP;
                    }
                    $leedActive++;
                    break;
                case "LEED_NC_2009_MRc7":

                    //QTY*UNIT_PRICE*(NEW_WOOD_PERCENT)*(CERT_FSC_PERCENT)
                    if ($output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != "" && $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != 0) {
                        $NEW_WOOD_PERCENT = $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] / 100;
                    } else {
                        $NEW_WOOD_PERCENT = 0;
                    }
                    if ($output[$fetchShortCodeList['CERT_FSC_PERCENT']] != "" && $output[$fetchShortCodeList['CERT_FSC_PERCENT']] != 0) {
                        $CERT_FSC_PERCENT = $output[$fetchShortCodeList['CERT_FSC_PERCENT']] / 100;
                    } else {
                        $CERT_FSC_PERCENT = 0;
                    }
                    $mathStringProdGallon = str_replace('NEW_WOOD_PERCENT', $NEW_WOOD_PERCENT, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('CERT_FSC_PERCENT', $CERT_FSC_PERCENT, $mathStringProdGallon);
                    $LEED_NC_2009_MRc7OP = round(calculate_string($mathStringProdGallon), 2);
                    $leedCalcsDetail['LEED NC 2009 - New Construction']['LEED_NC_2009_MRc7'] =  $LEED_NC_2009_MRc7OP;
                    $LEED_NC_2009_MRc7OP_TOTAL = $LEED_NC_2009_MRc7OP_TOTAL + $LEED_NC_2009_MRc7OP;
                    if ($LEED_NC_2009_MRc7OP != "" || empty($LEED_NC_2009_MRc7OP)) {
                         $totalLeedCost = $totalLeedCost + $LEED_NC_2009_MRc7OP;
                            
                        $LEED_NC_2009_MRc7OPArr[] = $LEED_NC_2009_MRc7OP;
                    }
                    $leedActive++;
                    break;
                case "LEED_NC_2009_IEQc4.4":
                    //Contributes if NAUF = Yes
                    if ($output[$fetchShortCodeList['NAUF']] == 'Yes') {
                        $LEED_NC_2009_IEQc44OP = "contributes";
                    } else {
                        $LEED_NC_2009_IEQc44OP = "no";
                    }
                    if ($LEED_NC_2009_IEQc44OP == "contributes") {
                        $LEED_NC_2009_IEQc44OP_TOTAL = $LEED_NC_2009_IEQc44OP;
                    }
                    if ($LEED_NC_2009_IEQc44OP != "" || empty($LEED_NC_2009_IEQc44OP)) {
                         
                        $LEED_NC_2009_IEQc44OPArr[] = $LEED_NC_2009_IEQc44OP;
                    }
                    $leedCalcsDetail['LEED NC 2009 - New Construction']['LEED_NC_2009_IEQc4.4'] =  $LEED_NC_2009_IEQc44OP;
                    
                    $leedActive++;
                    break;
                }
            }
            if (in_array('LEED CI 2009 - Commercial Interiors', $leedList)) {
                switch ($prodcalCode[$n]) {
                case "LEED_CI_2009_WEp1":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.8 <= 1.6) {
                                    $LEED_CI_2009_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.8 <= 2.2) {
                                    $LEED_CI_2009_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.8 <= 1.0) {
                                        $LEED_CI_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.8 <= 2.5) {
                                        $LEED_CI_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_CI_2009_WEp1OP == "contributes") {
                            $LEED_CI_2009_WEp1OP_TOTAL = $LEED_CI_2009_WEp1OP;
                        }
                        $leedCalcsDetail['LEED CI 2009 - Commercial Interiors']['LEED_CI_2009_WEp1'] =  $LEED_CI_2009_WEp1OP;
                        if ($LEED_CI_2009_WEp1OP != "" || empty($LEED_CI_2009_WEp1OP)) {
                            $LEED_CI_2009_WEp1OPArr[] = $LEED_CI_2009_WEp1OP;
                        }
                        $leedActive++;

                        break;
                case "LEED_CI_2009_WEc1":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.7 <= 1.6) {
                                    $LEED_CI_2009_WEc1OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.7 <= 2.2) {
                                    $LEED_CI_2009_WEc1OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.7 <= 1.0) {
                                        $LEED_CI_2009_WEc1OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.7 <= 2.5) {
                                        $LEED_CI_2009_WEc1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_CI_2009_WEc1OP == "contributes") {
                            $LEED_CI_2009_WEc1OP_TOTAL = $LEED_CI_2009_WEc1OP;
                        }
                        $leedCalcsDetail['LEED CI 2009 - Commercial Interiors']['LEED_CI_2009_WEc1'] =  $LEED_CI_2009_WEc1OP;
                        if ($LEED_CI_2009_WEc1OP != "" || empty($LEED_CI_2009_WEc1OP)) {
                            $LEED_CI_2009_WEc1OPArr[] = $LEED_CI_2009_WEc1OP;
                        }
                        $leedActive++;
                        break;
                case "LEED_CI_2009_MRc4":
                    //QTY*UNIT_PRICE*((1*RC_POST)+(0.5*RC_PRE))
                    if ($output[$fetchShortCodeList['RC_POST']] != "" && $output[$fetchShortCodeList['RC_POST']] != 0) {
                        $RC_POST = $output[$fetchShortCodeList['RC_POST']] / 100;
                    } else {
                        $RC_POST = 0;
                    }
                    if ($output[$fetchShortCodeList['RC_PRE']] != "" && $output[$fetchShortCodeList['RC_PRE']] != 0) {
                        $RC_PRE = $output[$fetchShortCodeList['RC_PRE']] / 100;
                    } else {
                        $RC_PRE = 0;
                    }
                    $mathStringProdGallon = str_replace('RC_POST', $RC_POST, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('RC_PRE', $RC_PRE, $mathStringProdGallon);
                   
                    $LEED_CI_2009_MRc4OP = round(calculate_string($mathStringProdGallon), 2);
                    $leedCalcsDetail['LEED CI 2009 - Commercial Interiors']['LEED_CI_2009_MRc4'] =  $LEED_CI_2009_MRc4OP;
                    $LEED_CI_2009_MRc4OP_TOTAL = $LEED_CI_2009_MRc4OP_TOTAL + $LEED_CI_2009_MRc4OP;
                   
                    if($LEED_CI_2009_MRc4OP != "" || empty($LEED_CI_2009_MRc4OP)){
                         $totalLeedCost = $totalLeedCost + $LEED_CI_2009_MRc4OP;

                       $LEED_CI_2009_MRc4OPArr[] = $LEED_CI_2009_MRc4;
                   }
                   $leedActive++;
                    break;


                case "LEED_CI_2009_MRc5":
					//QTY*UNIT_PRICE * ( REG_MAT_PERCENT* REG_ZIP_EXT is less than 500miles from Project_Zip and if REG_ZIP_MAN is less than 500 miles from PROJECT_ZIP)
                    if (is_numeric($output[$fetchShortCodeList['REG_ZIP_EXT']]) && $output[$fetchShortCodeList['REG_ZIP_EXT']] != "" && $projectDetail['zip'] != "" && is_numeric($projectDetail['zip']) && is_numeric($output[$fetchShortCodeList['REG_ZIP_MAN']]) && $output[$fetchShortCodeList['REG_ZIP_MAN']] != "") {
                          $curl1 = curl_init();
                        curl_setopt_array($curl1, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_EXT']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_1 = curl_exec($curl1);

                        $mile_1 = json_decode($mile_1);
                         $curl2 = curl_init();
                        curl_setopt_array($curl2, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_MAN']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_2 = curl_exec($curl2);

                        $mile_2 = json_decode($mile_2);
//                        $mile_1 = file_get_contents('https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_EXT']] . '/' . $projectDetail['zip'] . '/mile');
//                        $mile_1 = json_decode($mile_1);
//                      
//                        $mile_2 = file_get_contents('https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_MAN']] . '/' . $projectDetail['zip'] . '/mile');
//                        $mile_2 = json_decode($mile_2); 
                        if ($mile_1->distance < 500 && $mile_2->distance < 500) {
                           
                            $LEED_CI_2009_MRc5Formula = "QTY*UNIT_PRICE*REG_MAT_PERCENT";
                            //$REG_ZIP_EXT = $output[$fetchShortCodeList['REG_MAT_PERCENT']];
                            if ($output[$fetchShortCodeList['REG_MAT_PERCENT']] != "" && $output[$fetchShortCodeList['REG_MAT_PERCENT']] != 0) {
                                $REG_MAT_PERCENT = $output[$fetchShortCodeList['REG_MAT_PERCENT']] / 100;
                            } else {
                                $REG_MAT_PERCENT = 0;
                            }
                                $mathStringProdGallon = str_replace('REG_MAT_PERCENT', $REG_MAT_PERCENT, $LEED_CI_2009_MRc5Formula);
                                $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                                $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);

                                $LEED_CI_2009_MRc5OP = round(calculate_string($mathStringProdGallon), 2);
                                $leedCalcsDetail['LEED CI 2009 - Commercial Interiors']['LEED_CI_2009_MRc5'] =  $LEED_CI_2009_MRc5OP;
                               $LEED_CI_2009_MRc5OP_TOTAL = $LEED_CI_2009_MRc5OP_TOTAL + $LEED_CI_2009_MRc5OP;
                                
                                if ($LEED_CI_2009_MRc5OP != "" || empty($LEED_CI_2009_MRc5OP)) {
                                    $totalLeedCost = $totalLeedCost + $LEED_CI_2009_MRc5OP;
                                 
                                    $LEED_CI_2009_MRc5OPArr[] = $LEED_CI_2009_MRc5OP;
                                }
                          
                        } else {
                                $LEED_CI_2009_MRc5OP_TOTAL = $LEED_CI_2009_MRc5OP_TOTAL + 0;
                            }
                    } else {
                        $LEED_CI_2009_MRc5OP_TOTAL = $LEED_CI_2009_MRc5OP_TOTAL + 0;
                    }
                    $leedActive++;
                    break;
                case "LEED_CI_2009_MRc6":
                    //QTY*UNIT_PRICE*(RAP_REN_PERCENT)
                    if ($output[$fetchShortCodeList['RAP_REN_PERCENT']] != "" && $output[$fetchShortCodeList['RAP_REN_PERCENT']] != 0) {
                        $RAP_REN_PERCENT = $output[$fetchShortCodeList['RAP_REN_PERCENT']] / 100;
                    } else {
                        $RAP_REN_PERCENT = 0;
                    }
                    $mathStringProdGallon = str_replace('RAP_REN_PERCENT', $RAP_REN_PERCENT, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                  
                    $LEED_CI_2009_MRc6OP = round(calculate_string($mathStringProdGallon, 2));
                     $leedCalcsDetail['LEED CI 2009 - Commercial Interiors']['LEED_CI_2009_MRc6'] =  $LEED_CI_2009_MRc6OP;
                    $LEED_CI_2009_MRc6OP_TOTAL = $LEED_CI_2009_MRc6OP_TOTAL + $LEED_CI_2009_MRc6OP;
                    if ($LEED_CI_2009_MRc6OP != "" || empty($LEED_CI_2009_MRc6OP)) {
                         $totalLeedCost = $totalLeedCost + $LEED_CI_2009_MRc6OP;
                         
                        $LEED_CI_2009_MRc6OPArr[] = $LEED_CI_2009_MRc6OP;
                    }
                    $leedActive++;
                    break;
                case "LEED_CI_2009_MRc7":

                    //QTY*UNIT_PRICE*(NEW_WOOD_PERCENT)*(CERT_FSC_PERCENT)
                    if ($output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != "" && $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != 0) {
                        $NEW_WOOD_PERCENT = $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] / 100;
                    } else {
                        $NEW_WOOD_PERCENT = 0;
                    }
                    if ($output[$fetchShortCodeList['CERT_FSC_PERCENT']] != "" && $output[$fetchShortCodeList['CERT_FSC_PERCENT']] != 0) {
                        $CERT_FSC_PERCENT = $output[$fetchShortCodeList['CERT_FSC_PERCENT']] / 100;
                    } else {
                        $CERT_FSC_PERCENT = 0;
                    }
                    $mathStringProdGallon = str_replace('NEW_WOOD_PERCENT', $NEW_WOOD_PERCENT, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('CERT_FSC_PERCENT', $CERT_FSC_PERCENT, $mathStringProdGallon);
                    $LEED_CI_2009_MRc7OP = round(calculate_string($mathStringProdGallon), 2);
                      $leedCalcsDetail['LEED CI 2009 - Commercial Interiors']['LEED_CI_2009_MRc7'] =  $LEED_CI_2009_MRc7OP;
                    $LEED_CI_2009_MRc7OP_TOTAL = $LEED_CI_2009_MRc7OP_TOTAL + $LEED_CI_2009_MRc7OP;
                    if ($LEED_CI_2009_MRc7OP != "" || empty($LEED_CI_2009_MRc7OP)) {
                         $totalLeedCost = $totalLeedCost + $LEED_CI_2009_MRc7OP;
                            
                        $LEED_CI_2009_MRc7OPArr[] = $LEED_CI_2009_MRc7OP;
                    }
                    $leedActive++;
                    break;
                case "LEED_CI_2009_IEQc4.4":
                    //Contributes if NAUF = Yes
                    if ($output[$fetchShortCodeList['NAUF']] == 'Yes') {
                        $LEED_CI_2009_IEQc44OP = "contributes";
                    } else {
                        $LEED_CI_2009_IEQc44OP = "no";
                    }
                    if ($LEED_CI_2009_IEQc44OP == "contributes") {
                        $LEED_CI_2009_IEQc44OP_TOTAL = $LEED_CI_2009_IEQc44OP;
                    }
                     $leedCalcsDetail['LEED CI 2009 - Commercial Interiors']['LEED_CI_2009_IEQc4.4'] =  $LEED_CI_2009_IEQc44OP;
                    if ($LEED_CI_2009_IEQc44OP != "" || empty($LEED_CI_2009_IEQc44OP)) {
                         
                        $LEED_CI_2009_IEQc44OPArr[] = $LEED_CI_2009_IEQc44OP;
                    }
                    $leedActive++;
                    break;
                }
            }
            if (in_array('LEED EBOM 2009 - Existing Building Operations', $leedList)) {

                switch ($prodcalCode[$n]) {
                    case "LEED_EBOM_2009_WEp1":
                        if ($projType == 'commercial') {
                            if ($blName == "toilet") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE <= 1.6) {
                                        $LEED_EBOM_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE <= 1.0) {
                                        $LEED_EBOM_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                            if ($blName == "faucet") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE <= 2.5) {
                                        $LEED_EBOM_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_EBOM_2009_WEp1OP == "contributes") {
                            $LEED_EBOM_2009_WEp1OP_TOTAL = $LEED_EBOM_2009_WEp1OP;
                        }
                        $leedCalcsDetail['LEED EBOM 2009 - Existing Building Operations']['LEED_EBOM_2009_WEp1'] =  $LEED_EBOM_2009_WEp1OP;
                        if ($LEED_EBOM_2009_WEp1OP != "" || empty($LEED_EBOM_2009_WEp1OP)) {
                            $LEED_EBOM_2009_WEp1OPArr[] = $LEED_EBOM_2009_WEp1OP;
                        }
                        $leedActive++;

                        break;
                    case "LEED_EBOM_2009_WEc2":
                        if ($projType == 'commercial') {
                            if ($blName == "toilet") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.9 <= 1.6) {
                                        $LEED_EBOM_2009_WEc2OP = "contributes";
                                    }
                                }
                            }
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.9 <= 1.0) {
                                        $LEED_EBOM_2009_WEp2OP = "contributes";
                                    }
                                }
                            }
                            if ($blName == "faucet") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.9 <= 2.5) {
                                        $LEED_EBOM_2009_WEp2OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_EBOM_2009_WEp2OP == "contributes") {
                            $LEED_EBOM_2009_WEp2OP_TOTAL = $LEED_EBOM_2009_WEp2OP;
                        }
                         $leedCalcsDetail['LEED EBOM 2009 - Existing Building Operations']['LEED_EBOM_2009_WEc2'] =  $LEED_EBOM_2009_WEp2OP;
                        if ($LEED_EBOM_2009_WEp2OP != "" || empty($LEED_EBOM_2009_WEp2OP)) {
                            $LEED_EBOM_2009_WEp2OPArr[] = $LEED_EBOM_2009_WEp2OP;
                        }
                        $leedActive++;
                        break;
                    case "LEED_EBOM_2009_MRc3":
                      if (is_numeric($output[$fetchShortCodeList['RC_POST']]) && $output[$fetchShortCodeList['RC_POST']]) {
                          if($output[$fetchShortCodeList['RC_POST']] >= 10){
                              $LEED_EBOM_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'];
                              $LEED_EBOM_2009_MRc3OP_TOTAL = $LEED_EBOM_2009_MRc3OP_TOTAL + $LEED_EBOM_2009_MRc3OP;
                          }
                      }
                      if (is_numeric($output[$fetchShortCodeList['RC_PRE']]) && $output[$fetchShortCodeList['RC_PRE']]) {
                          if($output[$fetchShortCodeList['RC_PRE']] >= 20){
                              $LEED_EBOM_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'];
                              $LEED_EBOM_2009_MRc3OP_TOTAL = $LEED_EBOM_2009_MRc3OP_TOTAL + $LEED_EBOM_2009_MRc3OP;
                          }
                      }
                       if (is_numeric($output[$fetchShortCodeList['RAP_REN_PERCENT']]) && $output[$fetchShortCodeList['RAP_REN_PERCENT']]) {
                          if($output[$fetchShortCodeList['RAP_REN_PERCENT']] >= 50){
                              $LEED_EBOM_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'];
                              $LEED_EBOM_2009_MRc3OP_TOTAL = $LEED_EBOM_2009_MRc3OP_TOTAL + $LEED_EBOM_2009_MRc3OP;
                          }
                      }
                       if (is_numeric($output[$fetchShortCodeList['CERT_FSC_PERCENT']]) && $output[$fetchShortCodeList['CERT_FSC_PERCENT']]) {
                          if($output[$fetchShortCodeList['CERT_FSC_PERCENT']] >= 50){
                              $LEED_EBOM_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'];
                              $LEED_EBOM_2009_MRc3OP_TOTAL = $LEED_EBOM_2009_MRc3OP_TOTAL + $LEED_EBOM_2009_MRc3OP;
                          }
                      }
                       if (is_numeric($output[$fetchShortCodeList['REG_MAT_PERCENT']]) && $output[$fetchShortCodeList['REG_MAT_PERCENT']]) {
                          if($output[$fetchShortCodeList['REG_MAT_PERCENT']] > 50){
                              $LEED_EBOM_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'];
                              $LEED_EBOM_2009_MRc3OP_TOTAL = $LEED_EBOM_2009_MRc3OP_TOTAL + $LEED_EBOM_2009_MRc3OP;
                          }
                      }
                    if ($output[$fetchShortCodeList['NAUF']] == 'Yes') {
                       $LEED_EBOM_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'];
                       $LEED_EBOM_2009_MRc3OP_TOTAL = $LEED_EBOM_2009_MRc3OP_TOTAL + $LEED_EBOM_2009_MRc3OP;
                    }
                     $curl1 = curl_init();
                        curl_setopt_array($curl1, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_EXT']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_1 = curl_exec($curl1);

                        $mile_1 = json_decode($mile_1);
                        if ($mile_1->distance > 500) {
                        $LEED_EBOM_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'];
                        $LEED_EBOM_2009_MRc3OP_TOTAL = $LEED_EBOM_2009_MRc3OP_TOTAL + $LEED_EBOM_2009_MRc3OP;
                    }
                         $curl2 = curl_init();
                        curl_setopt_array($curl2, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_MAN']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_2 = curl_exec($curl2);
                  
                        $mile_2 = json_decode($mile_2);
                      if ($mile_2->distance > 500) {
                        $LEED_EBOM_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'];
                        $LEED_EBOM_2009_MRc3OP_TOTAL = $LEED_EBOM_2009_MRc3OP_TOTAL + $LEED_EBOM_2009_MRc3OP;
                    }
                   $leedCalcsDetail['LEED EBOM 2009 - Existing Building Operations']['LEED_EBOM_2009_MRc3'] =  $LEED_EBOM_2009_MRc3OP;
                    if ($LEED_EBOM_2009_MRc3OP != "" || empty($LEED_EBOM_2009_MRc3OP)) {
                                    $totalLeedCost = $totalLeedCost + $LEED_EBOM_2009_MRc3OP;
                                 
                                    $LEED_EBOM_2009_MRc3OPArr[] = $LEED_EBOM_2009_MRc3OP;
                                }
                    $leedActive++;
                    break;
                }
            }
            if (in_array('LEED CS 2009 - Core & Shell', $leedList)) {
                switch ($prodcalCode[$n]) {
                    case "LEED_CS_2009_WEp1":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.8 <= 1.6) {
                                    $LEED_CS_2009_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.8 <= 2.2) {
                                    $LEED_CS_2009_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.8 <= 1.0) {
                                        $LEED_CS_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.8 <= 2.5) {
                                        $LEED_CS_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_CS_2009_WEp1OP == "contributes") {
                            $LEED_CS_2009_WEp1OP_TOTAL = $LEED_CS_2009_WEp1OP;
                        }
                        $leedCalcsDetail['LEED CS 2009 - Core & Shell']['LEED_CS_2009_WEp1'] =  $LEED_CS_2009_WEp1OP;
                        if ($LEED_CS_2009_WEp1OP != "" || empty($LEED_CS_2009_WEp1OP)) {
                            $LEED_CS_2009_WEp1OPArr[] = $LEED_CS_2009_WEp1OP;
                        }
                        $leedActive++;

                        break;
                    case "LEED_CS_2009_WEc2":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.7 <= 1.6) {
                                    $LEED_CS_2009_WEc2OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.7 <= 2.2) {
                                    $LEED_CS_2009_WEc2OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.7 <= 1.0) {
                                        $LEED_CS_2009_WEc2OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.7 <= 2.5) {
                                        $LEED_CS_2009_WEc2OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_CS_2009_WEc2OP == "contributes") {
                            $LEED_CS_2009_WEc2OP_TOTAL = $LEED_CS_2009_WEc2OP;
                        }
                        $leedCalcsDetail['LEED CS 2009 - Core & Shell']['LEED_CS_2009_WEc2'] =  $LEED_CS_2009_WEc2OP;
                        if ($LEED_CS_2009_WEc2OP != "" || empty($LEED_CS_2009_WEc2OP)) {
                            $LEED_CS_2009_WEc2OPArr[] = $LEED_CS_2009_WEc2OP;
                        }
                        $leedActive++;
                        break;
                case "LEED_CS_2009_MRc4":
                    //QTY*UNIT_PRICE*((1*RC_POST)+(0.5*RC_PRE))
                    if ($output[$fetchShortCodeList['RC_POST']] != "" && $output[$fetchShortCodeList['RC_POST']] != 0) {
                        $RC_POST = $output[$fetchShortCodeList['RC_POST']] / 100;
                    } else {
                        $RC_POST = 0;
                    }
                    if ($output[$fetchShortCodeList['RC_PRE']] != "" && $output[$fetchShortCodeList['RC_PRE']] != 0) {
                        $RC_PRE = $output[$fetchShortCodeList['RC_PRE']] / 100;
                    } else {
                        $RC_PRE = 0;
                    }
                    $mathStringProdGallon = str_replace('RC_POST', $RC_POST, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('RC_PRE', $RC_PRE, $mathStringProdGallon);
                    $LEED_CS_2009_MRc4OP = round(calculate_string($mathStringProdGallon), 2);
                    $leedCalcsDetail['LEED CS 2009 - Core & Shell']['LEED_CS_2009_MRc4'] =  $LEED_CS_2009_MRc4OP;
                    $LEED_CS_2009_MRc4OP_TOTAL = $LEED_CS_2009_MRc4OP_TOTAL + $LEED_CS_2009_MRc4OP;
                   
                    if($LEED_CS_2009_MRc4OP != "" || empty($LEED_CS_2009_MRc4OP)){
                         $totalLeedCost = $totalLeedCost + $LEED_CS_2009_MRc4OP;

                       $LEEDv2009_MR4OPArr[] = $LEED_CS_2009_MRc4OP;
                   }
                   $leedActive++;
                    break;

                case "LEED_CS_2009_MRc5":
               
                    if (is_numeric($output[$fetchShortCodeList['REG_ZIP_EXT']]) && $output[$fetchShortCodeList['REG_ZIP_EXT']] != "" && $projectDetail['zip'] != "" && is_numeric($projectDetail['zip']) && is_numeric($output[$fetchShortCodeList['REG_ZIP_MAN']]) && $output[$fetchShortCodeList['REG_ZIP_MAN']] != "") {
                          $curl1 = curl_init();
                        curl_setopt_array($curl1, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_EXT']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_1 = curl_exec($curl1);

                        $mile_1 = json_decode($mile_1);
                         $curl2 = curl_init();
                        curl_setopt_array($curl2, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_MAN']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_2 = curl_exec($curl2);

                        $mile_2 = json_decode($mile_2);
//                        $mile_1 = file_get_contents('https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_EXT']] . '/' . $projectDetail['zip'] . '/mile');
//                        $mile_1 = json_decode($mile_1);
//                      
//                        $mile_2 = file_get_contents('https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_MAN']] . '/' . $projectDetail['zip'] . '/mile');
//                        $mile_2 = json_decode($mile_2); 
                        if ($mile_1->distance < 500 && $mile_2->distance < 500) {
                           
                            $LEED_CS_2009_MRc5Formula = "QTY*UNIT_PRICE*REG_MAT_PERCENT";
                            //$REG_ZIP_EXT = $output[$fetchShortCodeList['REG_MAT_PERCENT']];
                            if ($output[$fetchShortCodeList['REG_MAT_PERCENT']] != "" && $output[$fetchShortCodeList['REG_MAT_PERCENT']] != 0) {
                                $REG_MAT_PERCENT = $output[$fetchShortCodeList['REG_MAT_PERCENT']] / 100;
                            } else {
                                $REG_MAT_PERCENT = 0;
                            }
                                $mathStringProdGallon = str_replace('REG_MAT_PERCENT', $REG_MAT_PERCENT, $LEED_CS_2009_MRc5Formula);
                                $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                                $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);

                                $LEED_CS_2009_MRc5OP = round(calculate_string($mathStringProdGallon), 2);
                                $leedCalcsDetail['LEED CS 2009 - Core & Shell']['LEED_CS_2009_MRc5'] =  $LEED_CS_2009_MRc5OP;
                               $LEED_CS_2009_MRc5OP_TOTAL = $LEED_CS_2009_MRc5OP_TOTAL + $LEED_CS_2009_MRc5OP;
                                
                                if ($LEED_CS_2009_MRc5OP != "" || empty($LEED_CS_2009_MRc5OP)) {
                                    $totalLeedCost = $totalLeedCost + $LEED_CS_2009_MRc5OP;
                                 
                                    $LEED_CS_2009_MRc5OPArr[] = $LEED_CS_2009_MRc5OP;
                                }
                          
                        } else {
                                $LEED_CS_2009_MRc5OP_TOTAL = $LEED_CS_2009_MRc5OP_TOTAL + 0;
                            }
                    } else {
                        $LEED_CS_2009_MRc5OP_TOTAL = $LEED_CS_2009_MRc5OP_TOTAL + 0;
                    }
                    $leedActive++;
                    break;
                
                case "LEED_CS_2009_MRc6":

                    //QTY*UNIT_PRICE*(NEW_WOOD_PERCENT)*(CERT_FSC_PERCENT)
                    if ($output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != "" && $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != 0) {
                        $NEW_WOOD_PERCENT = $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] / 100;
                    } else {
                        $NEW_WOOD_PERCENT = 0;
                    }
                    if ($output[$fetchShortCodeList['CERT_FSC_PERCENT']] != "" && $output[$fetchShortCodeList['CERT_FSC_PERCENT']] != 0) {
                        $CERT_FSC_PERCENT = $output[$fetchShortCodeList['CERT_FSC_PERCENT']] / 100;
                    } else {
                        $CERT_FSC_PERCENT = 0;
                    }
                    $mathStringProdGallon = str_replace('NEW_WOOD_PERCENT', $NEW_WOOD_PERCENT, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('CERT_FSC_PERCENT', $CERT_FSC_PERCENT, $mathStringProdGallon);
                    $LEED_CS_2009_MRc6OP = round(calculate_string($mathStringProdGallon), 2);
                     $leedCalcsDetail['LEED CS 2009 - Core & Shell']['LEED_CS_2009_MRc6'] =  $LEED_CS_2009_MRc6OP;
                    $LEED_CS_2009_MRc6OP_TOTAL = $LEED_CS_2009_MRc6OP_TOTAL + $LEED_CS_2009_MRc6OP;
                    if ($LEED_CS_2009_MRc6OP != "" || empty($LEED_CS_2009_MRc6OP)) {
                         $totalLeedCost = $totalLeedCost + $LEED_CS_2009_MRc6OP;
                            
                        $LEED_CS_2009_MRc6OPArr[] = $LEED_CS_2009_MRc6OP;
                    }
                    $leedActive++;
                    break;
                case "LEED_CS_2009_IEQc4.4":
                    //Contributes if NAUF = Yes
                    if ($output[$fetchShortCodeList['NAUF']] == 'Yes') {
                        $LEED_CS_2009_IEQc44OP = "contributes";
                    } else {
                        $LEED_CS_2009_IEQc44OP = "no";
                    }
                    if ($LEED_CS_2009_IEQc44OP == "contributes") {
                        $LEED_CS_2009_IEQc44OP_TOTAL = $LEED_CS_2009_IEQc44OP;
                    }
                      $leedCalcsDetail['LEED CS 2009 - Core & Shell']['LEED_CS_2009_IEQc4.4'] =  $LEED_CS_2009_IEQc44OP;
                    if ($LEED_CS_2009_IEQc44OP != "" || empty($LEED_CS_2009_IEQc44OP)) {
                         
                        $LEED_CS_2009_IEQc44OPArr[] = $LEED_CS_2009_IEQc44OP;
                    }
                    $leedActive++;
                    break; 
                }
            }
            if (in_array('LEED Schools 2009 - Schools', $leedList)) {
                switch ($prodcalCode[$n]) {
                case "LEED_Schools_2009_WEp1":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.8 <= 1.6) {
                                    $LEED_Schools_2009_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.8 <= 2.2) {
                                    $LEED_Schools_2009_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.8 <= 1.0) {
                                        $LEED_Schools_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.8 <= 2.5) {
                                        $LEED_Schools_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_Schools_2009_WEp1OP == "contributes") {
                            $LEED_Schools_2009_WEp1OP_TOTAL = $LEED_Schools_2009_WEp1OP;
                        }
                        $leedCalcsDetail['LEED Schools 2009 - Schools']['LEED_Schools_2009_WEp1'] =  $LEED_Schools_2009_WEp1OP;
                        if ($LEED_Schools_2009_WEp1OP != "" || empty($LEED_Schools_2009_WEp1OP)) {
                            $LEED_Schools_2009_WEp1OPArr[] = $LEED_Schools_2009_WEp1OP;
                        }
                        $leedActive++;

                        break;
                case "LEED_Schools_2009_WEc3":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.7 <= 1.6) {
                                    $LEED_Schools_2009_WEc3OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.7 <= 2.2) {
                                    $LEED_Schools_2009_WEc3OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.7 <= 1.0) {
                                        $LEED_Schools_2009_WEc3OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.7 <= 2.5) {
                                        $LEED_Schools_2009_WEc3OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_Schools_2009_WEc3OP == "contributes") {
                            $LEED_Schools_2009_WEc3OP_TOTAL = $LEED_Schools_2009_WEc3OP;
                        }
                        $leedCalcsDetail['LEED Schools 2009 - Schools']['LEED_Schools_2009_WEc3'] =  $LEED_Schools_2009_WEc3OP;
                        if ($LEED_Schools_2009_WEc3OP != "" || empty($LEED_Schools_2009_WEc3OP)) {
                            $LEED_Schools_2009_WEc3OPArr[] = $LEED_Schools_2009_WEc3OP;
                        }
                        $leedActive++;
                        break;
                case "LEED_Schools_2009_MRc4":
                    //QTY*UNIT_PRICE*((1*RC_POST)+(0.5*RC_PRE))
                    if ($output[$fetchShortCodeList['RC_POST']] != "" && $output[$fetchShortCodeList['RC_POST']] != 0) {
                        $RC_POST = $output[$fetchShortCodeList['RC_POST']] / 100;
                    } else {
                        $RC_POST = 0;
                    }
                    if ($output[$fetchShortCodeList['RC_PRE']] != "" && $output[$fetchShortCodeList['RC_PRE']] != 0) {
                        $RC_PRE = $output[$fetchShortCodeList['RC_PRE']] / 100;
                    } else {
                        $RC_PRE = 0;
                    }
                    $mathStringProdGallon = str_replace('RC_POST', $RC_POST, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('RC_PRE', $RC_PRE, $mathStringProdGallon);
//                    print_r($mathStringProdGallon);
                    
                    $LEED_Schools_2009_MRc4OP = round(calculate_string($mathStringProdGallon), 2);
                      $leedCalcsDetail['LEED Schools 2009 - Schools']['LEED_Schools_2009_MRc4'] =  $LEED_Schools_2009_MRc4OP;
//                     print_r($LEED_Schools_2009_MRc4OP);
//                    die;
                    $LEED_Schools_2009_MRc4OP_TOTAL = $LEED_Schools_2009_MRc4OP_TOTAL + $LEED_Schools_2009_MRc4OP;
                   
                    if($LEED_Schools_2009_MRc4OP != "" || empty($LEED_Schools_2009_MRc4OP)){
                         $totalLeedCost = $totalLeedCost + $LEED_Schools_2009_MRc4OP;

                       $LEEDv2009_MR4OPArr[] = $LEED_Schools_2009_MRc4OP;
                   }
                   $leedActive++;
                    break;
                case "LEED_Schools_2009_MRc5":
               
                    if (is_numeric($output[$fetchShortCodeList['REG_ZIP_EXT']]) && $output[$fetchShortCodeList['REG_ZIP_EXT']] != "" && $projectDetail['zip'] != "" && is_numeric($projectDetail['zip']) && is_numeric($output[$fetchShortCodeList['REG_ZIP_MAN']]) && $output[$fetchShortCodeList['REG_ZIP_MAN']] != "") {
                          $curl1 = curl_init();
                        curl_setopt_array($curl1, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_EXT']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_1 = curl_exec($curl1);

                        $mile_1 = json_decode($mile_1);
                         $curl2 = curl_init();
                        curl_setopt_array($curl2, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_MAN']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_2 = curl_exec($curl2);

                        $mile_2 = json_decode($mile_2);
//                        $mile_1 = file_get_contents('https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_EXT']] . '/' . $projectDetail['zip'] . '/mile');
//                        $mile_1 = json_decode($mile_1);
//                      
//                        $mile_2 = file_get_contents('https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_MAN']] . '/' . $projectDetail['zip'] . '/mile');
//                        $mile_2 = json_decode($mile_2); 
                        if ($mile_1->distance < 500 && $mile_2->distance < 500) {
                           
                            $LEED_Schools_2009_MRc5Formula = "QTY*UNIT_PRICE*REG_MAT_PERCENT";
                            //$REG_ZIP_EXT = $output[$fetchShortCodeList['REG_MAT_PERCENT']];
                            if ($output[$fetchShortCodeList['REG_MAT_PERCENT']] != "" && $output[$fetchShortCodeList['REG_MAT_PERCENT']] != 0) {
                                $REG_MAT_PERCENT = $output[$fetchShortCodeList['REG_MAT_PERCENT']] / 100;
                            } else {
                                $REG_MAT_PERCENT = 0;
                            }
                                $mathStringProdGallon = str_replace('REG_MAT_PERCENT', $REG_MAT_PERCENT, $LEED_Schools_2009_MRc5Formula);
                                $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                                $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);

                                $LEED_Schools_2009_MRc5OP = round(calculate_string($mathStringProdGallon), 2);
                     $leedCalcsDetail['LEED Schools 2009 - Schools']['LEED_Schools_2009_MRc5'] =  $LEED_Schools_2009_MRc5OP;
                               $LEED_Schools_2009_MRc5OP_TOTAL = $LEED_Schools_2009_MRc5OP_TOTAL + $LEED_Schools_2009_MRc5OP;
                                
                                if ($LEED_Schools_2009_MRc5OP != "" || empty($LEED_Schools_2009_MRc5OP)) {
                                    $totalLeedCost = $totalLeedCost + $LEED_Schools_2009_MRc5OP;
                                 
                                    $LEED_Schools_2009_MRc5OPArr[] = $LEED_Schools_2009_MRc5OP;
                                }
                          
                        } else {
                                $LEED_Schools_2009_MRc5OP_TOTAL = $LEED_Schools_2009_MRc5OP_TOTAL + 0;
                            }
                    } else {
                        $LEED_Schools_2009_MRc5OP_TOTAL = $LEED_Schools_2009_MRc5OP_TOTAL + 0;
                    }
                    $leedActive++;
                    break;
                case "LEED_Schools_2009_MRc6":
                    //QTY*UNIT_PRICE*(RAP_REN_PERCENT)
                    if ($output[$fetchShortCodeList['RAP_REN_PERCENT']] != "" && $output[$fetchShortCodeList['RAP_REN_PERCENT']] != 0) {
                        $RAP_REN_PERCENT = $output[$fetchShortCodeList['RAP_REN_PERCENT']] / 100;
                    } else {
                        $RAP_REN_PERCENT = 0;
                    }
                    $mathStringProdGallon = str_replace('RAP_REN_PERCENT', $RAP_REN_PERCENT, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                  
                    $LEED_Schools_2009_MRc6OP = round(calculate_string($mathStringProdGallon, 2));
                     $leedCalcsDetail['LEED Schools 2009 - Schools']['LEED_Schools_2009_MRc6'] =  $LEED_Schools_2009_MRc6OP;
                    $LEED_Schools_2009_MRc6OP_TOTAL = $LEED_Schools_2009_MRc6OP_TOTAL + $LEED_Schools_2009_MRc6OP;
                    if ($LEED_Schools_2009_MRc6OP != "" || empty($LEED_Schools_2009_MRc6OP)) {
                         $totalLeedCost = $totalLeedCost + $LEED_Schools_2009_MRc6OP;
                         
                        $LEED_Schools_2009_MRc6OPArr[] = $LEED_Schools_2009_MRc6OP;
                    }
                    $leedActive++;
                    break;
                case "LEED_Schools_2009_MRc7":

                    //QTY*UNIT_PRICE*(NEW_WOOD_PERCENT)*(CERT_FSC_PERCENT)
                    if ($output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != "" && $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != 0) {
                        $NEW_WOOD_PERCENT = $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] / 100;
                    } else {
                        $NEW_WOOD_PERCENT = 0;
                    }
                    if ($output[$fetchShortCodeList['CERT_FSC_PERCENT']] != "" && $output[$fetchShortCodeList['CERT_FSC_PERCENT']] != 0) {
                        $CERT_FSC_PERCENT = $output[$fetchShortCodeList['CERT_FSC_PERCENT']] / 100;
                    } else {
                        $CERT_FSC_PERCENT = 0;
                    }
                    $mathStringProdGallon = str_replace('NEW_WOOD_PERCENT', $NEW_WOOD_PERCENT, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('CERT_FSC_PERCENT', $CERT_FSC_PERCENT, $mathStringProdGallon);
                    $LEED_Schools_2009_MRc7OP = round(calculate_string($mathStringProdGallon), 2);
                      $leedCalcsDetail['LEED Schools 2009 - Schools']['LEED_Schools_2009_MRc7'] =  $LEED_Schools_2009_MRc7OP;
                    $LEED_Schools_2009_MRc7OP_TOTAL = $LEED_Schools_2009_MRc7OP_TOTAL + $LEED_Schools_2009_MRc7OP;
                    if ($LEED_Schools_2009_MRc7OP != "" || empty($LEED_Schools_2009_MRc7OP)) {
                         $totalLeedCost = $totalLeedCost + $LEED_Schools_2009_MRc7OP;
                            
                        $LEED_Schools_2009_MRc7OPArr[] = $LEED_Schools_2009_MRc7OP;
                    }
                    $leedActive++;
                    break;
                case "LEED_Schools_2009_IEQc4.4":
                    //Contributes if NAUF = Yes
                    if ($output[$fetchShortCodeList['NAUF']] == 'Yes') {
                        $LEED_Schools_2009_IEQc44OP = "contributes";
                    } else {
                        $LEED_Schools_2009_IEQc44OP = "no";
                    }
                    if ($LEED_Schools_2009_IEQc44OP == "contributes") {
                        $LEED_Schools_2009_IEQc44OP_TOTAL = $LEED_Schools_2009_IEQc44OP;
                    }
                      $leedCalcsDetail['LEED Schools 2009 - Schools']['LEED_Schools_2009_IEQc4.4'] =  $LEED_Schools_2009_IEQc44OP;
                    if ($LEED_Schools_2009_IEQc44OP != "" || empty($LEED_Schools_2009_IEQc44OP)) {
                         
                        $LEED_Schools_2009_IEQc44OPArr[] = $LEED_Schools_2009_IEQc44OP;
                    }
                    $leedActive++;
                    break;
                case "LEED_Schools_2009_IEQc4.6":
                    //Contributes if G_GUARD = Yes
                    if ($output[$fetchShortCodeList['G_GUARD']] == 'Yes') {
                        $LEED_Schools_2009_IEQc46OP = "contributes";
                    } else {
                        $LEED_Schools_2009_IEQc46OP = "no";
                    }
                    if ($LEED_Schools_2009_IEQc46OP == "contributes") {
                        $LEED_Schools_2009_IEQc46OP_TOTAL = $LEED_Schools_2009_IEQc46OP;
                    }
                       $leedCalcsDetail['LEED Schools 2009 - Schools']['LEED_Schools_2009_IEQc4.6'] =  $LEED_Schools_2009_IEQc46OP;
                    if ($LEED_Schools_2009_IEQc46OP != "" || empty($LEED_Schools_2009_IEQc46OP)) {
                         
                        $LEED_Schools_2009_IEQc46OPArr[] = $LEED_Schools_2009_IEQc46OP;
                    }
                    $leedActive++;
                    break;
                }
            }
            if (in_array('LEED Healthcare 2009 - Healthcare', $leedList)) {
                switch ($prodcalCode[$n]) {
                    case "LEED_HC_2009_WEp1":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.8 <= 1.6) {
                                    $LEED_HC_2009_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.8 <= 2.2) {
                                    $LEED_HC_2009_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.8 <= 1.0) {
                                        $LEED_HC_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.8 <= 2.5) {
                                        $LEED_HC_2009_WEp1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_HC_2009_WEp1OP == "contributes") {
                            $LEED_HC_2009_WEp1OP_TOTAL = $LEED_HC_2009_WEp1OP;
                        }
                        $leedCalcsDetail['LEED Healthcare 2009 - Healthcare']['LEED_HC_2009_WEp1'] =  $LEED_HC_2009_WEp1OP;
                        if ($LEED_HC_2009_WEp1OP != "" || empty($LEED_HC_2009_WEp1OP)) {
                            $LEED_HC_2009_WEp1OPArr[] = $LEED_HC_2009_WEp1OP;
                        }
                        $leedActive++;

                        break;
                    case "LEED_HC_2009_WEc3":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.7 <= 1.6) {
                                    $LEED_HC_2009_WEc3OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.7 <= 2.2) {
                                    $LEED_HC_2009_WEc3OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.7 <= 1.0) {
                                        $LEED_HC_2009_WEc3OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.7 <= 2.5) {
                                        $LEED_HC_2009_WEc3OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_HC_2009_WEc3OP == "contributes") {
                            $LEED_HC_2009_WEc3OP_TOTAL = $LEED_HC_2009_WEc3OP;
                        }
                        $leedCalcsDetail['LEED Healthcare 2009 - Healthcare']['LEED_HC_2009_WEc3'] =  $LEED_HC_2009_WEc3OP;
                        if ($LEED_HC_2009_WEc3OP != "" || empty($LEED_HC_2009_WEc3OP)) {
                            $LEED_HC_2009_WEc3OPArr[] = $LEED_HC_2009_WEc3OP;
                        }
                        $leedActive++;
                        break;
                    case "LEED_HC_2009_MRc3":
				//Incomplete
				//$ Contribution is going to be 
                                ////(Recycled Content Contribution = QTY*UNIT_PRICE * ( ( 1*RC_POST) + (.5 * RC_PRE) )
                                //// AND/OR (Regionally sourced  = QTY * UNIT_PRICE *  REG_MAT_PERCENT* REG_ZIP_EXT is less than 500miles from Project_Zip
                                // and if REG_ZIP_MAN is less than 500 miles from PROJECT_ZIP )
                                // AND/OR (Rapidly Renewable  = QTY*UNIT_PRICE*(RAP_REN_PERCENT )  
                                // AND/OR    (  Certified Wood =  QTY*UNIT_PRICE*(NEW_WOOD_PERCENT)*(CERT_FSC_PERCENT)
				//QTY*UNIT_PRICE * ( REG_MAT_PERCENT* REG_ZIP_EXT is less than 500miles from Project_Zip
                                    //and if REG_ZIP_MAN is less than 500 miles from PROJECT_ZIP)
                   		if ($output[$fetchShortCodeList['RC_POST']] != "" && $output[$fetchShortCodeList['RC_POST']] != 0) {
                        $RC_POST = $output[$fetchShortCodeList['RC_POST']] / 100;
                    } else {
                        $RC_POST = 0;
                    }
                    if ($output[$fetchShortCodeList['RC_PRE']] != "" && $output[$fetchShortCodeList['RC_PRE']] != 0) {
                        $RC_PRE = $output[$fetchShortCodeList['RC_PRE']] / 100;
                    } else {
                        $RC_PRE = 0;
                    }
					$LEED_HC_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'] * ((1 * $RC_POST)+(0.5 * $RC_PRE));
                    $LEED_HC_2009_MRc3OP_TOTAL = $LEED_HC_2009_MRc3OP_TOTAL + $LEED_HC_2009_MRc3OP;
					 
					if (is_numeric($output[$fetchShortCodeList['REG_ZIP_EXT']]) && $output[$fetchShortCodeList['REG_ZIP_EXT']] != "" && $projectDetail['zip'] != "" && is_numeric($projectDetail['zip']) && is_numeric($output[$fetchShortCodeList['REG_ZIP_MAN']]) && $output[$fetchShortCodeList['REG_ZIP_MAN']] != "") {
                          $curl1 = curl_init();
                        curl_setopt_array($curl1, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_EXT']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_1 = curl_exec($curl1);
                        $mile_1 = json_decode($mile_1);
                         $curl2 = curl_init();
                        curl_setopt_array($curl2, array( 
                        CURLOPT_RETURNTRANSFER => 1,

                        CURLOPT_URL => 
                            'https://zipcodedistanceapi.redline13.com/rest/Dgy1Ga1avmfk5gWotVsN9urvgdkvJMLm3joJtpUYL9jRqffTaIHkc9PtnaY7WJu0/distance.json/' . $output[$fetchShortCodeList['REG_ZIP_MAN']] . '/' . $projectDetail['zip'] . '/mile'));

                        $mile_2 = curl_exec($curl2);
                        $mile_2 = json_decode($mile_2);
//                        
                        if ($mile_1->distance < 500 && $mile_2->distance < 500) {
                           
                            $LEED_HC_2009_MRc3Formula = "QTY*UNIT_PRICE*REG_MAT_PERCENT";
                            //$REG_ZIP_EXT = $output[$fetchShortCodeList['REG_MAT_PERCENT']];
                            if ($output[$fetchShortCodeList['REG_MAT_PERCENT']] != "" && $output[$fetchShortCodeList['REG_MAT_PERCENT']] != 0) {
                                $REG_MAT_PERCENT = $output[$fetchShortCodeList['REG_MAT_PERCENT']] / 100;
                            } else {
                                $REG_MAT_PERCENT = 0;
                            }
                                $mathStringProdGallon = str_replace('REG_MAT_PERCENT', $REG_MAT_PERCENT, $LEED_HC_2009_MRc3Formula);
                                $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                                $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);

                                $LEED_HC_2009_MRc3OP = round(calculate_string($mathStringProdGallon), 2);
                                
                               $LEED_HC_2009_MRc3OP_TOTAL = $LEED_HC_2009_MRc3OP_TOTAL + $LEED_HC_2009_MRc3OP;
                          
                        }
				}
                                 
				////QTY*UNIT_PRICE*(RAP_REN_PERCENT)
					 if ($output[$fetchShortCodeList['RAP_REN_PERCENT']] != "" && $output[$fetchShortCodeList['RAP_REN_PERCENT']] != 0) {
                        $RAP_REN_PERCENT = $output[$fetchShortCodeList['RAP_REN_PERCENT']] / 100;
                    } else {
                        $RAP_REN_PERCENT = 0;
                    }
                    $LEED_HC_2009_MRc3Formula = "QTY*UNIT_PRICE*RAP_REN_PERCENT";
                     $mathStringProdGallon = str_replace('REG_MAT_PERCENT', $REG_MAT_PERCENT, $LEED_HC_2009_MRc3Formula);
                                $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                                $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);

                                $LEED_HC_2009_MRc3OP = round(calculate_string($mathStringProdGallon), 2);
					//$LEED_HC_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'] * $RAP_REN_PERCENT;
                    $LEED_HC_2009_MRc3OP_TOTAL = $LEED_HC_2009_MRc3OP_TOTAL + $LEED_HC_2009_MRc3OP;
					  if ($output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != "" && $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != 0) {
                        $NEW_WOOD_PERCENT = $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] / 100;
                    } else {
                        $NEW_WOOD_PERCENT = 0;
                    }
                    if ($output[$fetchShortCodeList['CERT_FSC_PERCENT']] != "" && $output[$fetchShortCodeList['CERT_FSC_PERCENT']] != 0) {
                        $CERT_FSC_PERCENT = $output[$fetchShortCodeList['CERT_FSC_PERCENT']] / 100;
                    } else {
                        $CERT_FSC_PERCENT = 0;
                    }
                     $LEED_HC_2009_MRc3Formula = "QTY*UNIT_PRICE*(NEW_WOOD_PERCENT)*(CERT_FSC_PERCENT)";
                     $mathStringProdGallon = str_replace('REG_MAT_PERCENT', $REG_MAT_PERCENT, $LEED_HC_2009_MRc3Formula);
                                $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                                $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);

                                $LEED_HC_2009_MRc3OP = round(calculate_string($mathStringProdGallon), 2);
					$LEED_HC_2009_MRc3OP = $qty * $productDetail[$p]['prod_updated_price'] * $NEW_WOOD_PERCENT * $CERT_FSC_PERCENT;
                    $leedCalcsDetail['LEED Healthcare 2009 - Healthcare']['LEED_HC_2009_MRc3'] =  $LEED_HC_2009_MRc3OP;
                                        $LEED_HC_2009_MRc3OP_TOTAL = $LEED_HC_2009_MRc3OP_TOTAL + $LEED_HC_2009_MRc3OP;
                    $leedActive++;
                    break;
                    case "LEED_HC_2009_IEQc4":
                    //Contributes if G_GUARD = Yes
                    if ($output[$fetchShortCodeList['G_GUARD']] == 'Yes') {
                        $LEED_HC_2009_IEQc4OP = "contributes";
                    } else {
                        $LEED_HC_2009_IEQc4OP = "no";
                    }
                    if ($LEED_HC_2009_IEQc4OP == "contributes") {
                        $LEED_HC_2009_IEQc4OP_TOTAL = $LEED_HC_2009_IEQc4OP;
                    }
                    $leedCalcsDetail['LEED Healthcare 2009 - Healthcare']['LEED_HC_2009_IEQc4'] =  $LEED_HC_2009_IEQc4OP;
                    if ($LEED_HC_2009_IEQc4OP != "" || empty($LEED_HC_2009_IEQc4OP)) {
                         
                        $LEED_HC_2009_IEQc4OPArr[] = $LEED_HC_2009_IEQc4OP;
                    }
                    $leedActive++;
                    break;
                }
            }
            if (in_array('LEED NC v4 - New Construction', $leedList)) {
                switch ($prodcalCode[$n]) {
                    case "LEED_NC_v4_WEp2":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.8 <= 1.6) {
                                    $LEED_NC_v4_WEp2OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.8 <= 2.2) {
                                    $LEED_NC_v4_WEp2OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.8 <= 1.0) {
                                        $LEED_NC_v4_WEp2OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.8 <= 2.5) {
                                        $LEED_NC_v4_WEp2OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_NC_v4_WEp2OP == "contributes") {
                            $LEED_NC_v4_WEp2OP_TOTAL = $LEED_NC_v4_WEp2OP;
                        }
                        $leedCalcsDetail['LEED NC v4 - New Construction']['LEED_NC_v4_WEp2'] =  $LEED_NC_v4_WEp2OP;
                        if ($LEED_NC_v4_WEp2OP != "" || empty($LEED_NC_v4_WEp2OP)) {
                            $LEED_NC_v4_WEp2OPArr[] = $LEED_NC_v4_WEp2OP;
                        }
                        $leedActive++;

                        break;
                    case "LEED_NC_v4_WEc2":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.7 <= 1.6) {
                                    $LEED_NC_v4_WEc2OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.7 <= 2.2) {
                                    $LEED_NC_v4_WEc2OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.7 <= 1.0) {
                                        $LEED_NC_v4_WEc2OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.7 <= 2.5) {
                                        $LEED_NC_v4_WEc2OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_NC_v4_WEc2OP == "contributes") {
                            $LEED_NC_v4_WEc2OP_TOTAL = $LEED_NC_v4_WEc2OP;
                        }
                        $leedCalcsDetail['LEED NC v4 - New Construction']['LEED_NC_v4_WEc2'] =  $LEED_NC_v4_WEc2OP;
                        if ($LEED_NC_v4_WEc2OP != "" || empty($LEED_NC_v4_WEc2OP)) {
                            $LEED_NC_v4_WEc2OPArr[] = $LEED_NC_v4_WEc2OP;
                        }
                        $leedActive++;
                        break;
                    case "LEED_NC_v4_MRc1":
                    //Contributes if EPD_AVAIL = Yes
                    if ($output[$fetchShortCodeList['EPD_AVAIL']] == 'Yes') {
                        $LEED_NC_v4_MRc1OP = "contributes";
                    } else {
                        $LEED_NC_v4_MRc1OP = "no";
                    }
                    if ($LEED_NC_v4_MRc1OP == "contributes") {
                        $LEED_NC_v4_MRc1OP_TOTAL = $LEED_NC_v4_MRc1OP;
                    }
                    $leedCalcsDetail['LEED NC v4 - New Construction']['LEED_NC_v4_MRc1'] =  $LEED_NC_v4_MRc1OP;
                    if ($LEED_NC_v4_MRc1OP != "" || empty($LEED_NC_v4_MRc1OP)) {
                         
                        $LEED_NC_v4_MRc1OPArr[] = $LEED_NC_v4_MRc1OP;
                    }
                    $leedActive++;
                    break;
                    case "LEED_NC_v4_MRc2":
                     //Contributes if EPD_AVAIL = Yes
                    if ($output[$fetchShortCodeList['EPD_AVAIL']] == 'Yes') {
                        $LEED_NC_v4_MRc2OP = "contributes";
                    } else {
                        $LEED_NC_v4_MRc2OP = "no";
                    }
                    if ($LEED_NC_v4_MRc2OP == "contributes") {
                        $LEED_NC_v4_MRc2OP_TOTAL = $LEED_NC_v4_MRc2OP;
                    }
                    $leedCalcsDetail['LEED NC v4 - New Construction']['LEED_NC_v4_MRc2'] =  $LEED_NC_v4_MRc2OP;
                    if ($LEED_NC_v4_MRc2OP != "" || empty($LEED_NC_v4_MRc2OP)) {
                         
                        $LEED_NC_v4_MRc2OPArr[] = $LEED_NC_v4_MRc2OP;
                    }
                    $leedActive++;
                    break;
                    case "LEED_NC_v4_MRc3":
                 		////////////////////First Condition////////////////////////////////////
                    if ($output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != "" && $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != 0) {
                        $NEW_WOOD_PERCENT = $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] / 100;
                    } else {
                        $NEW_WOOD_PERCENT = 0;
                    }
                    if ($output[$fetchShortCodeList['CERT_FSC_PERCENT']] != "" && $output[$fetchShortCodeList['CERT_FSC_PERCENT']] != 0) {
                        $CERT_FSC_PERCENT = $output[$fetchShortCodeList['CERT_FSC_PERCENT']] / 100;
                    } else {
                        $CERT_FSC_PERCENT = 0;
                    }
                    $mathStringProdGallon = str_replace('NEW_WOOD_PERCENT', $NEW_WOOD_PERCENT, "QTY*UNIT_PRICE*(NEW_WOOD_PERCENT)*(CERT_FSC_PERCENT)");
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('CERT_FSC_PERCENT', $CERT_FSC_PERCENT, $mathStringProdGallon);
                    $LEED_NC_v4_MRc3OP_Calc1 = round(calculate_string($mathStringProdGallon), 2);
					
					
					//////////////////Second Condition/////////////////////////////////////
					 if ($output[$fetchShortCodeList['RC_POST']] != "" && $output[$fetchShortCodeList['RC_POST']] != 0) {
                        $RC_POST = $output[$fetchShortCodeList['RC_POST']] / 100;
                    } else {
                        $RC_POST = 0;
                    }
                    if ($output[$fetchShortCodeList['RC_PRE']] != "" && $output[$fetchShortCodeList['RC_PRE']] != 0) {
                        $RC_PRE = $output[$fetchShortCodeList['RC_PRE']] / 100;
                    } else {
                        $RC_PRE = 0;
                    }
                    $mathStringProdGallon = str_replace('RC_POST', $RC_POST, "QTY*UNIT_PRICE*((1*RC_POST)+(0.5*RC_PRE))");
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('RC_PRE', $RC_PRE, $mathStringProdGallon);
                    $LEED_NC_v4_MRc3OP_Calc2 = round(calculate_string($mathStringProdGallon), 2);
					
                    if($LEED_NC_v4_MRc3OP_Calc1 != "" || empty($LEED_NC_v4_MRc3OP_Calc1)){
                       if($LEED_NC_v4_MRc3OP_Calc1 > 0){
							$LEED_NC_v4_MRc3OP_TOTAL = "contributes";
					   }
                   }
				   if($LEED_NC_v4_MRc3OP_Calc2 != "" || empty($LEED_NC_v4_MRc3OP_Calc2)){
                       if($LEED_NC_v4_MRc3OP_Calc2 > 0){
							$LEED_NC_v4_MRc3OP_TOTAL = "contributes";
					   }
                   }
			$leedCalcsDetail['LEED NC v4 - New Construction']['LEED_NC_v4_MRc3'] =  $LEED_NC_v4_MRc3OP_TOTAL;	   
                    if ($LEED_NC_v4_MRc3OP_TOTAL == "contributes" ) {                         
                        $LEED_NC_v4_MRc3OPArr[] = $LEED_NC_v4_MRc3OP_TOTAL;
                    }
                    $leedActive++;
                    break;
                    case "LEED_NC_v4_MRc4":
                
                    if (($output[$fetchShortCodeList['HPD']] == 'Yes') || ($output[$fetchShortCodeList['GRN_SCRN_LIST']]  == 'Yes') || ($output[$fetchShortCodeList['GRN_SCRN_FULL']]  == 'Yes') || ($output[$fetchShortCodeList['C2Cv2_BASIC']] == 'Yes') || ($output[$fetchShortCodeList['C2Cv2_GOLD']]  == 'Yes') || ($output[$fetchShortCodeList['C2Cv2_PLATINUM']] == 'Yes')  || ($output[$fetchShortCodeList['C2Cv3_BRONZE']] == 'Yes') || ($output[$fetchShortCodeList['C2Cv3_SILVER']] == 'Yes') || ($output[$fetchShortCodeList['C2Cv3_GOLD']] == 'Yes') || ($output[$fetchShortCodeList['REACH']] == 'Yes') ) {
                        $LEED_NC_v4_MRc4OP = "contributes";
                    } else {
                        $LEED_NC_v4_MRc4OP = "no";
                    }
                    if ($LEED_NC_v4_MRc4OP == "contributes") {
                        $LEED_NC_v4_MRc4OP_TOTAL = $LEED_NC_v4_MRc4OP;
                    }
                    $leedCalcsDetail['LEED NC v4 - New Construction']['LEED_NC_v4_MRc4'] =  $LEED_NC_v4_MRc4OP;
                    if ($LEED_NC_v4_MRc4OP != "" || empty($LEED_NC_v4_MRc4OP)) {
                        $LEED_NC_v4_MRc4OPArr[] = $LEED_NC_v4_MRc4OP;
                    }
                    $leedActive++;
                    break;
                    case "LEED_NC_v4_EQ2":
                    //Contributes if NAUF = Yes
                    if (($output[$fetchShortCodeList['G_GUARD']] == 'Yes') || ($output[$fetchShortCodeList['NAUF']] == 'Yes')) {
                        $LEED_NC_v4_EQ2OP = "contributes";
                    } else {
                        $LEED_NC_v4_EQ2OP = "no";
                    }
                    if ($LEED_NC_v4_EQ2OP == "contributes") {
                        $LEED_NC_v4_EQ2OP_TOTAL = $LEED_NC_v4_EQ2OP;
                    }
                    $leedCalcsDetail['LEED NC v4 - New Construction']['LEED_NC_v4_EQ2'] =  $LEED_NC_v4_EQ2OP;
                    if ($LEED_NC_v4_EQ2OP != "" || empty($LEED_NC_v4_EQ2OP)) {
                         
                        $LEED_NC_v4_EQ2OPArr[] = $LEED_NC_v4_EQ2OP;
                    }
                    $leedActive++;
                    break;
                }
            }
            if (in_array('LEED CI v4 - Commercial Interiors', $leedList)) {
                switch ($prodcalCode[$n]) {
                    case "LEED_CI_v4_WEp1":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.8 <= 1.6) {
                                    $LEED_CI_v4_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.8 <= 2.2) {
                                    $LEED_CI_v4_WEp1OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.8 <= 1.0) {
                                        $LEED_CI_v4_WEp1OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.8 <= 2.5) {
                                        $LEED_CI_v4_WEp1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_CI_v4_WEp1OP == "contributes") {
                            $LEED_CI_v4_WEp1OP_TOTAL = $LEED_CI_v4_WEp1OP;
                        }
                        $leedCalcsDetail['LEED CI v4 - Commercial Interiors']['LEED_CI_v4_WEp1'] =  $LEED_CI_v4_WEp1OP_TOTAL;
                        if ($LEED_CI_v4_WEp1OP != "" || empty($LEED_CI_v4_WEp1OP)) {
                            $LEED_CI_v4_WEp1OPArr[] = $LEED_CI_v4_WEp1OP;
                        }
                        $leedActive++;

                        break;
                    case "LEED_CI_v4_WEc1":
                        if ($blName == "toilet") {
                            if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                if ($FLUSH_RATE * 0.7 <= 1.6) {
                                    $LEED_CI_v4_WEc1OP = "contributes";
                                }
                            }
                        }
                        if ($blName == "faucet") {
                            if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                if ($FLOW_RATE * 0.7 <= 2.2) {
                                    $LEED_CI_v4_WEc1OP = "contributes";
                                }
                            }
                        }
                        if ($projType == 'commercial') {
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.7 <= 1.0) {
                                        $LEED_CI_v4_WEc1OP = "contributes";
                                    }
                                }
                            }
                        } else if ($projType == 'residential') {
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.7 <= 2.5) {
                                        $LEED_CI_v4_WEc1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_CI_v4_WEc1OP == "contributes") {
                            $LEED_CI_v4_WEc1OP_TOTAL = $LEED_CI_v4_WEc1OP;
                        }
                        $leedCalcsDetail['LEED CI v4 - Commercial Interiors']['LEED_CI_v4_WEc1'] =  $LEED_CI_v4_WEc1OP_TOTAL;
                        if ($LEED_CI_v4_WEc1OP != "" || empty($LEED_CI_v4_WEc1OP)) {
                            $LEED_CI_v4_WEc1OPArr[] = $LEED_CI_v4_WEc1OP;
                        }
                        $leedActive++;
                        break;
                    case "LEED_CI_v4_MRc3":
                     //Contributes if EPD_AVAIL = Yes
                    if ($output[$fetchShortCodeList['EPD_AVAIL']] == 'Yes') {
                        $LEED_CI_v4_MRc3OP = "contributes";
                    } else {
                        $LEED_CI_v4_MRc3OP = "no";
                    }
                    if ($LEED_CI_v4_MRc3OP == "contributes") {
                        $LEED_CI_v4_MRc3OP_TOTAL = $LEED_CI_v4_MRc3OP;
                    }
                    $leedCalcsDetail['LEED CI v4 - Commercial Interiors']['LEED_CI_v4_MRc3'] =  $LEED_CI_v4_MRc3OP;
                    if ($LEED_CI_v4_MRc3OP != "" || empty($LEED_CI_v4_MRc3OP)) {
                         
                        $LEED_CI_v4_MRc3OPArr[] = $LEED_CI_v4_MRc3OP;
                    }
                    $leedActive++;
                    break;
                    case "LEED_CI_v4_MRc4":
                    			////////////////////First Condition////////////////////////////////////
                    if ($output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != "" && $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != 0) {
                        $NEW_WOOD_PERCENT = $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] / 100;
                    } else {
                        $NEW_WOOD_PERCENT = 0;
                    }
                    if ($output[$fetchShortCodeList['CERT_FSC_PERCENT']] != "" && $output[$fetchShortCodeList['CERT_FSC_PERCENT']] != 0) {
                        $CERT_FSC_PERCENT = $output[$fetchShortCodeList['CERT_FSC_PERCENT']] / 100;
                    } else {
                        $CERT_FSC_PERCENT = 0;
                    }
                    $mathStringProdGallon = str_replace('NEW_WOOD_PERCENT', $NEW_WOOD_PERCENT, "QTY*UNIT_PRICE*(NEW_WOOD_PERCENT)*(CERT_FSC_PERCENT)");
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('CERT_FSC_PERCENT', $CERT_FSC_PERCENT, $mathStringProdGallon);
                    $LEED_CI_v4_MRc4OP_Calc1 = round(calculate_string($mathStringProdGallon), 2);
					
					
					//////////////////Second Condition/////////////////////////////////////
					 if ($output[$fetchShortCodeList['RC_POST']] != "" && $output[$fetchShortCodeList['RC_POST']] != 0) {
                        $RC_POST = $output[$fetchShortCodeList['RC_POST']] / 100;
                    } else {
                        $RC_POST = 0;
                    }
                    if ($output[$fetchShortCodeList['RC_PRE']] != "" && $output[$fetchShortCodeList['RC_PRE']] != 0) {
                        $RC_PRE = $output[$fetchShortCodeList['RC_PRE']] / 100;
                    } else {
                        $RC_PRE = 0;
                    }
                    $mathStringProdGallon = str_replace('RC_POST', $RC_POST, "QTY*UNIT_PRICE*((1*RC_POST)+(0.5*RC_PRE))");
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('RC_PRE', $RC_PRE, $mathStringProdGallon);
                    $LEED_CI_v4_MRc4OP_Calc2 = round(calculate_string($mathStringProdGallon), 2);
					
                    
                    if($LEED_CI_v4_MRc4OP_Calc1 != "" || empty($LEED_CI_v4_MRc4OP_Calc1)){
                       if($LEED_CI_v4_MRc4OP_Calc1 > 0){
							$LEED_CI_v4_MRc4OP_TOTAL = "contributes";
					   }
                   }
				   if($LEED_CI_v4_MRc4OP_Calc2 != "" || empty($LEED_CI_v4_MRc4OP_Calc2)){
                       if($LEED_CI_v4_MRc4OP_Calc2 > 0){
							$LEED_CI_v4_MRc4OP_TOTAL = "contributes";
					   }
                   }
                   $leedCalcsDetail['LEED CI v4 - Commercial Interiors']['LEED_CI_v4_MRc4'] =  $LEED_CI_v4_MRc4OP_TOTAL;
				   
                    if ($LEED_CI_v4_MRc4OP_TOTAL == "contributes" ) {                         
                        $LEED_CI_v4_MRc4OPArr[] = $LEED_CI_v4_MRc4OP_TOTAL;
                    }
                    $leedActive++;
                    break;
                    case "LEED_CI_v4_MRc5":
                    if (($output[$fetchShortCodeList['HPD']] == 'Yes') || ($output[$fetchShortCodeList['GRN_SCRN_LIST']]  == 'Yes') || ($output[$fetchShortCodeList['GRN_SCRN_FULL']]  == 'Yes') || ($output[$fetchShortCodeList['C2Cv2_BASIC']] == 'Yes') || ($output[$fetchShortCodeList['C2Cv2_GOLD']]  == 'Yes') || ($output[$fetchShortCodeList['C2Cv2_PLATINUM']] == 'Yes')  || ($output[$fetchShortCodeList['C2Cv3_BRONZE']] == 'Yes') || ($output[$fetchShortCodeList['C2Cv3_SILVER']] == 'Yes') || ($output[$fetchShortCodeList['C2Cv3_GOLD']] == 'Yes') || ($output[$fetchShortCodeList['REACH']] == 'Yes') ) {
                        $LEED_CI_v4_MRc5OP = "contributes";
                    } else {
                        $LEED_CI_v4_MRc5OP = "no";
                    }
                    if ($LEED_CI_v4_MRc5OP == "contributes") {
                        $LEED_CI_v4_MRc5OP_TOTAL = $LEED_CI_v4_MRc5OP;
                    }
                    $leedCalcsDetail['LEED CI v4 - Commercial Interiors']['LEED_CI_v4_MRc5'] =  $LEED_CI_v4_MRc5OP;
                    if ($LEED_CI_v4_MRc5OP != "" || empty($LEED_CI_v4_MRc5OP)) {
                        $LEED_CI_v4_MRc5OPArr[] = $LEED_CI_v4_MRc5OP;
                    }
                    $leedActive++;
                    break;
                    case "LEED_CI_v4_EQ2":
                    //Contributes if NAUF = Yes
                    if (($output[$fetchShortCodeList['G_GUARD']] == 'Yes') || ($output[$fetchShortCodeList['NAUF']] == 'Yes')) {
                        $LEED_CI_v4_EQ2OP = "contributes";
                    } else {
                        $LEED_CI_v4_EQ2OP = "no";
                    }
                    if ($LEED_CI_v4_EQ2OP == "contributes") {
                        $LEED_CI_v4_EQ2OP_TOTAL = $LEED_CI_v4_EQ2OP;
                    }
                    $leedCalcsDetail['LEED CI v4 - Commercial Interiors']['LEED_CI_v4_EQ2'] =  $LEED_CI_v4_EQ2OP;
                    if ($LEED_CI_v4_EQ2OP != "" || empty($LEED_CI_v4_EQ2OP)) {
                         
                        $LEED_CI_v4_EQ2OPArr[] = $LEED_CI_v4_EQ2OP;
                    }
                    $leedActive++;
                    break;
                }
            }
            if (in_array('LEED EBOM v4 - Existing Buildings', $leedList)) {
                switch ($prodcalCode[$n]) {
                    case "LEED_EBOM_v4_WEp1":
                        if ($projType == 'commercial') {
                            if ($blName == "toilet") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE <= 1.6) {
                                        $LEED_EBOM_v4_WEp1OP = "contributes";
                                    }
                                }
                            }
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE <= 1.0) {
                                        $LEED_EBOM_v4_WEp1OP = "contributes";
                                    }
                                }
                            }
                            if ($blName == "faucet") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE <= 2.2) {
                                        $LEED_EBOM_v4_WEp1OP = "contributes";
                                    }
                                }
                            }
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE <= 2.5) {
                                        $LEED_EBOM_v4_WEp1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_EBOM_v4_WEp1OP == "contributes") {
                            $LEED_EBOM_v4_WEp1OP_TOTAL = $LEED_EBOM_v4_WEp1OP;
                        }
                        $leedCalcsDetail['LEED EBOM v4 - Existing Buildings']['LEED_EBOM_v4_WEp1'] =  $LEED_EBOM_v4_WEp1OP;
                        if ($LEED_EBOM_v4_WEp1OP != "" || empty($LEED_EBOM_v4_WEp1OP)) {
                            $LEED_EBOM_v4_WEp1OPArr[] = $LEED_EBOM_v4_WEp1OP;
                        }
                        $leedActive++;

                        break;
                    case "LEED_EBOM_2009_WEc1":
                        if ($projType == 'commercial') {
                            if ($blName == "toilet") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.9 <= 1.6) {
                                        $LEED_EBOM_2009_WEc1OP = "contributes";
                                    }
                                }
                            }
                            if ($blName == "urinal") {
                                if (isset($FLUSH_RATE) && $FLUSH_RATE != "") {
                                    if ($FLUSH_RATE * 0.9 <= 1.0) {
                                        $LEED_EBOM_2009_WEc1OP = "contributes";
                                    }
                                }
                            }
                            if ($blName == "faucet") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.9 <= 2.2) {
                                        $LEED_EBOM_2009_WEc1OP = "contributes";
                                    }
                                }
                            }
                            if ($blName == "shower") {
                                if (isset($FLOW_RATE) && $FLOW_RATE != "") {
                                    if ($FLOW_RATE * 0.9 <= 2.5) {
                                        $LEED_EBOM_2009_WEc1OP = "contributes";
                                    }
                                }
                            }
                        }
                        if ($LEED_EBOM_2009_WEc1OP == "contributes") {
                            $LEED_EBOM_2009_WEc1OP_TOTAL = $LEED_EBOM_2009_WEc1OP;
                        }
                        $leedCalcsDetail['LEED EBOM v4 - Existing Buildings']['LEED_EBOM_2009_WEc1'] =  $LEED_EBOM_2009_WEc1OP;
                        if ($LEED_EBOM_2009_WEc1OP != "" || empty($LEED_EBOM_2009_WEc1OP)) {
                            $LEED_EBOM_2009_WEc1OPArr[] = $LEED_EBOM_2009_WEc1OP;
                        }
                        $leedActive++;
                        break;
                    case "LEED_EBOM_v4_MRc5":
                    ////////////////////First Condition////////////////////////////////////
                    if ($output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != "" && $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] != 0) {
                        $NEW_WOOD_PERCENT = $output[$fetchShortCodeList['NEW_WOOD_PERCENT']] / 100;
                    } else {
                        $NEW_WOOD_PERCENT = 0;
                    }
                    if ($output[$fetchShortCodeList['CERT_FSC_PERCENT']] != "" && $output[$fetchShortCodeList['CERT_FSC_PERCENT']] != 0) {
                        $CERT_FSC_PERCENT = $output[$fetchShortCodeList['CERT_FSC_PERCENT']] / 100;
                    } else {
                        $CERT_FSC_PERCENT = 0;
                    }
                    $mathStringProdGallon = str_replace('NEW_WOOD_PERCENT', $NEW_WOOD_PERCENT, "QTY*UNIT_PRICE*(NEW_WOOD_PERCENT)*(CERT_FSC_PERCENT)");
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('CERT_FSC_PERCENT', $CERT_FSC_PERCENT, $mathStringProdGallon);
                    $LEED_EBOM_v4_MRc5OP_Calc1 = round(calculate_string($mathStringProdGallon), 2);
					
					
                    //////////////////Second Condition/////////////////////////////////////
                    if ($output[$fetchShortCodeList['RC_POST']] != "" && $output[$fetchShortCodeList['RC_POST']] != 0) {
                        $RC_POST = $output[$fetchShortCodeList['RC_POST']] / 100;
                    } else {
                        $RC_POST = 0;
                    }
                    if ($output[$fetchShortCodeList['RC_PRE']] != "" && $output[$fetchShortCodeList['RC_PRE']] != 0) {
                        $RC_PRE = $output[$fetchShortCodeList['RC_PRE']] / 100;
                    } else {
                        $RC_PRE = 0;
                    }
                    $mathStringProdGallon = str_replace('RC_POST', $RC_POST, "QTY*UNIT_PRICE*((1*RC_POST)+(0.5*RC_PRE))");
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('UNIT_PRICE', $productDetail[$p]['prod_updated_price'], $mathStringProdGallon);
                    $mathStringProdGallon = str_replace('RC_PRE', $RC_PRE, $mathStringProdGallon);
                    $LEED_EBOM_v4_MRc5OP_Calc2 = round(calculate_string($mathStringProdGallon), 2);
				
                    if (($output[$fetchShortCodeList['NAUF']] == 'Yes') || ($output[$fetchShortCodeList['G_GUARD']] == 'Yes') || ($output[$fetchShortCodeList['HPD']] == 'Yes') || ($output[$fetchShortCodeList['GRN_SCRN_LIST']]  == 'Yes') || ($output[$fetchShortCodeList['GRN_SCRN_FULL']]  == 'Yes') || ($output[$fetchShortCodeList['C2Cv2_BASIC']] == 'Yes') || ($output[$fetchShortCodeList['C2Cv2_GOLD']]  == 'Yes') || ($output[$fetchShortCodeList['C2Cv2_PLATINUM']] == 'Yes')  || ($output[$fetchShortCodeList['C2Cv3_BRONZE']] == 'Yes') || ($output[$fetchShortCodeList['C2Cv3_SILVER']] == 'Yes') || ($output[$fetchShortCodeList['C2Cv3_GOLD']] == 'Yes') || ($output[$fetchShortCodeList['REACH']] == 'Yes') ) {
                        $LEED_EBOM_v4_MRc5OP = "contributes";
                    } else {
                        $LEED_EBOM_v4_MRc5OP = "no";
                    }
					if($LEED_EBOM_v4_MRc5OP_Calc1 != "" || empty($LEED_EBOM_v4_MRc5OP_Calc1)){
                       if($LEED_EBOM_v4_MRc5OP_Calc1 > 0){
							$LEED_EBOM_v4_MRc5OP = "contributes";
					   }
                   }
				   if($LEED_EBOM_v4_MRc5OP_Calc2 != "" || empty($LEED_EBOM_v4_MRc5OP_Calc2)){
                       if($LEED_EBOM_v4_MRc5OP_Calc2 > 0){
							$LEED_EBOM_v4_MRc5OP = "contributes";
					   }
                   }
                    if ($LEED_EBOM_v4_MRc5OP == "contributes") {
                        $LEED_EBOM_v4_MRc5OP_TOTAL = $LEED_EBOM_v4_MRc5OP;
                    }
                    $leedCalcsDetail['LEED EBOM v4 - Existing Buildings']['LEED_EBOM_v4_MRc5'] =  $LEED_EBOM_v4_MRc5OP;
                    if ($LEED_EBOM_v4_MRc5OP != "" || empty($LEED_EBOM_v4_MRc5OP)) {
                        $LEED_EBOM_v4_MRc5OPArr[] = $LEED_EBOM_v4_MRc5OP;
                    }
                    $leedActive++;
                    break;
                }
            }
              if(in_array('enery_carbon', $leedList)){
            
            switch ($prodcalCode[$n]) {
/////////////////////////////ENERGY/////////////////////////////////////// 
                case "E_ASSA_LOCKS":
                    //QTY*(ANN_E_SAVINGS/12)

                    if ($output[$fetchShortCodeList['ANN_E_SAVINGS']] != "" && $output[$fetchShortCodeList['ANN_E_SAVINGS']] != 0) {
                        $ANN_E_SAVINGS = $output[$fetchShortCodeList['ANN_E_SAVINGS']];
                    } else {
                        $ANN_E_SAVINGS = 0;
                    }

                    $mathStringProdGallon = str_replace('ANN_E_SAVINGS', $ANN_E_SAVINGS, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);
                    
                    $E_ASSA_LOCKSOP = round(calculate_string($mathStringProdGallon), 2);
                    $energyCalcsDetail['E_ASSA_LOCKS'] =  $E_ASSA_LOCKSOP;
                    $ProdEnergy = $E_ASSA_LOCKSOP;
                    $diff = $ProdEnergy;
                    $EnergyCostSaving = ($diff) * ($projectDetail['electricity_rate']);
                    $productDetail[$p]['IndividualEnergyCost'] =  $EnergyCostSaving;
                    $productDetail[$p]['IndividualEnergy'] =  $diff;
                    array_push($CumulativeEnergyCost, $EnergyCostSaving);
                    array_push($CumulativeEnergy, $diff);
                     $totalEngQty[$p] = $qty;
                    $showEnergyChart++;
                    break;
                case "P_ASSA_LOCKS_CARBON":
                    //QTY*(ANN_C_SAVED/12)
                    if ($output[$fetchShortCodeList['ANN_C_SAVED']] != "" && $output[$fetchShortCodeList['ANN_C_SAVED']] != 0) {
                        $ANN_C_SAVED = $output[$fetchShortCodeList['ANN_C_SAVED']];
                    } else {
                        $ANN_C_SAVED = 0;
                    }
                    $mathStringProdGallon = str_replace('ANN_C_SAVED', $ANN_C_SAVED, $formula[$n]);
                    $mathStringProdGallon = str_replace('QTY', $qty, $mathStringProdGallon);

                    $P_ASSA_LOCKS_CARBONOP = round(calculate_string($mathStringProdGallon), 2);
                    $energyCalcsDetail['P_ASSA_LOCKS_CARBON'] =  $P_ASSA_LOCKS_CARBONOP;
                    $ProdEnergy = $P_ASSA_LOCKS_CARBONOP;
                    $diff = $ProdEnergy;
                    $EnergyCostSaving = ($diff) * ($projectDetail['electricity_rate']);
                    $productDetail[$p]['IndividualEnergyCostCarbon'] =  $EnergyCostSaving;
                    $productDetail[$p]['IndividualEnergyCarbon'] =  $diff;
                    array_push($CumulativeEnergyCostCarbon, $EnergyCostSaving);
                    array_push($CumulativeEnergyCarbon, $diff);
                    $totalEngQty[$p] = $qty;
                    $showEnergyChart++;
                  
                    break;

            }
               }
        }
       
        $rejected_subatt = array();
        if ($projType == 'commercial') {
            for ($w = 0; $w < count($formula); $w++) {
                switch ($prodcalCode[$w]) {

                    case "W_TDF_C": // Water:Toilets-Dual Flush-Commercial
                        //echo $formula[$w]."<br>";
                        $mathStringProdGallon = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringProdGallon = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringProdGallon);
                        $mathStringProdGallon = str_replace('commercial_female_occupants', $commertial_female_occupants, $mathStringProdGallon);
                        $mathStringProdGallon = str_replace('DF_RATE_HIGH', $DF_RATE_HIGH, $mathStringProdGallon);
                        $mathStringProdGallon = str_replace('DF_RATE_LOW', $DF_RATE_LOW, $mathStringProdGallon);
                        //echo $mathStringProdGallon; die;
                        $ProdGPM = calculate_string($mathStringProdGallon);
                        if ($ProdGPM == "error") {
                            //$productDetail[$p]['product_name']
                            $rejected_product_array[$productDetail[$p]['product_name']]['DF_RATE_HIGH'] = $DF_RATE_HIGH;
                            $rejected_product_array[$productDetail[$p]['product_name']]['DF_RATE_LOW'] = $DF_RATE_LOW;
                        } else {
                            $ProdGPM = round($ProdGPM);
                            
                        }
                        //echo $ProdGPM; die;

                        $baseGPM = str_replace($DF_RATE_HIGH, $base_DF_RATE_HIGH, $mathStringProdGallon);
                        $baseGPM = str_replace($DF_RATE_LOW, $base_DF_RATE_LOW, $baseGPM);

                        $baseGPM = calculate_string($baseGPM);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_DF_RATE_HIGH'] = $base_DF_RATE_HIGH;
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_DF_RATE_LOW'] = $base_DF_RATE_LOW;
                        } else {
                            $baseGPM = round($baseGPM);
                            
                        }
                        //echo $baseGPM;
                        //echo "\nMonthly Water Consumption of BASELIE(GPM) = ".$baseGPM;
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_TDF_C'] =  $diff;
                            //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }

                        break;

                    case "W_TSF_C": // Water:Toilets-Single Flush-Commercial
                        //echo $formula[$w];
                        $mathStringProdGallon = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringProdGallon = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringProdGallon);
                        $mathStringProdGallon = str_replace('commercial_female_occupants', $commertial_female_occupants, $mathStringProdGallon);
                        $mathStringProdGallon = str_replace('FLUSH_RATE', $FLUSH_RATE, $mathStringProdGallon);

                        $ProdGPM = calculate_string($mathStringProdGallon);
                        if ($ProdGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['FLUSH_RATE'] = $FLUSH_RATE;
                        } else {
                            $ProdGPM = round($ProdGPM);
                        }
                        $baseGPM = str_replace($FLUSH_RATE, $base_FLUSH_RATE, $mathStringProdGallon);

                        $baseGPM = calculate_string($baseGPM);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_FLUSH_RATE'] = $base_DF_RATE_HIGH;
                        } else {
                            $baseGPM = round($baseGPM);
                        }
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_TSF_C'] =  $diff;
                            //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }
                        break;

                    case "W_WC": // Water:Washlet-Commercial
                        $mathStringProdGallon = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringProdGallon = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringProdGallon);
                        $mathStringProdGallon = str_replace('commercial_female_occupants', $commertial_female_occupants, $mathStringProdGallon);
                        $mathStringProdGallon = str_replace('uses_wk_value', $uses_wk_value, $mathStringProdGallon);
                        $mathStringProdGallon = str_replace('FLOW_RATE', $FLOW_RATE, $mathStringProdGallon);

                        $ProdGPM = calculate_string($mathStringProdGallon);
                        if ($ProdGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['FLOW_RATE'] = $FLOW_RATE;
                        } else {
                            $ProdGPM = round($ProdGPM);
                        }
                        //echo "\nMonthly Water Consumption of Selected Product(GPM) =". $ProdGPM;

                        $baseGPM = str_replace($productDetail[$p]['FLOW_RATE'], $base_FLOW_RATE, $mathStringProdGallon);

                        $baseGPM = calculate_string($baseGPM);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_FLOW_RATE'] = $base_FLOW_RATE;
                        } else {
                            $baseGPM = round($baseGPM);
                        }
                        //echo "\nMonthly Water Consumption of BASELIE(GPM) = ".$baseGPM;
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_WC'] =  $diff;
                            //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }
                        break;

                    case "W_FC":  // Water:Faucet-Commercial
                        //echo $prodcalCode[$w];
                        $mathStringProd = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringProd = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringProd);
                        $mathStringProd = str_replace('commercial_female_occupants', $commertial_female_occupants, $mathStringProd);
                        $mathStringProd = str_replace('FLOW_RATE', $FLOW_RATE, $mathStringProd);
                        //echo "ProdGPM::".$mathStringProd;die;

                        $ProdGPM = calculate_string($mathStringProd);
                        if ($ProdGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['FLOW_RATE'] = $FLOW_RATE;
                        } else {
                            $ProdGPM = round($ProdGPM);
                        }
                        //echo "ProdGPM::".$ProdGPM;

                        $mathStringBase = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringBase = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringBase);
                        $mathStringBase = str_replace('commercial_female_occupants', $commertial_female_occupants, $mathStringBase);
                        $mathStringBase = str_replace('FLOW_RATE', $base_FLOW_RATE, $mathStringBase);

                        $baseGPM = calculate_string($mathStringBase);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_FLOW_RATE'] = $base_FLOW_RATE;
                        } else {
                            $baseGPM = round($baseGPM);
                        }
                        //  echo "BaseGPM::".$baseGPM;die;
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_FC'] =  $diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }
                        break;

                    case "W_SC":  // Water:Shower-Commercial

                        $mathStringProd = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringProd = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringProd);
                        $mathStringProd = str_replace('commercial_female_occupants', $commertial_female_occupants, $mathStringProd);
                        $mathStringProd = str_replace('PERCENT_BIKE_OCC', '0.05', $mathStringProd);
                        $mathStringProd = str_replace('FLOW_RATE', $FLOW_RATE, $mathStringProd);

                        //echo $mathStringProd;die;

                        $ProdGPM = calculate_string($mathStringProd);
                        if ($ProdGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['FLOW_RATE'] = $FLOW_RATE;
                        } else {
                            $ProdGPM = round($ProdGPM);
                        }
                        //echo $ProdGPM;die;
                        $mathStringBase = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringBase = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringBase);
                        $mathStringBase = str_replace('commercial_female_occupants', $commertial_female_occupants, $mathStringBase);
                        $mathStringBase = str_replace('PERCENT_BIKE_OCC', '0.05', $mathStringBase);
                        $mathStringBase = str_replace('FLOW_RATE', $base_FLOW_RATE, $mathStringBase);
                        //echo $mathStringBase;die;

                        $baseGPM = calculate_string($mathStringBase);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_FLOW_RATE'] = $base_FLOW_RATE;
                        } else {
                            $baseGPM = round($baseGPM);
                        }
                        //echo "BASELIE(GPM) = ".$baseGPM;
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_SC'] =  $diff;
                            //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }
                        break;


                    case "W_FVU_C": // Water: Flush Valve Urinal-Commercial


                        $mathStringProd = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringProd = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringProd);
                        $mathStringProd = str_replace('FLUSH_RATE', $FLUSH_RATE, $mathStringProd);
                        //echo $mathStringProd; 

                        $ProdGPM = calculate_string($mathStringProd);
                        if ($ProdGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['FLUSH_RATE'] = $FLUSH_RATE;
                        } else {
                            $ProdGPM = round($ProdGPM);
                        }

                        $mathStringBase = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringBase = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringBase);
                        $mathStringBase = str_replace('FLUSH_RATE', $base_FLUSH_RATE, $mathStringBase);
                        //echo $mathStringBase; 

                        $baseGPM = calculate_string($mathStringBase);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_FLUSH_RATE'] = $base_FLUSH_RATE;
                        } else {
                            $baseGPM = round($baseGPM);
                        }
                        //echo $baseGPM;die;
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_FVU_C'] =  $diff;
                            //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }
                        break;

                    case "W_FVT_C": // Water: Flush Valve Toilet-Commercial

                        $mathStringProd = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringProd = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringProd);
                        $mathStringProd = str_replace('commercial_female_occupants', $commertial_female_occupants, $mathStringProd);
                        $mathStringProd = str_replace('FLUSH_RATE', $FLUSH_RATE, $mathStringProd);

                        //echo $mathStringProd."<br>";

                        $ProdGPM = calculate_string($mathStringProd);
                        if ($ProdGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['FLUSH_RATE'] = FLUSH_RATE;
                        } else {
                            $ProdGPM = round($ProdGPM);
                        }
                        //echo "ProdGPM::". $ProdGPM;
                        $mathStringBase = str_replace('Days_a_week', $days_a_week, $formula[$w]);
                        $mathStringBase = str_replace('commercial_male_occupants', $commertial_male_occupants, $mathStringBase);
                        $mathStringBase = str_replace('commercial_female_occupants', $commertial_female_occupants, $mathStringBase);

                        $mathStringBase = str_replace('FLUSH_RATE', $base_FLUSH_RATE, $mathStringBase);
                        //echo $mathStringBase; die;

                        $baseGPM = calculate_string($mathStringBase);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_FLUSH_RATE'] = $base_FLUSH_RATE;
                        } else {
                            $baseGPM = round($baseGPM);
                        }
                        //echo "BaseGPM::". $baseGPM;die;
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_FVT_C'] =  $diff;
                            //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }
                        break;

                    // Default:
                    //echo "One or more of your products are missing values to complete your payback analysis.";
                }
            }
        } else if ($projType == 'residential') {
            // Residential

            for ($w = 0; $w < count($formula); $w++) {

                switch ($prodcalCode[$w]) {

                    case "W_TDF_R":

                        try {
                            $mathStringProdGallon = str_replace('residential_household_member', $residential_household_member, $formula[$w]);
                            $mathStringProdGallon = str_replace('DF_RATE_HIGH', $DF_RATE_HIGH, $mathStringProdGallon);
                            $mathStringProdGallon = str_replace('DF_RATE_LOW', $DF_RATE_LOW, $mathStringProdGallon);


                            $ProdGPM = calculate_string($mathStringProdGallon);
                            if ($ProdGPM == "error") {
                                $rejected_product_array[$productDetail[$p]['product_name']]['DF_RATE_HIGH'] = $DF_RATE_HIGH;
                                $rejected_product_array[$productDetail[$p]['product_name']]['DF_RATE_LOW'] = DF_RATE_LOW;
                            } else {
                                $ProdGPM = round($ProdGPM);
                            }
                            $baseGPM = str_replace($DF_RATE_HIGH, $base_DF_RATE_HIGH, $mathStringProdGallon);
                            $baseGPM = str_replace($DF_RATE_LOW, $base_DF_RATE_LOW, $baseGPM);

                            $baseGPM = calculate_string($baseGPM);
                            if ($baseGPM == "error") {
                                $rejected_product_array[$productDetail[$p]['product_name']]['base_DF_RATE_HIGH'] = $base_DF_RATE_HIGH;
                                $rejected_product_array[$productDetail[$p]['product_name']]['$base_DF_RATE_LOW'] = $base_DF_RATE_LOW;
                            } else {
                                $baseGPM = round($baseGPM);
                            }
                            //echo "\nMonthly Water Consumption of BASELIE(GPM) = ".$baseGPM;
                            if ($baseGPM != "error" && $ProdGPM != "error") {
                                $diff = $baseGPM - $ProdGPM;
                                $waterCalcsDetail['W_TDF_R'] =  $diff;
                                //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                                $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                                $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                                array_push($CumulativeCost, $costSaving);
                                array_push($CumulativeGPM, $diff);
                                $showEnergyChart++;
                            }
                            break;
                        } catch (Exception $e) {
                            header("Location: errorpage.php");
                        }

                    case "W_TSF_R":

                        $mathStringProdGallon = str_replace('residential_household_member', $residential_household_member, $formula[$w]);
                        $mathStringProdGallon = str_replace('hrs_a_day', $hrs_a_day, $mathStringProdGallon);
                        $mathStringProdGallon = str_replace('FLUSH_RATE', $FLUSH_RATE, $mathStringProdGallon);

                        $ProdGPM = calculate_string($mathStringProdGallon);
                        if ($ProdGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['FLUSH_RATE'] = $FLUSH_RATE;
                        } else {
                            $ProdGPM = round($ProdGPM);
                        }
                        $baseGPM = str_replace($FLUSH_RATE, $base_FLUSH_RATE, $mathStringProdGallon);
                        //$baseGPM = str_replace("0.9", "1.6", $baseGPM);

                        $baseGPM = calculate_string($baseGPM);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_FLUSH_RATE'] = $base_FLUSH_RATE;
                        } else {
                            $baseGPM = round($baseGPM);
                        }
                        //echo "\nMonthly Water Consumption of BASELIE(GPM) = ".$baseGPM;
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_TSF_R'] =  $diff;
                            //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }
                        break;

                    case "W_FR":
                        // 30 x (# of Household Members x 4 x Flow Rate (GPM) x .5 minute duration)
                        $mathStringProdGallon = str_replace('residential_household_member', $residential_household_member, $formula[$w]);
                        $mathStringProdGallon = str_replace('FLOW_RATE', $FLOW_RATE, $mathStringProdGallon);


                        $ProdGPM = calculate_string($mathStringProdGallon);
                        if ($ProdGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['FLOW_RATE'] = $FLOW_RATE;
                        } else {
                            $ProdGPM = round($ProdGPM);
                        }
                        $baseGPM = str_replace($FLOW_RATE, $base_FLOW_RATE, $mathStringProdGallon);
                        //$baseGPM = str_replace("0.9", "1.6", $baseGPM);

                        $baseGPM = calculate_string($baseGPM);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_FLOW_RATE'] = $base_FLOW_RATE;
                        } else {
                            $baseGPM = round($baseGPM);
                        }
                        //echo "\nMonthly Water Consumption of BASELIE(GPM) = ".$baseGPM;
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_FR'] =  $diff;
                            //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }
                        break;

                    case "W_WR":  // Water:Washlet-Residental

                        $mathStringProdGallon = str_replace('residential_household_member', $residential_household_member, $formula[$w]);
                        $mathStringProdGallon = str_replace('uses_wk_value', $uses_wk_value, $mathStringProdGallon);
                        $mathStringProdGallon = str_replace('FLOW_RATE', $FLOW_RATE, $mathStringProdGallon);


                        $ProdGPM = calculate_string($mathStringProdGallon);
                        if ($ProdGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['FLOW_RATE'] = $FLOW_RATE;
                        } else {
                            $ProdGPM = round($ProdGPM);
                        }
                        $baseGPM = str_replace($FLOW_RATE, $base_FLOW_RATE, $mathStringProdGallon);


                        $baseGPM = calculate_string($baseGPM);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_FLOW_RATE'] = $base_FLOW_RATE;
                        } else {
                            $baseGPM = round($baseGPM);
                        }
                        //echo "\nMonthly Water Consumption of BASELIE(GPM) = ".$baseGPM;
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_WR'] =  $diff;
                            //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }
                        break;

                    case "W_SR":  // Water:Shower-Residental

                        $mathStringProdGallon = str_replace('residential_household_member', $residential_household_member, $formula[$w]);
                        $mathStringProdGallon = str_replace('FLOW_RATE', $FLOW_RATE, $mathStringProdGallon);

                        $ProdGPM = calculate_string($mathStringProdGallon);
                        if ($ProdGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['FLOW_RATE'] = $FLOW_RATE;
                        } else {
                            $ProdGPM = round($ProdGPM);
                        }

                        $baseGPM = str_replace($FLOW_RATE, $base_FLOW_RATE, $mathStringProdGallon);


                        $baseGPM = calculate_string($baseGPM);
                        if ($baseGPM == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_FLOW_RATE'] = $base_FLOW_RATE;
                        } else {
                            $baseGPM = round($baseGPM);
                        }
                        //echo "\nMonthly Water Consumption of BASELIE(GPM) = ".$baseGPM;
                        if ($baseGPM != "error" && $ProdGPM != "error") {
                            $diff = $baseGPM - $ProdGPM;
                            $waterCalcsDetail['W_SR'] =  $diff;
                            //echo "\nMonthly Water Savings over Baseline Product = ".$diff;
                            $costSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                            $productDetail[$p]['IndividualWaterCost'] =  $costSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                            array_push($CumulativeCost, $costSaving);
                            array_push($CumulativeGPM, $diff);
                            $showEnergyChart++;
                        }
                        break;


                    case "E_WR":  // Energy:Washlet-Residental
                        // 4.345 x 168 hr/wk X Energy Usage (W) x # of fixtures
                        $mathStringProdGallon = str_replace('QTY', $qty, $formula[$w]);
                        $mathStringProdGallon = str_replace('EU', $EU, $mathStringProdGallon);

                        $ProdEnergy = calculate_string($mathStringProdGallon);
                        if ($ProdEnergy == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['EU'] = $EU;
                            $ProdEnergy = 0;
                        } else {
                            $ProdEnergy = round($ProdEnergy);
                        }

                        $baseEnergy = str_replace($EU, $base_EU, $mathStringProdGallon);


                        $baseEnergy = calculate_string($baseEnergy);
                        if ($baseEnergy == "error") {
                            $baseEnergy = 0;
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_EU'] = $base_EU;
                        } else {
                            $baseEnergy = round($baseEnergy);
                        }
                       // if ($baseEnergy != "error" && $ProdEnergy != "error") {
                            $diff = $baseEnergy - $ProdEnergy;
                            $energyCalcsDetail['E_WR'] =  $diff;
                            $EnergyCostSaving = ($diff) * ($projectDetail['electricity_rate']);
                            $productDetail[$p]['IndividualEnergyCost'] =  $EnergyCostSaving;
                            $productDetail[$p]['IndividualEnergy'] =  $diff;

                            array_push($CumulativeEnergyCost, $EnergyCostSaving);
                            array_push($CumulativeEnergy, $diff);
                            $showEnergyChart++;
                      //  }
                        break;

                    // Default:
                    //echo "One or more of your products are missing values to complete your payback analysis.";
                } // Switch Ends
            }// Inner For loop ends
        }//Else IF ends
        else {
            
        }
        // SWITCH CASE FOR GENERAL CALCULATORS
        //echo "GENERAL";
        for ($n = 0; $n < count($formula); $n++) {
            //echo $prodcalCode[$n];
            switch ($prodcalCode[$n]) {

                case "E_LB":  // Energy:Light Bulb   // (4.345 * hrs_a_day * days_a_week * energy_usage  * qty)/1000

                    $MainMathStringProd = str_replace('hrs_a_day', $hrs_a_day, $formula[$n]);
                    $MainMathStringProd = str_replace('Days_a_week', $days_a_week, $MainMathStringProd);
                    $MainMathStringProd = str_replace('energy_usage', $EU, $MainMathStringProd);
                    $MainMathStringProd = str_replace('QTY', $qty, $MainMathStringProd);

                    $ProdEnergy = calculate_string($MainMathStringProd);
                    if ($ProdEnergy == "error") {
                        $ProdEnergy = 0;
                        $rejected_product_array[$productDetail[$p]['product_name']]['EU'] = $EU;
                    } else {
                        $ProdEnergy = round($ProdEnergy);
                    }

                    $BaseMathString = str_replace('hrs_a_day', $hrs_a_day, $formula[$n]);
                    $BaseMathString = str_replace('Days_a_week', $days_a_week, $BaseMathString);
                    $BaseMathString = str_replace('EU', $base_EU, $BaseMathString);
                    $BaseMathString = str_replace('QTY', $qty, $BaseMathString);

                    $baseEnergy = calculate_string($BaseMathString);
                    if ($baseEnergy == "error") {
                        $baseEnergy = 0;
                        $rejected_product_array[$productDetail[$p]['product_name']]['base_EU'] = $base_EU;
                    } else {
                        $baseEnergy = round($baseEnergy);
                    }
                   // if ($baseEnergy != "error" && $ProdEnergy != "error") {
                        $diff = $baseEnergy - $ProdEnergy;
                        $energyCalcsDetail['E_LB'] =  $diff;
                        $EnergyCostSaving = ($diff) * ($projectDetail['electricity_rate']);
                        $productDetail[$p]['IndividualEnergyCost'] =  $EnergyCostSaving;
                            $productDetail[$p]['IndividualEnergy'] =  $diff;


                        array_push($CumulativeEnergy, $diff);
                        array_push($CumulativeEnergyCost, $EnergyCostSaving);
                        $showEnergyChart++;
                   // }
                    break;

                case "E_LF":  // Energy:Light Fixtures  ;  // (4.345 * hrs_a_day * days_a_week * tip * qty)/1000
                    //----------------- MAIN Product Calculation
                    $MainMathStringProd = str_replace('hrs_a_day', $hrs_a_day, $formula[$n]);
                    $MainMathStringProd = str_replace('Days_a_week', $days_a_week, $MainMathStringProd);
                    $MainMathStringProd = str_replace('TIP', $TIP, $MainMathStringProd);
                    $MainMathStringProd = str_replace('QTY', $qty, $MainMathStringProd);

                    $ProdEnergy = calculate_string($MainMathStringProd);
                    if ($ProdEnergy == "error") {
                          $ProdEnergy = 0;
                        $rejected_product_array[$productDetail[$p]['product_name']]['TIP'] = $TIP;
                    } else {
                        $ProdEnergy = round($ProdEnergy);
                    }

                    //----------------- BASE Product Calculation     
                    $BaseMathString = str_replace('hrs_a_day', $hrs_a_day, $formula[$n]);
                    $BaseMathString = str_replace('Days_a_week', $days_a_week, $BaseMathString);
                    $BaseMathString = str_replace('TIP', $base_TIP, $BaseMathString);
                    $BaseMathString = str_replace('QTY', $qty, $BaseMathString);

                    $baseEnergy = calculate_string($BaseMathString);
                    if ($baseEnergy == "error") {
                         $baseEnergy = 0;
                        $rejected_product_array[$productDetail[$p]['product_name']]['base_TIP'] = $base_TIP;
                    } else {
                        $baseEnergy = round($baseEnergy);
                    }
                   // if ($baseEnergy != "error" && $ProdEnergy != "error") {
                        $diff = $baseEnergy - $ProdEnergy;
                        $energyCalcsDetail['E_LF'] =  $diff;
                        $EnergyCostSaving = ($diff) * ($projectDetail['electricity_rate']);
                        $productDetail[$p]['IndividualEnergyCost'] =  $EnergyCostSaving;
                        $productDetail[$p]['IndividualEnergy'] =  $diff;

                        array_push($CumulativeEnergyCost, $EnergyCostSaving);
                        array_push($CumulativeEnergy, $diff);
                        $showEnergyChart++;
                   // }
                    break;

                case "E_CW":  // Energy:Cloth Washer // (qty  * ( 4.345 * (uses_wk_value)) * ( energy_cycle ))
                    //----------------- MAIN Product Calculation
                    $MainMathStringProd = str_replace('QTY', $qty, $formula[$n]);
                    $MainMathStringProd = str_replace('uses_wk_value', $uses_wk_value, $MainMathStringProd);
                    $MainMathStringProd = str_replace('EUPC', $EUPC, $MainMathStringProd);
                    $ProdEnergy = calculate_string($MainMathStringProd);
                    if ($ProdEnergy == "error") {
                         $ProdEnergy = 0;
                        $rejected_product_array[$productDetail[$p]['product_name']]['EUPC'] = $EUPC;
                    } else {
                        $ProdEnergy = round($ProdEnergy);
                    }
                    //----------------- BASE Product Calculation                    
                    $BaseMathString = str_replace('QTY', $qty, $formula[$n]);
                    $BaseMathString = str_replace('uses_wk_value', $uses_wk_value, $BaseMathString);
                    $BaseMathString = str_replace('EUPC', $base_EUPC, $BaseMathString);

                    $baseEnergy = calculate_string($BaseMathString);
                    if ($baseEnergy == "error") {
                         $baseEnergy = 0;
                        $rejected_product_array[$productDetail[$p]['product_name']]['base_EUPC'] = $base_EUPC;
                    } else {
                        $baseEnergy = round($baseEnergy);
                    }
                   // if ($baseEnergy != "error" && $ProdEnergy != "error") {
                        $diff = $baseEnergy - $ProdEnergy;
                        $energyCalcsDetail['E_CW'] =  $diff;
                        $EnergyCostSaving = ($diff) * ($projectDetail['electricity_rate']);
                        $productDetail[$p]['IndividualEnergyCost'] =  $EnergyCostSaving;
                            $productDetail[$p]['IndividualEnergy'] =  $diff;

                        array_push($CumulativeEnergyCost, $EnergyCostSaving);
                        array_push($CumulativeEnergy, $diff);
                        $showEnergyChart++;
                   // }
                    break;

                case "E_DW":  // Energy:Dish Washer    // (qty  * ( 4.345 * (uses_wk_value)) * ( energy_cycle ))
                    //----------------- MAIN Product Calculation
                    $MainMathStringProd = str_replace('QTY', $qty, $formula[$n]);
                    $MainMathStringProd = str_replace('uses_wk_value', $uses_wk_value, $MainMathStringProd);
                    $MainMathStringProd = str_replace('EUPC', $EUPC, $MainMathStringProd);
                    $ProdEnergy = calculate_string($MainMathStringProd);
                    if ($ProdEnergy == "error") {
                         $baseEnergy = 0;
                        $rejected_product_array[$productDetail[$p]['product_name']]['EUPC'] = $EUPC;
                    } else {
                        $ProdEnergy = round($ProdEnergy);
                    }

                    $BaseMathString = str_replace('QTY', $qty, $formula[$n]);
                    $BaseMathString = str_replace('uses_wk_value', $uses_wk_value, $BaseMathString);
                    $BaseMathString = str_replace('EUPC', $base_EUPC, $BaseMathString);

                    $baseEnergy = calculate_string($BaseMathString);
                    if ($baseEnergy == "error") {
                         $baseEnergy = 0;
                        $rejected_product_array[$productDetail[$p]['product_name']]['base_EUPC'] = $base_EUPC;
                    } else {
                        $baseEnergy = round($baseEnergy);
                    }
                   // if ($baseEnergy != "error" && $ProdEnergy != "error") {
                        $diff = $baseEnergy - $ProdEnergy;
                         $energyCalcsDetail['E_DW'] =  $diff;
                        $EnergyCostSaving = ($diff) * ($projectDetail['electricity_rate']);
                        $productDetail[$p]['IndividualEnergyCost'] =  $EnergyCostSaving;
                            $productDetail[$p]['IndividualEnergy'] =  $diff;

                        array_push($CumulativeEnergyCost, $EnergyCostSaving);
                        array_push($CumulativeEnergy, $diff);
                        $showEnergyChart++;
                   // }
                    break;

                case "E_RF":  // Energy:Dish Washer // (qty  * enegry_annual)  
                    //----------------- MAIN Product Calculation
                    $MainMathStringProd = str_replace('QTY', $qty, $formula[$n]);
                    $MainMathStringProd = str_replace('AEU', $AEU, $MainMathStringProd);

                    $ProdEnergy = calculate_string($MainMathStringProd);
                    if ($ProdEnergy == "error") {
                         $ProdEnergy = 0;
                        $rejected_product_array[$productDetail[$p]['product_name']]['AEU'] = $AEU;
                    } else {
                        $ProdEnergy = round($ProdEnergy);
                    }
                    //----------------- BASE Product Calculation
                    $BaseMathString = str_replace('QTY', $qty, $formula[$n]);
                    $BaseMathString = str_replace('AEU', $base_AEU, $BaseMathString);

                    $baseEnergy = calculate_string($BaseMathString);
                    if ($baseEnergy == "error") {
                         $baseEnergy = 0;
                        $rejected_product_array[$productDetail[$p]['product_name']]['base_AEU'] = $base_AEU;
                    } else {
                        $baseEnergy = round($baseEnergy);
                    }
                  //  if ($baseEnergy != "error" && $ProdEnergy != "error") {
                        $diff = $baseEnergy - $ProdEnergy;
                         $energyCalcsDetail['E_RF'] =  $diff;
                        $EnergyCostSaving = ($diff) * ($projectDetail['electricity_rate']);
                        $productDetail[$p]['IndividualEnergyCost'] =  $EnergyCostSaving;
                            $productDetail[$p]['IndividualEnergy'] =  $diff;

                        array_push($CumulativeEnergyCost, $EnergyCostSaving);
                        array_push($CumulativeEnergy, $diff);
                        $showEnergyChart++;
                  //  }
                    break;

                case "W_CW":  // WATER CLOTH WASHER   // (qty  * enegry_annual)
                    //----------------- MAIN Product Calculation
                    $MainMathStringProd = str_replace('QTY', $qty, $formula[$n]);
                    $MainMathStringProd = str_replace('uses_wk_value', $uses_wk_value, $MainMathStringProd);
                    $MainMathStringProd = str_replace('WUPC', $WUPC, $MainMathStringProd);

                    $ProdWaterCycle = calculate_string($MainMathStringProd);
                    if ($ProdWaterCycle == "error") {
                       
                        $rejected_product_array[$productDetail[$p]['product_name']]['WUPC'] = $WUPC;
                    } else {
                        $ProdWaterCycle = round($ProdWaterCycle);
                    }

                    //----------------- BASE Product Calculation
                    $BaseMathString = str_replace('QTY', $qty, $formula[$n]);
                    $BaseMathString = str_replace('uses_wk_value', $uses_wk_value, $BaseMathString);
                    $BaseMathString = str_replace('WUPC', $base_WUPC, $BaseMathString);


                    $baseWaterCycle = calculate_string($BaseMathString);
                    if ($baseWaterCycle == "error") {
                        $rejected_product_array[$productDetail[$p]['product_name']]['base_WUPC'] = $base_WUPC;
                    } else {
                        $baseWaterCycle = round($baseWaterCycle);
                    }
                    if ($baseWaterCycle != "error" && $ProdWaterCycle != "error") {
                        $diff = $baseWaterCycle - $ProdWaterCycle;
                        $waterCalcsDetail['W_CW'] =  $diff;
                        $WaterCostSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                        $productDetail[$p]['IndividualWaterCost'] =  $WaterCostSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                        array_push($CumulativeCost, $WaterCostSaving);
                        array_push($CumulativeGPM, $diff);
                        $showEnergyChart++;
                    }
                    break;

                case "W_DW":  // WATER DISH WASHER  // (qty  * enegry_annual) 
                    //----------------- MAIN Product Calculation
                    $MainMathStringProd = str_replace('QTY', $qty, $formula[$n]);
                    $MainMathStringProd = str_replace('uses_wk_value', $uses_wk_value, $MainMathStringProd);
                    $MainMathStringProd = str_replace('WUPC', $WUPC, $MainMathStringProd);
                    $ProdWaterCycle = calculate_string($MainMathStringProd);
                    if ($ProdWaterCycle == "error") {
                        $rejected_product_array[$productDetail[$p]['product_name']]['WUPC'] = $WUPC;
                    } else {
                        $ProdWaterCycle = round($ProdWaterCycle);
                    }

                    //----------------- BASE Product Calculation
                    $BaseMathString = str_replace('QTY', $qty, $formula[$n]);
                    $BaseMathString = str_replace('uses_wk_value', $uses_wk_value, $BaseMathString);
                    $BaseMathString = str_replace('WUPC', $base_WUPC, $BaseMathString);

                    $baseWaterCycle = calculate_string($BaseMathString);
                    if ($baseWaterCycle == "error") {
                        $rejected_product_array[$productDetail[$p]['product_name']]['base_WUPC'] = $base_WUPC;
                    } else {
                        $baseWaterCycle = round($baseWaterCycle);
                    }
                    if ($baseWaterCycle != "error" && $ProdWaterCycle != "error") {
                        $diff = $baseWaterCycle - $ProdWaterCycle;
                        $waterCalcsDetail['W_DW'] =  $diff;
                        $WaterCostSaving = ($diff / 1000) * ($projectDetail['water_rate']);
                         $productDetail[$p]['IndividualWaterCost'] =  $WaterCostSaving;
                            $productDetail[$p]['IndividualWater'] =  $diff;

                        array_push($CumulativeCost, $WaterCostSaving);
                        array_push($CumulativeGPM, $diff);
                        $showEnergyChart++;
                    }
                    break;


                case "LC_MMC": // LifeCycle: Monthly Maintenance Cost# of Units x Monthly maintenance costs
                   
                    try {
                        //----------------- MAIN Product Calculation
                        $MainMathStringProd = str_replace('QTY', $qty, $formula[$n]);
                        $MainMathStringProd = str_replace('MMC', $MMC, $MainMathStringProd);

                        //echo "MAIN-PROD".$MainMathStringProd;
                        $ProdLC = calculate_string($MainMathStringProd);
                        if ($ProdLC == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['MMC'] = $MMC;
                        } else {
                            $ProdLC = round($ProdLC);
                        }

                        //----------------- BASE Product Calculation
                        $BaseMathString = str_replace('QTY', $qty, $formula[$n]);
                        $BaseMathString = str_replace('MMC', $base_MMC, $BaseMathString);
                        //echo "BASE-PROD". $BaseMathString; die;

                        $baseLC = calculate_string($BaseMathString);
//                           print_r("<pre>");
//                    print_r("mmc".$baseLC);
//                    print_r("</pre>");
                  //  die;
                    //die;
                        if ($baseLC == "error") {
                            $rejected_product_array[$productDetail[$p]['product_name']]['base_MMC'] = $base_MMC;
                        } else {
                            $baseLC = round($baseLC);
                        }
                       // if ($ProdLC != "error" && $baseLC != "error") {
                            $diff = $baseLC - $ProdLC;
                            $lifecycleCalcsDetail['LC_MMC'] =  $diff;
                            $LifeCycleCostSaving = ($diff);
                             $productDetail[$p]['IndividualLifecycleCost'][] =  $LifeCycleCostSaving;
                            $productDetail[$p]['IndividualLifecycle'] =  $diff;
                            array_push($CumulativeLifeCycleCost, $LifeCycleCostSaving);
                            array_push($CumulativeLifeCycle, $diff);
                            $showEnergyChart++;
                       // }
                        break;
                    } catch (Exception $e) {
                        trigger_error("Value must be 1 or below", E_USER_WARNING);
                    }

                case "LC_EcoPower":  //LifeCycle: ecoPower - Monthly battery replacement costs
                    //# of Units x Monthly Battery Replacement Costs
                    //----------------- MAIN Product Calculation
                    $MainMathStringProd = str_replace('QTY', $qty, $formula[$n]);
                    $MainMathStringProd = str_replace('BAT_REP_SAV', $BAT_REP_SAV, $MainMathStringProd);
                    //echo "MAIN-PROD".$MainMathStringProd;

                    $ProdLC = calculate_string($MainMathStringProd);
                   
                    if ($ProdLC == "error") {
                        $rejected_product_array[$productDetail[$p]['product_name']]['BAT_REP_SAV'] = $BAT_REP_SAV;
                    } else {
                        $ProdLC = round($ProdLC);
                    }

                    //----------------- BASE Product Calculation
                    $BaseMathString = str_replace('QTY', $qty, $formula[$n]);
                    $BaseMathString = str_replace('BAT_REP_SAV', $base_BAT_REP_SAV, $BaseMathString);
//   print_r("<pre>");
//                    print_r($productDetail[$p]);
//                    print_r("</pre>");
//                        print_r("<pre>");
//                    print_r($BAT_REP_SAV);
//                    print_r("</pre>");
//                    print_r("<pre>");
//                    print_r($base_BAT_REP_SAV);
//                    print_r("</pre>");
//                     print_r("<pre>");
//                    print_r($ProdLC);
//                    print_r("</pre>");
//                     print_r("<pre>");
//                    print_r($BaseMathString);
//                    print_r("</pre>");
//                   
                    //echo "BASE-PROD". $BaseMathString; die;


                    $baseLC = calculate_string($BaseMathString);
                   
                    if ($baseLC == "error") {
                        $rejected_product_array[$productDetail[$p]['product_name']]['base_BAT_REP_SAV'] = $base_BAT_REP_SAV;
                    } else {
                        $baseLC = round($baseLC);
                    }
                  //  if ($ProdLC != "error" && $baseLC != "error") {
                        $diff = $baseLC - $ProdLC;
                        $lifecycleCalcsDetail['LC_EcoPower'] =  $diff;
//                         print_r("<pre>");
//                    print_r($diff);
//                    print_r("</pre>");
//                    die;
                        $LifeCycleCostSaving = ($diff);
                          $productDetail[$p]['IndividualLifecycleCost'][] =  $LifeCycleCostSaving;
                          
                            $productDetail[$p]['IndividualLifecycle'] =  $diff;
                        array_push($CumulativeLifeCycleCost, $LifeCycleCostSaving);
                        array_push($CumulativeLifeCycle, $diff);
                        $showEnergyChart++;
                   // }
                    break;

                case "LC_BR":  //LifeCycle: Bulb Replacement Month // bulb_life/(hrs_a_day*days_a_week*4.345)
                    //----------------- MAIN Product Calculation
                    $MainMathStringProd = str_replace('BULB_LIFE', $BULB_LIFE, $formula[$n]);
                    $MainMathStringProd = str_replace('hrs_a_day', $hrs_a_day, $MainMathStringProd);
                    $MainMathStringProd = str_replace('Days_a_week', $days_a_week, $MainMathStringProd);
                    $ProdLC = calculate_string($MainMathStringProd);
                    if ($ProdLC == "error") {
                        $rejected_product_array[$productDetail[$p]['product_name']]['BULB_LIFE'] = $BULB_LIFE;
                    } else {
                        $ProdLC = round($ProdLC);
                    }

                    $BaseMathString = str_replace('BULB_LIFE', $base_BULB_LIFE, $formula[$n]);
                    $BaseMathString = str_replace('hrs_a_day', $hrs_a_day, $BaseMathString);
                    $BaseMathString = str_replace('Days_a_week', $days_a_week, $BaseMathString);
                    $baseLC = calculate_string($BaseMathString);
                    if ($baseLC == "error") {
                        $rejected_product_array[$productDetail[$p]['product_name']]['base_BULB_LIFE'] = $base_BULB_LIFE;
                    } else {
                        $baseLC = round($baseLC);
                    }

                   // if ($ProdLC != "error" && $baseLC != "error") {
                        $diff = ($baseLC - $ProdLC);
                        $lifecycleCalcsDetail['LC_BR'] =  $diff;
                        $LifeCycleCostSaving = ($diff);
                           $productDetail[$p]['IndividualLifecycleCost'][] =  $LifeCycleCostSaving;
                           
                            $productDetail[$p]['IndividualLifecycle'] =  $diff;
                        array_push($CumulativeLifeCycleCost, $LifeCycleCostSaving);
                        array_push($CumulativeLifeCycle, $diff);
                        $showEnergyChart++;
                   // }

                    break;

                //Default:
                //echo "One or more of your products are missing values to complete your payback analysis.";
            }
        }
        
         $productDetail[$p]['leedCalcsDetail'] =  $leedCalcsDetail;
          $productDetail[$p]['energyCalcsDetail'] =  $energyCalcsDetail;
           $productDetail[$p]['waterCalcsDetail'] =  $waterCalcsDetail;
          $productDetail[$p]['lifecycleCalcsDetail'] =  $lifecycleCalcsDetail;
       
    }
    //// Main FOR loop ends
} catch (Exception $e) {
    echo 'Caught exception: ', $e->getMessage(), "\n";
} 
//die;
       
//  print_r("LEED_NC_2009_WEp1OP_TOTAL--".$LEED_NC_2009_WEp1OP_TOTAL); echo "</br>";
//    print_r("LEED_NC_2009_WEc3OP_TOTAL--".$LEED_NC_2009_WEc3OP_TOTAL); echo "</br>";
//    print_r("LEED_NC_2009_MRc4OP_TOTAL--".$LEED_NC_2009_MRc4OP_TOTAL); echo "</br>";
//    print_r("LEED_NC_2009_MRc5OP_TOTAL--".$LEED_NC_2009_MRc5OP_TOTAL); echo "</br>";
//    print_r("LEED_NC_2009_MRc6OP_TOTAL--".$LEED_NC_2009_MRc6OP_TOTAL); echo "</br>";
//    print_r("LEED_NC_2009_MRc7OP_TOTAL--".$LEED_NC_2009_MRc7OP_TOTAL); echo "</br>";
//    
//     if (($LEED_NC_2009_WEc3OP_TOTAL == "" || $LEED_NC_2009_WEc3OP_TOTAL == "-") && ($LEED_NC_2009_WEp1OP_TOTAL == "" || $LEED_NC_2009_WEp1OP_TOTAL == "-") && ($LEED_NC_2009_IEQc44OP_TOTAL == "" || $LEED_NC_2009_IEQc44OP_TOTAL == "-") && ($LEED_NC_2009_MRc7OP_TOTAL == "" || $LEED_NC_2009_MRc7OP_TOTAL == "-") && ($LEED_NC_2009_MRc6OP_TOTAL == "" || $LEED_NC_2009_MRc6OP_TOTAL == "-") && ($LEED_NC_2009_MRc5OP_TOTAL == "" || $LEED_NC_2009_MRc5OP_TOTAL == "-") && ($LEED_NC_2009_MRc4OP_TOTAL == "" || $LEED_NC_2009_MRc4OP_TOTAL == "-")) { echo 'display:none;';  } 
//    die;
// FINAL WATER VALUES
$allProdCOST = array_sum($CumulativeCost);
$allProdGPM = array_sum($CumulativeGPM);

// FINAL ENERGY VALUES
$allProdEnergyCost = array_sum($CumulativeEnergyCost);
$allProdEnergy = array_sum($CumulativeEnergy);

// FINAL LIFECYCLE VALUES

$allProdLifeCycleCost = array_sum($CumulativeLifeCycleCost);
$allProdLifeCycle = array_sum($CumulativeLifeCycle);

//-----------------------------------------------SET VALUES FOR ROI---------------------------------------------------
// Calculate the product and baseline values for total investment based on existing/updated values by user
for ($r = 0; $r < count($productDetail); $r++) {

    if (array_key_exists('prod_updated_price', $productDetail[$r]) && $productDetail[$r]['prod_updated_price'] != '') {
        //echo $productDetail[$r]['prod_updated_price'] . "X". $qtyUsesWKInfo[$r]['qty_value'];
        $FcInv[] = $productDetail[$r]['prod_updated_price'] * $qtyUsesWKInfo[$r]['qty_value'];
    } else {

        $FcInv[] = $productDetail[$r]['purchase_price'] * $qtyUsesWKInfo[$r]['qty_value'];
    }

    if (array_key_exists('base_updated_price', $productDetail[$r]) && $productDetail[$r]['base_updated_price'] != '')
        $BaseInv[] = $productDetail[$r]["base_updated_price"] * $qtyUsesWKInfo[$r]['qty_value'];
    else
        $BaseInv[] = $productDetail[$r]['baseline_info']["purchase_price"] * $qtyUsesWKInfo[$r]['qty_value'];
}

$Prod_Investment = array_sum($FcInv); //echo "<br>ProdInv::".$Prod_Investment;
$Base_Investment = array_sum($BaseInv); //echo "<br>BaseInv::".$Base_Investment;

$Total_Investment = $Prod_Investment - $Base_Investment;

$Total_Payaback = $allProdCOST + $allProdEnergyCost + $allProdLifeCycleCost;

$allWaterCost = $allProdCOST;
$allEnergyCost = $allProdEnergyCost;
$allLifeCycleCost = $allProdLifeCycleCost;

//$sumWaterCost[] = $allProdCOST;
//$sumEnergyCost[] = $allProdEnergyCost;
//$sumLifeCycle[] = $allProdLifeCycleCost;
//--------------------------------------------------- CALCUATE PAYBACK YR

$comboCost = -$Total_Investment;
$waterPB = $allProdCOST;
$waterPayback = $allProdCOST;

$energyPB = $allProdEnergyCost;
$sumEnergyPbCOst = $allProdEnergyCost;

$lifecyclePB = $allProdLifeCycleCost;
$pos = 0;
$pbYr = 0;
$pbMnth = 0;
$mPos = 0;
$sumWaterPbCOst = array();
$sumEnergyPbCOst = array();

$water_inflation = $projectDetail['water_inflation'] / 100;
$energy_inflation = $projectDetail['electricity_inflation'] / 100;
// Iterates through the values for PAYBACK
for ($y = 0; $y <= 30; $y++) {

    $waterPB = $waterPB * (1 + $water_inflation);
    $energyPB = $energyPB * (1 + $energy_inflation);
    $lifecyclePB = $lifecyclePB;
    //echo "<br>WaterPB : ". $waterPB . "||";

    for ($m = 0; $m <= 12; $m++) {
        $comboCost = $comboCost + ($waterPB + $energyPB + $lifecyclePB);
        //echo $comboCost."<br>|COMBO|";
        $mPos = $mPos + 1;
        //echo $mPos."|POS|<br>";
        if ($comboCost > -1 && $pbMnth == 0) {

            $mPosSet = $mPos;
            $pbMnth++;
        }
    }
}

$pbYr = number_format($mPosSet / 12, 1);

// Iterates through the values for ROI based on Length of analysis
$comboCost = -$Total_Investment;
$waterPB = $allProdCOST;
$energyPB = $allProdEnergyCost;
$sumEnergyPbCOst = $allProdEnergyCost;

$lifecyclePB = $allProdLifeCycleCost;

for ($y = 0; $y < $LOA; $y++) {
//$projectDetail['water_rate']\
    //echo "<br> WPB yr:".$y+1; echo "<br>PB".$waterPB."||";
    $waterPB = $waterPB * (1 + $water_inflation);
    $energyPB = $energyPB * (1 + $energy_inflation);
    $lifecyclePB = $lifecyclePB;

    //echo "<br>WPB yr: $y :". $waterPB . "||";

    $sumWaterCost[] = $waterPB * 12;
    $sumEnergyCost[] = $energyPB * 12;
    $sumLifeCycle[] = $lifecyclePB * 12;
    for ($m = 0; $m < 12; $m++) {

        $comboCost = $comboCost + ($waterPB + $energyPB + $lifecyclePB);
    }
}
//print_r($allProdLifeCycleCost);
//die;
// ---------------------------------------------------- CALCULATE TOTAL PAYBACK
//echo "WPB COST::". (array_sum($sumWaterCost));
//        echo "<br>WPB::". 12*array_sum($sumWaterCost);
//        echo "<br>EPB::". 12*array_sum($sumEnergyCost);
//echo "<br>LPB::". array_sum($sumLifeCycle);
//if($water_inflation > 0){
//    $totalWaterCost = $LOA*array_sum($sumWaterCost);
//}
//else{
//     $totalWaterCost = 12*array_sum($sumWaterCost);
//}
//
//if($energy_inflation > 0){
//    $totalEnergyCost = $LOA*array_sum($sumEnergyCost);
//}
//else{
//    
//   $totalEnergyCost = 12*array_sum($sumEnergyCost);
//}
//
//$tpb = $totalWaterCost+ $totalEnergyCost+ 12*array_sum($sumLifeCycle);

$tpb = array_sum($sumWaterCost) + array_sum($sumEnergyCost) + array_sum($sumLifeCycle);
//echo "TPB:".$tpb;
// ----------------------------------------------------- CALCULATE ROI
$ROI = ($tpb - $Total_Investment) / $Total_Investment * 100;

//$Total_Payaback = array_sum($sumWaterCost)+ array_sum($sumEnergyCost) + ($LOA*$lifecyclePB);
// ----------------------------------------------------- CONVERTS STRING TO NUMERIC FOR CALCULATION

function calculate_string($mathString, $projectDetail) {

    $mathString = trim($mathString);     // trim white spaces
    $mathString = preg_replace('[^0-9\+-\*\/\(\) ]', '', $mathString);    // remove any non-numbers chars; exception for math operators

    $compute = create_function("", "return (" . $mathString . ");");
    if ($compute > -1) {
        return 0 + $compute();
    } else {
        return "error";
        //die(header("LOCATION:/payback-analysis/paybackerror"));
    }
}

//-----------------------------------------Calculation Ends-------------------------
?>
<script src="http://code.highcharts.com/highcharts.js"></script>

<div class="container">
    <div class="content">
        <div class="analysis-block">
               <!-- Projrct Header << --->
<?php
$objProject = new Default_Model_Project();

$query1 = explode("/", $_SERVER['REQUEST_URI']);

if (in_array("product-config", $query1)) {
    $c1 = 'pro-list-tab active';
    if (in_array("pid", $query1)) {
        $projId = end($query1);
        $projInfoById = $objProject->fetchProjectInfoById($projId);
        $projInfoById['project_type'];
    }
} else {
    $c1 = 'pro-list-tab';
}

if (in_array("configuration", $query1)) {
    $c2 = 'pro-conf-tab active';
    if (in_array("pid", $query1)) {
        $projId = end($query1);
        $projInfoById = $objProject->fetchProjectInfoById($projId);
    }
} else {
    $c2 = 'pro-conf-tab';
}

if (in_array("payback-analysis", $query1)) {
    $c3 = 'pay-anly-tab active';
    if (in_array("pid", $query1)) {
        $projId = end($query1);
        $projInfoById = $objProject->fetchProjectInfoById($projId);
        $projInfoById['project_type'];
    }
} else {
    $c3 = 'pay-anly-tab';
}
?>

            <style>
                .leed-area {    background-color: #fff;color: #4d4d4d;font-family: "Gotham SSm A","Gotham SSm B" !important;}
                .leed-area-table td.first-col {    width: 76%;   }
                .leed-area-table td.first-col-heading { font-style: normal !important; font-size: 16px !important; padding: 4px 0;}
                /*.leed-area-table span{    font-style:italic;}*/
                .leed-title{ font-size: 18px; font-weight: bold; font-style: italic;}
/*                .leed-area-table tr {
                    border-bottom: 1px dotted;
                }*/
                .leed-area-table    { width: 100%;}
                .leed-area-table td{ padding-top: 18px; padding-bottom: 15px;}
                /*.leed-area { width: 100%;}*/
                .leed-area-table td:last-child {text-align: right;}
                .leed-logo{ text-align: left!important;}
                .line-bottom{border-bottom: 1px solid #b3b3b3;}
                .line-top{border-top: 1px solid #b3b3b3;}
                .leed-heading{color: #4d4d4d; font-size: 21px;}
                .overall-heading    { font-size: 30px; text-align: center; padding-top: 10px; color: #000;}
                .col-img    { width: 119px; height: 119px; border: #dadada solid 1px;}
                .lead-area-heading-inner    { font-size: 21px; }
                .leed-area-table-inner-first { margin-left: 20px;}
                /*.leed-area-table-inner-img { margin-right: 15px;}*/
                .leed-area-table-inner-first tr td { padding: 0;}
                .leed-area-table-inner-second tr td { padding-top: 0; padding-bottom: 0;}
                .leed-area-table-inner-second-heading   { padding-bottom: 0px!important; font-size: 18px; text-align: left!important;}
                .lead-inner-second-col{display: inline-block;    width: 93%;  padding-bottom: 5px; }
                .lead-heading-main{ padding-left: 35px;}
                .loop-table-lead    { margin-top: 15px;}
            </style>


             

            <div class="product-tabs">
                <a href="<?php if (!empty($projId)) {
    echo "/project/configuration/type/" . $projInfoById['project_type'] . "/pid/" . $projId;
} else {
    echo "/project/analysis";
} ?>" class="pro-list-tab ">1. PROJECT SETUP</a>
                <a href="/product-config<?php if (!empty($projId)) {
    echo "/index/pid/" . $projId;
} ?>" class="pro-list-tab">2. PRODUCT SETUP</a>
                <a href="/payback-analysis<?php if (!empty($projId)) {
                echo "/index/pid/" . $projId;
            } ?>" class="pro-list-tab active">3. PROJECT ANALYSIS</a>
            </div>
            <!-- Project Header >> -->

            <span style='display: table;margin: 20px auto;width: 30%;'>
                <a style="margin: 0 4px 0 0; float: left; text-decoration: none;" href="/product-config/index/pid/<?php echo $this->pid; ?>"><div class="gray-button">BACK</div></a>
            <?php if ($sessUser->fname == 'Dummy') { ?>
                    <a style="margin: 0 4px 0 0; float: left; text-decoration: none;" href="/login/account"><div class="gray-button">SAVE</div></a>
            <?php } else { ?>
                    <a style="margin: 0 4px 0 0; float: left; text-decoration: none;" href="/payback-analysis/savepayback/pid/<?php echo $this->pid; ?>/savings/<?php echo 12 * $LOA * $Total_Payaback; ?>/energy/<?php echo 12 * $LOA * $allProdEnergy; ?>/water/<?php echo 12 * $LOA * $allProdGPM; ?> ">
                        <div class="gray-button">SAVE</div>
                    </a>
            <?php }
            ?>
                <a><img src="/images/next_inactive.png"/></a>
<!--                <a href="/payback-analysis/indexexport/pid/<?php// echo $this->pid; ?>">
                    <img alt="export" src="/images/frontPanel/exportpdf.png">
                </a>-->
            </span>

            <div class="analysis-area-block">
               
                <div class="analysis-counter">
<!--                    <div class="counter-month">
                        <div class="counter-area">
                            <span><?php //if ($pbYr > 30) echo "30 >";
        //    else echo $pbYr; ?></span>
                            <span>yrs</span>
                        </div>
                        <div class="counter-label">
                            <span>PAYBACK</span><span style="margin: 0px 0px 0px 21px;">Yrs</span>
                        </div>
                        
                    </div>
                    <div class="counter-month">
                        <div class="counter-area">
                            <span><?php //echo round($ROI); ?></span>
                            <span>%</span>
                        </div>
                        <div class="counter-label">
                            <span>ROI</span><span style="margin: 0px 0px 0px 7px;">%</span>
                        </div>
                    </div>-->
        <div class="project-summary-box-1 boxreport">
            <span class="project-summary-box-name">Breakeven (Yrs)</span>
            <span class="project-summary-box-amount"><?php if ($pbYr > 30) echo "30 >";  else echo $pbYr; ?></span>
        </div>
        <div class="project-summary-box-2 boxreport">
            <span class="project-summary-box-name">Gallons Saved</span>
            <span class="project-summary-box-amount"><?php echo number_format(round(12 * $LOA * $allProdGPM)); ?></span>
        </div>
        <div class="project-summary-box-3 boxreport">
            <span class="project-summary-box-name">$ Saved</span>
            <span class="project-summary-box-amount"><?php
                        $WaterCost = array_sum($sumWaterCost);
                        $EnergyCost = array_sum($sumEnergyCost);
                        $lifeCycleCost = array_sum($sumLifeCycle);

                        echo "$".number_format(round(($EnergyCost + $WaterCost + $LOA * 12 * $allProdLifeCycleCost), 2));
                        ?></span>
        </div>
        
               
                <div class="analysis-area" style="display: table;    margin: 0 auto;    width: 99%;">
                    <div id="container" style="min-width: 260px; height: 400px; margin: 0 auto"></div>
                </div>
         
                <div class="report-icon">
                    <ul>
                        <li id="overall" class="attIcons selected"><a href="javascript:void(0);"><img src="/images/frontPanel/color.png" alt="color" /></a></li>

                        <!-- ENERGY --->
<?php if ($allProdEnergyCost > 0 || $allProdEnergy > 0) { ?>
                            <li id="Energy" class="attIcons">
                                <a href="javascript:void(0);" > <img src="/attributeImages/thumb/energy-report.png" alt="color" /></a>
                                    <?php } ?>

                        </li>

                        <!-- Water --->
<?php if ($allProdCOST > 0 || $allProdGPM > 0) { ?>
                            <li id="Water" class="attIcons">
                                <a href="javascript:void(0);"><img src="/attributeImages/thumb/th_Water.png" alt="color" /></a></li>
<?php } ?>

                        <!-- Life Cycle --->
                        <?php if ($allProdLifeCycleCost > 0 || $allProdLifeCycle > 0) { ?>        
                            <li id="Lifecycle" class="attIcons">
                                <a href="javascript:void(0);"><img src="/attributeImages/thumb/th_LifeCycle.png" alt="color" /></a></li>
                            <?php } ?>
                            <?php if ($leedActive > 0) { ?>
                            <li id="Leed" class="attIcons" rel="#dialog" class="leed-area">
                                <a href="javascript:void(0);"><img  height="36px"  width="36px" src="/images/frontPanel/leed.png" alt="color" /></a>
                            </li>
                        <?php } ?>      
<!--                <li id="Human" class="attIcons"><a href="javascript:void(0);"><img src="/images/frontPanel/man-report.png" alt="color" /></a></li>
                <li id="Planet" class="attIcons"><a href="javascript:void(0);"><img src="/images/frontPanel/map-report-pba.png" alt="color" /></a></li>-->
                    </ul>
                </div>
                <div class="leed-area"  style="display: none;border-radius: 10px 10px 10px 10px;padding: 10px 10px 10px 15px;font-family: PT Sans;">
                    <h1 class="overall-heading">PROJECT ANALYSIS</h1>
                    <table class="leed-area-table" style="display: block;">
                        <tr>
                             <td class="leed-proj-td">Project Name</td>
                                <td  class="leed-title"><?php echo $projectDetail['project_name']; ?></td>
                        </tr>
                        <tr>
                                <td class="leed-proj-td">Project Location</td>
                                <td  class="leed-title"><?php echo ucfirst($projectDetail['city']).", ".ucfirst($projectDetail['state']).", ".$projectDetail['zip']; ?></td>
                        </tr>
                        <tr>
                                <td class="leed-proj-td">Project Size</td>
                                <td  class="leed-title"><?php echo number_format($projectDetail['commertial_size']); ?></td>
                        </tr>
                        <tr>
                                <td class="leed-proj-td">Date of Analysis</td>
                                <td class="leed-title"><?php  echo date("F d, Y", time()); //echo date("F d, Y", strtotime($projectDetail['created_date'])); ?></td>
                        </tr>
                        <tr>
                            <td colspan="2" class="leed-area-table-inner-second-heading" ><a class="leed-area-table-inner-img"><img  height="50px"  width="50px" src="/images/frontPanel/leed.png" alt="color" /></a><span class="line-bottom lead-inner-second-col">Project LEED Credit Contribution Summary</span></td>
<!--                            <td></td>-->
<!--                            <td class="leed-title"></td>-->
                        </tr>
                       
                <tr class="line-bottom line-top">
<?php if ($totalProductMaterialCost > 0) { ?>
    <td  class="" style="font-weight: bold;font-size: 16px;" >
      Total Product Material Cost
    </td>
    <td><span> <?php echo "$".number_format(round($totalProductMaterialCost)); ?></span></td>
                        </tr>
                         <?php for ($p = 0; $p < count($productDetail); $p++) { ?>
                        <?php if($productDetail[$p]['totalProductMaterialCost'] != "" || $productDetail[$p]['totalProductMaterialCost']!= 0){ ?>
                        <tr>
                                <td><?php  echo $productDetail[$p]['product_name']; ?></td>
                                <td class=""><?php  echo "$".number_format(round(intval($productDetail[$p]['totalProductMaterialCost']))); ?></td>
                        </tr>
                         <?php } ?>
                        <?php  } ?>
                             <?php } ?>

<!--                         <tr>
                             <td class="first-col-heading" style="font-weight: bold;" colspan="2">LEED Credit Contribution Summary</td>
                             <td></td>
                        </tr>-->
<?php if (in_array('LEED NC 2009 - New Construction', $leedList)) { 
    
  
    ?>
                        <tr style="<?php if (($LEED_NC_2009_WEc3OP_TOTAL == "" || $LEED_NC_2009_WEc3OP_TOTAL == "-") && ($LEED_NC_2009_WEp1OP_TOTAL == "" || $LEED_NC_2009_WEp1OP_TOTAL == "-") && ($LEED_NC_2009_IEQc44OP_TOTAL == "" || $LEED_NC_2009_IEQc44OP_TOTAL == "-") && ($LEED_NC_2009_MRc7OP_TOTAL == "" || $LEED_NC_2009_MRc7OP_TOTAL == "-") && ($LEED_NC_2009_MRc6OP_TOTAL == "" || $LEED_NC_2009_MRc6OP_TOTAL == "-") && ($LEED_NC_2009_MRc5OP_TOTAL == "" || $LEED_NC_2009_MRc5OP_TOTAL == "-") && ($LEED_NC_2009_MRc4OP_TOTAL == "" || $LEED_NC_2009_MRc4OP_TOTAL == "-")) { echo 'display:none;';  }  ?>">
                            <td  class="first-col first-col-heading" style="font-weight: bold;" colspan="2">
                                LEED NC 2009 - New Construction
                            <td>
                        </tr>
                      
                        <tr class="line-bottom" style="<?php if (trim($LEED_NC_2009_WEp1OP_TOTAL) == "" || trim($LEED_NC_2009_WEp1OP_TOTAL) == "-") { echo 'display:none;';  }  ?>">
                           
                                <td class="first-col">
                                    <span>WEp1: Water Use Reduction - 20% Reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_NC_2009_WEp1OP_TOTAL)) {
        echo $LEED_NC_2009_WEp1OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                           <tr class="line-bottom" style="<?php if ($LEED_NC_2009_WEc3OP_TOTAL == "" || $LEED_NC_2009_WEc3OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                          
                                <td  class="first-col">
                                    <span>WEc3: Water Use Reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_NC_2009_WEc3OP_TOTAL)) {
        echo $LEED_NC_2009_WEc3OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                             <tr class="line-bottom" style="<?php if ($LEED_NC_2009_MRc4OP_TOTAL == "" || $LEED_NC_2009_MRc4OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td class="first-col">
                                <span>MRc4: Recycled Content</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_NC_2009_MRc4OP_TOTAL)) {
                                            echo "$" . number_format(round(intval($LEED_NC_2009_MRc4OP_TOTAL)));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_NC_2009_MRc5OP_TOTAL == "" || $LEED_NC_2009_MRc5OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc5: Regional Materials</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_NC_2009_MRc5OP_TOTAL)) {
                                            echo "$" . number_format(round(intval($LEED_NC_2009_MRc5OP_TOTAL)));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_NC_2009_MRc6OP_TOTAL == "" || $LEED_NC_2009_MRc6OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc6: Rapidly Renewable Materials</span>
                            </td>
                            <td  class="first-col">
                                    <span><?php
                                        if (isset($LEED_NC_2009_MRc6OP_TOTAL)) {
                                            echo "$" . number_format(round(intval($LEED_NC_2009_MRc6OP_TOTAL)));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_NC_2009_MRc7OP_TOTAL == "" || $LEED_NC_2009_MRc7OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc7: Certified Wood</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_NC_2009_MRc7OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_NC_2009_MRc7OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                        <tr class="line-bottom" style="<?php if ($LEED_NC_2009_IEQc44OP_TOTAL == "" || $LEED_NC_2009_IEQc44OP_TOTAL == "-") { echo 'display:none;';  }  ?>" >
                            <td  class="first-col">
                                <span>IEQc4.4: Low-Emitting Materials - Composite Wood and Agrifiber Products</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_NC_2009_IEQc44OP_TOTAL)) {
                     echo $LEED_NC_2009_IEQc44OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>
<?php } ?>
<?php if (in_array('LEED CI 2009 - Commercial Interiors', $leedList)) { ?>
                         <tr style="<?php if (($LEED_CI_2009_WEc1OP_TOTAL == "" || $LEED_CI_2009_WEc1OP_TOTAL == "-") && ($LEED_CI_2009_WEp1OP_TOTAL == "" || $LEED_CI_2009_WEp1OP_TOTAL == "-") && ($LEED_CI_2009_IEQc44OP_TOTAL == "" || $LEED_CI_2009_IEQc44OP_TOTAL == "-") && ($LEED_CI_2009_MRc7OP_TOTAL == "" || $LEED_CI_2009_MRc7OP_TOTAL == "-") && ($LEED_CI_2009_MRc6OP_TOTAL == "" || $LEED_CI_2009_MRc6OP_TOTAL == "-") && ($LEED_CI_2009_MRc5OP_TOTAL == "" || $LEED_CI_2009_MRc5OP_TOTAL == "-") && ($LEED_CI_2009_MRc4OP_TOTAL == "" || $LEED_CI_2009_MRc4OP_TOTAL == "-")) { echo 'display:none;';  }  ?>">
                            <td  class="first-col first-col-heading" style="font-weight: bold;" colspan="2">
                                LEED CI 2009 - Commercial Interiors
                            <td>
                        </tr>
                              <tr class="line-bottom" style="<?php if ($LEED_CI_2009_WEp1OP_TOTAL == "" || $LEED_CI_2009_WEp1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                                 <td class="first-col">
                                    <span>WEp1: Water Use Reduction - 20% Reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_CI_2009_WEp1OP_TOTAL)) {
        echo $LEED_CI_2009_WEp1OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                              <tr class="line-bottom" style="<?php if ($LEED_CI_2009_WEc1OP_TOTAL == "" || $LEED_CI_2009_WEc1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                                <td  class="first-col">
                                    <span>WEc1: Water Use Reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_CI_2009_WEc1OP_TOTAL)) {
        echo $LEED_CI_2009_WEc1OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                            
                            <tr class="line-bottom" style="<?php if ($LEED_CI_2009_MRc4OP_TOTAL == "" || $LEED_CI_2009_MRc4OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td class="first-col">
                                <span>MRc4: Recycled Content</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_CI_2009_MRc4OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_CI_2009_MRc4OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_CI_2009_MRc5OP_TOTAL == "" || $LEED_CI_2009_MRc5OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc5: Regional Materials</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_CI_2009_MRc5OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_CI_2009_MRc5OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_CI_2009_MRc6OP_TOTAL == "" || $LEED_CI_2009_MRc6OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc6: Rapidly Renewable Materials</span>
                            </td>
                            <td  class="first-col">
                                    <span><?php
                                        if (isset($LEED_CI_2009_MRc6OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_CI_2009_MRc6OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_CI_2009_MRc7OP_TOTAL == "" || $LEED_CI_2009_MRc7OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc7: Certified Wood</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_CI_2009_MRc7OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_CI_2009_MRc7OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_CI_2009_IEQc44OP_TOTAL == "" || $LEED_CI_2009_IEQc44OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>IEQc4.4: Low-Emitting Materials - Composite Wood and Agrifiber Products</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_CI_2009_IEQc44OP_TOTAL)) {
                     echo $LEED_CI_2009_IEQc44OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>
<?php } ?>
                                    <?php if (in_array('LEED EBOM 2009 - Existing Building Operations', $leedList)) { ?>
                         <tr style="<?php if (($LEED_EBOM_2009_WEc2OP_TOTAL == "" || $LEED_EBOM_2009_WEc2OP_TOTAL == "-") && ($LEED_EBOM_2009_WEp1OP_TOTAL == "" || $LEED_EBOM_2009_WEp1OP_TOTAL == "-") && ($LEED_EBOM_2009_MRc3OP_TOTAL == "" || $LEED_EBOM_2009_MRc3OP_TOTAL == "-")) { echo 'display:none;';  }  ?>">
                            <td  class="first-col first-col-heading" style="font-weight: bold;" colspan="2">
                                LEED EBOM 2009 - Existing Building Operations
                            <td>
                        </tr>
                             <tr class="line-bottom" style="<?php if ($LEED_EBOM_2009_WEp1OP_TOTAL == "" || $LEED_EBOM_2009_WEp1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                               <td class="first-col">
                                    <span>WEp1: Minimum Indoor Plumbing Fixture and Fitting Efficiency</span>
                                </td>
                                <td>
                                    <span><?php
                                        if (isset($LEED_EBOM_2009_WEp1OP_TOTAL)) {
                                            echo $LEED_EBOM_2009_WEp1OP_TOTAL;
                                        }
                                        ?></span>
                                </td>
                            </tr>
                             <tr class="line-bottom" style="<?php if ($LEED_EBOM_2009_WEc2OP_TOTAL == "" || $LEED_EBOM_2009_WEc2OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                               <td class="first-col">
                                    <span>WEc2: Additioal Indoor Plumbing Fixture and Fitting Efficiency</span>
                                </td>
                                <td>
                                    <span><?php
                                        if (isset($LEED_EBOM_2009_WEc2OP_TOTAL)) {
                                            echo $LEED_EBOM_2009_WEc2OP_TOTAL;
                                        }
                                        ?></span>
                                </td>
                            </tr>
                            
                             <tr class="line-bottom" style="<?php if ($LEED_EBOM_2009_MRc3OP_TOTAL == "" || $LEED_EBOM_2009_MRc3OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td class="first-col">
                                <span>MRc3: Sustainable Purchasing - Facility Alterations and additons</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_EBOM_2009_MRc3OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_EBOM_2009_MRc3OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
<?php } ?>
<?php if (in_array('LEED CS 2009 - Core & Shell', $leedList)) { ?>
                         <tr style="<?php if (($LEED_CS_2009_WEp1OP_TOTAL == "" || $LEED_CS_2009_WEp1OP_TOTAL == "-") && ($LEED_CS_2009_WEc2OP_TOTAL == "" || $LEED_CS_2009_WEc2OP_TOTAL == "-") && ($LEED_CS_2009_IEQc44OP_TOTAL == "" || $LEED_CS_2009_IEQc44OP_TOTAL == "-") && ($LEED_CS_2009_MRc6OP_TOTAL == "" || $LEED_CS_2009_MRc6OP_TOTAL == "-") && ($LEED_CS_2009_MRc5OP_TOTAL == "" || $LEED_CS_2009_MRc5OP_TOTAL == "-") && ($LEED_CS_2009_MRc4OP_TOTAL == "" || $LEED_CS_2009_MRc4OP_TOTAL == "-")) { echo 'display:none;';  }  ?>">
                            <td  class="first-col first-col-heading" style="font-weight: bold;" colspan="2">
                                LEED CS 2009 - Core & Shell
                            <td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_CS_2009_WEp1OP_TOTAL == "" || $LEED_CS_2009_WEp1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                                <td class="first-col">
                                    <span>WEp1: Water Use Reduction</span>
                                </td>
                                <td>
                                    <span><?php
                            if (isset($LEED_CS_2009_WEp1OP_TOTAL)) {
                                echo $LEED_CS_2009_WEp1OP_TOTAL;
                            }
                            ?></span>
                                </td>
                            </tr>
                           <tr class="line-bottom" style="<?php if ($LEED_CS_2009_WEc2OP_TOTAL == "" || $LEED_CS_2009_WEc2OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                               <td  class="first-col">
                                    <span>WEc3: Water Use Reduction</span>
                                </td>
                                <td>
                                    <span><?php
                                        if (isset($LEED_CS_2009_WEc2OP_TOTAL)) {
                                            echo $LEED_CS_2009_WEc2OP_TOTAL;
                                        }
                                        ?></span>
                                </td>
                            </tr>
                              <tr class="line-bottom" style="<?php if ($LEED_CS_2009_MRc4OP_TOTAL == "" || $LEED_CS_2009_MRc4OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td class="first-col">
                                <span>MRc4: Recycled Content</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_CS_2009_MRc4OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_CS_2009_MRc4OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_CS_2009_MRc5OP_TOTAL == "" || $LEED_CS_2009_MRc5OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc5: Regional Materials</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_CS_2009_MRc5OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_CS_2009_MRc5OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_CS_2009_MRc6OP_TOTAL == "" || $LEED_CS_2009_MRc6OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc6: Certified Wood</span>
                            </td>
                            <td  class="first-col">
                                    <span><?php
                                        if (isset($LEED_CS_2009_MRc6OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_CS_2009_MRc6OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_CS_2009_IEQc44OP_TOTAL == "" || $LEED_CS_2009_IEQc44OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>IEQc4.4: Low-Emitting Materials - Composite Wood and Agrifiber Products</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_CS_2009_IEQc44OP_TOTAL)) {
                     echo $LEED_CS_2009_IEQc44OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>

<?php } ?>
<?php if (in_array('LEED Schools 2009 - Schools', $leedList)) { ?>
                           <tr style="<?php if (($LEED_Schools_2009_WEc3OP_TOTAL == "" || $LEED_Schools_2009_WEc3OP_TOTAL == "-") && ($LEED_Schools_2009_WEp1OP_TOTAL == "" || $LEED_Schools_2009_WEp1OP_TOTAL == "-") && ($LEED_Schools_2009_IEQc46OP_TOTAL == "" || $LEED_Schools_2009_IEQc46OP_TOTAL == "-") && ($LEED_Schools_2009_IEQc44OP_TOTAL == "" || $LEED_Schools_2009_IEQc44OP_TOTAL == "-") && ($LEED_Schools_2009_MRc7OP_TOTAL == "" || $LEED_Schools_2009_MRc7OP_TOTAL == "-") && ($LEED_Schools_2009_MRc6OP_TOTAL == "" || $LEED_Schools_2009_MRc6OP_TOTAL == "-") && ($LEED_Schools_2009_MRc5OP_TOTAL == "" || $LEED_Schools_2009_MRc5OP_TOTAL == "-") && ($LEED_Schools_2009_MRc4OP_TOTAL == "" || $LEED_Schools_2009_MRc4OP_TOTAL == "-")) { echo 'display:none;';  }  ?>">
                            <td  class="first-col first-col-heading" style="font-weight: bold;" colspan="2">
                                LEED Schools 2009 - Schools
                            <td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_Schools_2009_WEp1OP_TOTAL == "" || $LEED_Schools_2009_WEp1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                                <td class="first-col">
                                    <span>WEp1: Water Use Reduction - 20% Reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_Schools_2009_WEp1OP_TOTAL)) {
        echo $LEED_Schools_2009_WEp1OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                              <tr class="line-bottom" style="<?php if ($LEED_Schools_2009_WEc3OP_TOTAL == "" || $LEED_Schools_2009_WEc3OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                               <td  class="first-col">
                                    <span>WEc3: Water Use Reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_Schools_2009_WEc3OP_TOTAL)) {
        echo $LEED_Schools_2009_WEc3OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                              <tr class="line-bottom" style="<?php if ($LEED_Schools_2009_MRc4OP_TOTAL == "" || $LEED_Schools_2009_MRc4OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td class="first-col">
                                <span>MRc4: Recycled Content</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_Schools_2009_MRc4OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_Schools_2009_MRc4OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_Schools_2009_MRc5OP_TOTAL == "" || $LEED_Schools_2009_MRc5OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc5: Regional Materials</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_Schools_2009_MRc5OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_Schools_2009_MRc5OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_Schools_2009_MRc6OP_TOTAL == "" || $LEED_Schools_2009_MRc6OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc6: Rapidly Renewable Materials</span>
                            </td>
                            <td  class="first-col">
                                    <span><?php
                                        if (isset($LEED_Schools_2009_MRc6OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_Schools_2009_MRc6OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_Schools_2009_MRc7OP_TOTAL == "" || $LEED_Schools_2009_MRc7OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc7: Certified Wood</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_Schools_2009_MRc7OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_Schools_2009_MRc7OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_Schools_2009_IEQc44OP_TOTAL == "" || $LEED_Schools_2009_IEQc44OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>IEQc4.4: Low-Emitting Materials - Composite Wood and Agrifiber Products</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_Schools_2009_IEQc44OP_TOTAL)) {
                     echo $LEED_Schools_2009_IEQc44OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_Schools_2009_IEQc46OP_TOTAL == "" || $LEED_Schools_2009_IEQc46OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>IEQc4.6: Low-Emitting- Ceiling and Wall Systems</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_Schools_2009_IEQc46OP_TOTAL)) {
                     echo $LEED_Schools_2009_IEQc46OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>

<?php } ?>
<?php if (in_array('LEED Healthcare 2009 - Healthcare', $leedList)) { ?>
                        <tr style="<?php if (($LEED_HC_2009_WEc3OP_TOTAL == "" || $LEED_HC_2009_WEc3OP_TOTAL == "-") && ($LEED_HC_2009_WEp1OP_TOTAL == "" || $LEED_HC_2009_WEp1OP_TOTAL == "-") && ($LEED_HC_2009_IEQc4OP_TOTAL == "" || $LEED_HC_2009_IEQc4OP_TOTAL == "-") && ($LEED_HC_2009_MRc3OP_TOTAL == "" || $LEED_HC_2009_MRc3OP_TOTAL == "-")) { echo 'display:none;';  }  ?>">
                            <td  class="first-col first-col-heading" style="font-weight: bold;" colspan="2">
                                LEED Healthcare 2009 - Healthcare
                            <td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_HC_2009_WEp1OP_TOTAL == "" || $LEED_HC_2009_WEp1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                               <td class="first-col">
                                    <span>WEp1: Water Use Reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_HC_2009_WEp1OP_TOTAL)) {
        echo $LEED_HC_2009_WEp1OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                             <tr class="line-bottom" style="<?php if ($LEED_HC_2009_WEc3OP_TOTAL == "" || $LEED_HC_2009_WEc3OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                               <td  class="first-col">
                                    <span>WEc3: Water Use Reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_HC_2009_WEc3OP_TOTAL)) {
        echo $LEED_HC_2009_WEc3OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                               <tr class="line-bottom" style="<?php if ($LEED_HC_2009_MRc3OP_TOTAL == "" || $LEED_HC_2009_MRc3OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td class="first-col">
                                <span>MRc3: Sustainably sourced materials and products</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_HC_2009_MRc3OP_TOTAL)) {
                                            echo "$" . number_format(round($LEED_HC_2009_MRc3OP_TOTAL));
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_HC_2009_IEQc4OP_TOTAL == "" || $LEED_HC_2009_IEQc4OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>IEQc4: Low-Emitting Materials</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_HC_2009_IEQc4OP_TOTAL)) {
                    echo $LEED_HC_2009_IEQc4OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>
                        <?php } ?>
                        <?php if (in_array('LEED NC v4 - New Construction', $leedList)) { ?>
                           <tr style="<?php if (($LEED_NC_v4_WEc2OP_TOTAL == "" || $LEED_NC_v4_WEc2OP_TOTAL == "-") && ($LEED_NC_v4_WEp2OP_TOTAL == "" || $LEED_NC_v4_WEp2OP_TOTAL == "-") && ($LEED_NC_v4_EQ2OP_TOTAL == "" || $LEED_NC_v4_EQ2OP_TOTAL == "-") && ($LEED_NC_v4_MRc4OP_TOTAL == "" || $LEED_NC_v4_MRc4OP_TOTAL == "-") && ($LEED_NC_v4_MRc3OP_TOTAL == "" || $LEED_NC_v4_MRc3OP_TOTAL == "-") && ($LEED_NC_v4_MRc2OP_TOTAL == "" || $LEED_NC_v4_MRc2OP_TOTAL == "-") && ($LEED_NC_v4_MRc1OP_TOTAL == "" || $LEED_NC_v4_MRc1OP_TOTAL == "-")) { echo 'display:none;';  }  ?>">
                            <td  class="first-col first-col-heading" style="font-weight: bold;" colspan="2">
                                LEED NC v4 - New Construction
                            <td>
                        </tr>
                              <tr class="line-bottom" style="<?php if ($LEED_NC_v4_WEp2OP_TOTAL == "" || $LEED_NC_v4_WEp2OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                               <td class="first-col">
                                    <span>WEp2: Indoor water use reduction</span>
                                </td>
                                <td>
                                    <span><?php
                                        if (isset($LEED_NC_v4_WEp2OP_TOTAL)) {
                                            echo $LEED_NC_v4_WEp2OP_TOTAL;
                                        }
                                        ?></span>
                                </td>
                            </tr>
                           <tr class="line-bottom" style="<?php if ($LEED_NC_v4_WEc2OP_TOTAL == "" || $LEED_NC_v4_WEc2OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                                  <td  class="first-col">
                                    <span>WEc2: Indoor water use reduction</span>
                                </td>
                                <td>
                                    <span><?php
                                        if (isset($LEED_NC_v4_WEc2OP_TOTAL)) {
                                            echo $LEED_NC_v4_WEc2OP_TOTAL;
                                        }
                                        ?></span>
                                </td>
                            </tr>
                                 <tr class="line-bottom" style="<?php if ($LEED_NC_v4_MRc1OP_TOTAL == "" || $LEED_NC_v4_MRc1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td class="first-col">
                                <span>MRc1: Building Life-Cycle Impact Reduction</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_NC_v4_MRc1OP_TOTAL)) {
                      echo $LEED_NC_v4_MRc1OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_NC_v4_MRc2OP_TOTAL == "" || $LEED_NC_v4_MRc2OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc2: Building Product Disclosure & Optimization - Environmental Product Declarations</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_NC_v4_MRc2OP_TOTAL)) {
                    echo $LEED_NC_v4_MRc2OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_NC_v4_MRc3OP_TOTAL == "" || $LEED_NC_v4_MRc3OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc3: Building Product Disclosure & Optimization - Sourcing of Raw Materials</span>
                            </td>
                            <td  class="first-col">
                                    <span><?php
                                        if (isset($LEED_NC_v4_MRc3OP_TOTAL)) {
                    echo $LEED_NC_v4_MRc3OP_TOTAL;                    
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_NC_v4_MRc4OP_TOTAL == "" || $LEED_NC_v4_MRc4OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc4: Building Product Disclosure & Optimization - Material Ingredients</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_NC_v4_MRc4OP_TOTAL)) {
                     echo $LEED_NC_v4_MRc4OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>
                            <tr class="line-bottom" style="<?php if ($LEED_NC_v4_EQ2OP_TOTAL == "" || $LEED_NC_v4_EQ2OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>EQc2: Low-Emitting Materials</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_NC_v4_EQ2OP_TOTAL)) {
                     echo $LEED_NC_v4_EQ2OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>

<?php } ?>
<?php if (in_array('LEED CI v4 - Commercial Interiors', $leedList)) { ?>
                            <tr style="<?php if (($LEED_CI_v4_WEc1OP_TOTAL == "" || $LEED_CI_v4_WEc1OP_TOTAL == "-") && ($LEED_CI_v4_WEp1OP_TOTAL == "" || $LEED_CI_v4_WEp1OP_TOTAL == "-") && ($LEED_CI_v4_EQ2OP_TOTAL == "" || $LEED_CI_v4_EQ2OP_TOTAL == "-") && ($LEED_CI_v4_MRc5OP_TOTAL == "" || $LEED_CI_v4_MRc5OP_TOTAL == "-") && ($LEED_CI_v4_MRc4OP_TOTAL == "" || $LEED_CI_v4_MRc4OP_TOTAL == "-") && ($LEED_CI_v4_MRc3OP_TOTAL == "" || $LEED_CI_v4_MRc3OP_TOTAL == "-")) { echo 'display:none;';  }  ?>">
                            <td  class="first-col first-col-heading" style="font-weight: bold;" colspan="2">
                                LEED CI v4 - Commercial Interiors
                            <td>
                        </tr>
                          <tr class="line-bottom" style="<?php if ($LEED_CI_v4_WEp1OP_TOTAL == "" || $LEED_CI_v4_WEp1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                             <td class="first-col">
                                    <span>WEp1: Indoor water use reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_CI_v4_WEp1OP_TOTAL)) {
        echo $LEED_CI_v4_WEp1OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                          <tr class="line-bottom" style="<?php if ($LEED_CI_v4_WEc1OP_TOTAL == "" || $LEED_CI_v4_WEc1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                               <td  class="first-col">
                                    <span>WEc1: Indoor water use reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_CI_v4_WEc1OP_TOTAL)) {
        echo $LEED_CI_v4_WEc1OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                              <tr class="line-bottom" style="<?php if ($LEED_CI_v4_MRc3OP_TOTAL == "" || $LEED_CI_v4_MRc3OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td class="first-col">
                                <span>MRc3: Building Product Disclosure & Optimization - Environmental Product Declaration</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_CI_v4_MRc3OP_TOTAL)) {
                      echo $LEED_CI_v4_MRc3OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>
                        <tr class="line-bottom" style="<?php if ($LEED_CI_v4_MRc4OP_TOTAL == "" || $LEED_CI_v4_MRc4OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc4: Building Product Disclosure & Optimization - Sourcing of Raw Materials</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_CI_v4_MRc4OP_TOTAL)) {
                    echo $LEED_CI_v4_MRc4OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>
                        <tr class="line-bottom" style="<?php if ($LEED_CI_v4_MRc5OP_TOTAL == "" || $LEED_CI_v4_MRc5OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>MRc5: Building Product Disclosure & Optimization - Material Ingredients</span>
                            </td>
                            <td  class="first-col">
                                    <span><?php
                                        if (isset($LEED_CI_v4_MRc5OP_TOTAL)) {
                    echo $LEED_CI_v4_MRc5OP_TOTAL;                    
                                        }
                                        ?></span>
                            </td>
                        </tr>
                        <tr class="line-bottom" style="<?php if ($LEED_CI_v4_EQ2OP_TOTAL == "" || $LEED_CI_v4_EQ2OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td  class="first-col">
                                <span>EQc2: Low-Emitting Materials</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_CI_v4_EQ2OP_TOTAL)) {
                     echo $LEED_CI_v4_EQ2OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>

<?php } ?>
<?php if (in_array('LEED EBOM v4 - Existing Buildings', $leedList)) { ?>
                            <tr style="<?php if (($LEED_EBOM_v4_WEc1OP_TOTAL == "" || $LEED_EBOM_v4_WEc1OP_TOTAL == "-") && ($LEED_EBOM_v4_WEp1OP_TOTAL == "" || $LEED_EBOM_v4_WEp1OP_TOTAL == "-") && ($LEED_EBOM_v4_MRc5OP_TOTAL == "" || $LEED_EBOM_v4_MRc5OP_TOTAL == "-")) { echo 'display:none;';  }  ?>">
                            <td  class="first-col" style="font-weight: bold;" colspan="2">
                                LEED EBOM v4 - Existing Buildings
                            <td>
                        </tr>
                             <tr class="line-bottom" style="<?php if ($LEED_EBOM_v4_WEp1OP_TOTAL == "" || $LEED_EBOM_v4_WEp1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                              <td class="first-col">
                                    <span>WEp1: Indoor water use reduction</span>
                                </td>
                                <td>
                                    <span><?php
    if (isset($LEED_EBOM_v4_WEp1OP_TOTAL)) {
        echo $LEED_EBOM_v4_WEp1OP_TOTAL;
    }
    ?></span>
                                </td>
                            </tr>
                             <tr class="line-bottom" style="<?php if ($LEED_EBOM_v4_WEc1OP_TOTAL == "" || $LEED_EBOM_v4_WEc1OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                               <td class="first-col">
                                    <span>WEc1: Indoor water use reduction</span>
                                </td>
                                <td>
                                    <span><?php
                                    if (isset($LEED_EBOM_v4_WEc1OP_TOTAL)) {
                                        echo $LEED_EBOM_v4_WEc1OP_TOTAL;
                                    }
                                    ?></span>
                                </td>
                            </tr>
                              <tr class="line-bottom" style="<?php if ($LEED_EBOM_v4_MRc5OP_TOTAL == "" || $LEED_EBOM_v4_MRc5OP_TOTAL == "-") { echo 'display:none;';  }  ?>">
                            <td class="first-col">
                                <span>MRc5: Indoor water use reduction</span>
                            </td>
                            <td>
                                    <span><?php
                                        if (isset($LEED_EBOM_v4_MRc5OP_TOTAL)) {
                      echo $LEED_EBOM_v4_MRc5OP_TOTAL;  
                                        }
                                        ?></span>
                            </td>
                        </tr>
                                    <?php } ?>
                    </table>
                    <h1 class="overall-heading">PRODUCT ANALYSIS</h1>
                </div>
                 <?php for ($p = 0; $p < count($productDetail); $p++) { ?>
                <?php 
              
                                        if(!empty($productDetail[$p]['product_img'])){
                                            if (strpos($productDetail[$p]['product_img'],'http://') !== false) {
                                               //http://stackoverflow.com/questions/15477232/how-to-check-url-image-is-exist-or-not-in-php
                                                $url = $productDetail[$p]['product_img'];
                                                $ch = curl_init();
                                                curl_setopt($ch, CURLOPT_URL,$url);
                                                // don't download content
                                                curl_setopt($ch, CURLOPT_NOBODY, 1);
                                                curl_setopt($ch, CURLOPT_FAILONERROR, 1);
                                                curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                                                if(curl_exec($ch)!==FALSE){
                                                     $mainImgSrc2 = $productDetail[$p]['product_img'];
                                                }else{
                                                     $mainImgSrc2 = "/images/img_unavailable.png";
                                                }
                                            }else{
                                               $mainImgSrc2 = "/batchUpload/".$productDetail[$p]['product_img'];
                                            }
                                        }else{
                                             $mainImgSrc2 = "/images/img_unavailable.png";
                                        }
                 ?>
                <div class="leed-area"  style="display: none;padding: 10px 0px 10px 0px; margin-bottom: 20px; font-family: PT Sans;">
                    <table>
                        <tr>
                            <td><a><img src="<?php echo $mainImgSrc2;?>" class="col-img" alt=""/></a></td>
                            <td class="lead-heading-main">
                                <h2 class="lead-area-heading-inner"><?php echo $productDetail[$p]['product_brand']; ?></h2>
                                <h2 class="lead-area-heading-inner"><?php echo $productDetail[$p]['product_name']; ?></h2>
                              
                               <?php     foreach ($productDetail[$p]['productAttributes'] as $key => $value) { ?>
                                <a class="leed-area-table-inner-img"><img src="/attributeImages/thumb/<?php echo $value[2]; ?>"  alt=""/></a>
<!--                                <a><img src="/images/frontPanel/man-report.png"  alt=""/></a>-->
                                <?php         }   ?>
                            </td>

                        </tr>
                    </table>
                     <!-- product detail start -->
                 
                                 <div class="view-product-block">
                                    <h3>Show Product Details</h3>
                                </div>
               <div class="product-desc-list-block">
                        <div class="product-desc-list">
                            <?php
                             if(isset($productDetail[$p]['productDetail'])){
//                                 print_r("<pre>");
//                                 print_r($masterAtt);
//                                 print_r("</pre>");
//                                 die;
                                 $masterSubAtt1 = array();
                                   $masterAtt2 = array();
                                    $masterAtt3 = array();
                                    $masterAtt = array();
                                    $masterSubAtt = array();
                                        $masterSubAtt1 = $productDetail[$p]['productDetail'][1]; 
                                        $masterAtt1 = $productDetail[$p]['productDetail'][2];  
                                  
                                  foreach ($masterSubAtt1 as $key1 => $value1) {
                                       if($value1['subatt_name'] != 'List Price Starting At ($)'){
                                           $masterSubAtt[] = $value1;
                                       }
                                  }
                                  //Att <<
                                  foreach ($masterAtt1 as $key2 => $value2) { 
                                       foreach ($masterSubAtt as $k1 => $v1) {
                                            if($value2[0] == $v1['attribute_id']){
                                                $masterAtt2[] = $value2;
                                            }
                                       }
                                  }
                                    $masterAtt3= array_unique($masterAtt2, SORT_REGULAR);
                                    $masterAtt= array_values($masterAtt3);
                                foreach($masterAtt as $key3  => $value3){ ?>
                                    <p>
                                        <span>
                                            <img src="/attributeImages/thumb/<?php echo $value3[2]; ?>" alt="<?php echo $value3[1]; ?>" class="img-responsive"/>
                                        </span>
                                        <span class="<?php //echo "class".strtolower($value3[0]); ?>">
                                            <?php echo $value3[1]; ?>
                                        </span>
                                        </p>
                                        <table border="0" cellpadding="0" cellspacing="0" class="product-desc-list-table-data">
                                            
                                        <?php //echo "<pre>"; print_r($masterSubAtt); die;
                                            foreach($masterSubAtt as $k2 => $v2){ 
                                                if($value3[0] == $v2['attribute_id']){?>
                                                    <tr class="<?php if($k2%2 == 0){ echo "even"; } else { echo "odd"; } ?>">
                                                        <td class="sub-heading-<?php if($k2%2 == 0){ echo "even"; } else { echo "odd"; } ?> divider" width="70%"><?php echo $v2['subatt_name']; ?></td>
    <?php if($v2['short_code'] == 'G_GUARD_LNK' || $v2['short_code'] == 'HPD_LNK' || $v2['short_code'] == 'EPD_LINK' || $v2['short_code'] == 'GRN_CIRC_LINK' || (preg_match('/http/', $v2['value']) && $v2['value'] != "")){?>
                                                                <td width="30%" class="last-td-cell sub-heading-<?php if($k2%2 == 0){ echo "even"; } else { echo "odd"; } ?>" ><a target="_blank" href="<?php if(isset($v2['value'])){echo $v2['value'];}else{"#";} ?>">Link</a></td>
                                                            <?php }else{?>
                                                                <td width="30%" class="last-td-cell sub-heading-<?php if($k2%2 == 0){ echo "even"; } else { echo "odd"; } ?>"><?php if(isset($v2['value'])){echo $v2['value'];} ?><?php if (preg_match('/%/', $v2['subatt_name']) && $v2['value'] != "") { echo "%";  } ?></td>
                                                            <?php }
                                                       ?>
                                                        <!--<td width="30%" class="last-td-cell"><?php //if(isset($v['value'])){echo $v['value'];} ?></td>-->
                                                    </tr>
                                                <?php }
                                            }
                                        ?>
                                            
                                        </table>
                                    
                                    
                                <?php }
                                 
                             }else{ echo "No details found."; ?>
                                  
                             <?php }
                            ?>
                            
                        </div>
                    </div>
                <!-- product detail end -->
                    <table class="leed-area-table loop-table-lead">
                        <?php    $leed = 0;  foreach ($productDetail[$p]['leedCalcsDetail'] as $keyLeed => $valueLeed) {  ?>
                           <?php if($leed == 0){ ?>
                        <tr>
                            <td colspan="2" class="leed-area-table-inner-second-heading"  >
                                <a class="leed-area-table-inner-img" style="display:none;"><img width="36px" height="36px" src="/images/frontPanel/leed.png"  alt=""/></a>
                                <span class="line-bottom lead-inner-second-col">PRODUCT LEED Credit Contribution Summary</span>
                            </td>
                            <!--<td></td>-->
                        </tr>
                        <tr class="line-bottom" style="">
                            <td  class="first-col">
                                <span style="font-weight: bold;font-size: 16px;">Product Cost</span>
                            </td>
                            <td>
                                <span><?php  echo "$".number_format(round(intval($productDetail[$p]['totalProductMaterialCost']))); ?></span>
                            </td>
                        </tr>
                        <?php } ?>
                         <?php   $leedTitle = 0; 
//                         print_r("<pre>");
//                         print_r($productDetail[$p]['leedCalcsDetail'][$keyLeed]);
//                         print_r("</pre>");
//                         
//                         die;
                         
                         foreach ($productDetail[$p]['leedCalcsDetail'][$keyLeed] as $key => $value) {  ?>
                         <?php if($leedTitle == 0){ $className = $key;  ?>
                        <tr class="<?php echo $className; ?>" style="display : none;" >
                            <td class="leed-area-table-inner-second-heading" style="font-weight: bold;">
                                <span class="lead-inner-second-col"><?php $temp = array(); $temp = array_keys($productDetail[$p]['leedCalcsDetail']); echo $temp[$leed]; ?></span>
                            </td>
                            <td></td>
                        
                        </tr>
                         <?php } ?>
                        <?php if(trim($value) != "no" && trim($value) != "" && trim($value) != "-" && trim($value) != "0"  ){ ?> 
                       <style>
                            .<?php  echo $className; ?>{
                                display: block !important;
                            }
                        </style>
                        <?php } ?>
                        <tr class="line-bottom" style="<?php if(trim($value) == "no" || trim($value) == "" || trim($value) == "-" || trim($value) == "0"  ){ echo "display:none;" ;} ?>">
                            <td  class="first-col">
                                <span><?php echo $calcDetail[$key]; ?></span>
                            </td>
                            <td>
                                <span><?php if($value == "no"){ echo "-" ;}else{ if($value != "" && $value != 'contributes'){ echo '$'.number_format(round($value)); }else{ echo $value; } } ?></span>
                            </td>
                        </tr>         
                        <?php    $leedTitle++;    }    ?>
                         <?php    $leed++;     }    ?>
                    </table>
                </div>
                <?php } ?>
                
               
                <div class="analysis-report" style="<?php
                if ($showEnergyChart > 0) {
                    echo "display : block";
                } else {
                    echo "visibility : hidden";
                }
                ?>">
        <h1 class="overall-heading">PROJECT ANALYSIS</h1>
                    <table class="report overallClass">
                        <tr class="heading green-txt">
                            <td style="width: 60%;">Total Project Cost</td>

                            <td class="align-right">$</td>
                        </tr>
                        <tr>
                            <td>Total Project Cost = ($ Selected Products)</td>

                            <td class="align-right"><?php echo number_format(round($Prod_Investment)); ?></td>
                        </tr>               

                        <tr class="heading green-txt">
                            <td style="width: 60%;">Total Project Investment</td>

                            <td class="align-right">$</td>
                        </tr>
                        <tr>
                            <td>Product Cost Investment = ($ Selected Products - $ Baseline Products)</td>

                            <td class="align-right"><?php echo number_format(round($Total_Investment, 2)); ?></td>
                        </tr>

                    </table>

                    <!-- OVERALL SAVINGS TABLE-->
                    <table class="report overallClass">
                        <tr class="heading green-txt">
                            <td style="width: 60%;">Overall Financial Savings</td>

                            <td class="align-right">$</td>
                        </tr>
                        <tr>
                            <td>Monthly</td>

                            <td class="align-right"><?php echo number_format(round($Total_Payaback)); ?></td>
                        </tr>
                        <tr>
                            <td>Yearly</td>

                            <td class="align-right"><?php echo number_format(round(12 * $Total_Payaback)); ?></td>
                        </tr>
                        <tr>
                            <td>Length of Analysis</td>

                            <td class="align-right"><?php
                        $WaterCost = array_sum($sumWaterCost);
                        $EnergyCost = array_sum($sumEnergyCost);
                        $lifeCycleCost = array_sum($sumLifeCycle);

                            echo number_format(round($EnergyCost + $WaterCost + $LOA*12*$allProdLifeCycleCost)); 
                        ?></td>
                        </tr>
                    </table>

                    <!-- ENERGY TABLE-->
<?php if ($allProdEnergyCost > 0 || $allProdEnergy > 0) { ?>
                    
                        <table class="report EnergyClass">
                            <tr class="heading orange-txt">
                                <td>Energy Savings</td>
                                <td class="align-right">kWh</td>
                                <td class="align-right">$</td>
                            </tr>
                            <tr>
                                <td>Monthly</td>
                                <td class="align-right"><?php echo number_format(round($allProdEnergy)); ?></td>
                                <td class="align-right"><?php echo number_format(round($allProdEnergyCost)); ?></td>
                            </tr>
                            <tr>
                                <td>Yearly</td>
                                <td class="align-right"><?php echo number_format(round(12 * $allProdEnergy)); ?></td>
                                <td class="align-right"><?php echo number_format(round(12 * $allProdEnergyCost)); ?></td>
                            </tr>
                            <tr>
                                <td>Length of Analysis</td>
                                <td class="align-right"><?php echo number_format(round(12 * $LOA * $allProdEnergy)); ?></td>
                                <td class="align-right"><?php
                                if ($energy_inflation > 0) {
                                    echo number_format(round($LOA * (array_sum($sumEnergyCost)), 2));
                                } else {
                                    echo number_format(round(LOA * (12 * $allProdEnergyCost), 2));
                                }
                                ?></td>
                            </tr>
                        </table>

                 
<?php } ?>
                    <?php if ($allProdGPM > 0) { ?>
                       <table class="report EnergyClass">
                           <tr style="border:none;" class="heading orange-txt">
                            <td colspan="3">Energy/Water Nexus: <br/>Grid electricity saved by less gallons needed</td>
                            
                        </tr>
                         
                        <tr class="heading orange-txt">
                            <td></td>
                            <td class="align-right">kWh</td>
                            <td class="align-right"></td>
                        </tr>
                        <tr>
                            <td>Monthly</td>
                            <td class="align-right"><?php echo number_format(round($allProdGPM * 0.0037)); ?></td>
                            <td class="align-right"></td>
                        </tr>
                        <tr>
                            <td>Yearly</td>
                            <td class="align-right"><?php echo number_format(round(12 * $allProdGPM * 0.0037)); ?></td>
                            <td class="align-right"></td>
                        </tr>
                        <tr>
                            <td>Length of Analysis</td>
                            <td class="align-right"><?php echo number_format(round(12 * $LOA * $allProdGPM * 0.0037)); ?></td>
                            <td class="align-right"></td>
                        </tr>
                    </table>
<?php } ?>
                    <!-- WATER TABLE-->
<?php //if($allProdCOST > 0 || $allProdGPM > 0) {  ?>
                    <table class="report WaterClass">
                        <tr class="heading blue-txt">
                            <td>Water Savings</td>
                            <td class="align-right">Gallons</td>
                            <td class="align-right">$</td>
                        </tr>
                        <tr>
                            <td>Monthly</td>
                            <td class="align-right"><?php echo number_format(round($allProdGPM)); ?></td>
                            <td class="align-right"><?php echo number_format(round($allProdCOST)); ?></td>
                        </tr>
                        <tr>
                            <td>Yearly</td>
                            <td class="align-right"><?php echo number_format(round(12 * $allProdGPM)); ?></td>
                            <td class="align-right"><?php echo number_format(round(12 * $allProdCOST)); ?></td>
                        </tr>
                        <tr>
                            <td>Length of Analysis</td>
                            <td class="align-right"><?php echo number_format(round(12 * $LOA * $allProdGPM)); ?></td>
                            <td class="align-right"><?php
                    if ($water_inflation > 0) {
                        echo number_format(round(array_sum($sumWaterCost), 2));
                    } else {
                        echo number_format(round($LOA * (12 * $allProdCOST)), 2);
                    }
?></td>
                        </tr>
                    </table>

<?php //}  ?>

                    <!-- LIFE CYCLE TABLE-->
<?php if ($allProdLifeCycleCost > 0 || $allProdLifeCycle > 0) { ?>
                        <table class="report LifecycleClass">
                            <tr class="heading cyan-txt">
                                <td style="width: 60%;">Life Cycle Savings</td>

                                <td class="align-right">$</td>
                            </tr>
                            <tr>
                                <td>Monthly</td>

                                <td class="align-right"><?php echo number_format(round($allProdLifeCycleCost)); ?></td>
                            </tr>
                            <tr>
                                <td>Yearly</td>

                                <td class="align-right"><?php echo number_format(round(12 * $allProdLifeCycleCost)); ?></td>
                            </tr>
                            <tr>
                                <td>Length of Analysis</td>

                                <td class="align-right"><?php echo number_format(round($LOA * 12 * $allProdLifeCycleCost)); ?></td>
                            </tr>
                        </table>

<?php } ?>
                    <!-- first page -->
                  
   <?php 
   ///////////////Energy and Carbon///////////////////////////
   for ($p = 0; $p < count($productDetail); $p++) { ?>
                <?php 
              if((isset($productDetail[$p]['energyCalcsDetail']) && (count($productDetail[$p]['energyCalcsDetail'])) > 0) || (isset($productDetail[$p]['waterCalcsDetail']) && (count($productDetail[$p]['waterCalcsDetail'])) > 0) || (isset($productDetail[$p]['lifecycleCalcsDetail']) && (count($productDetail[$p]['lifecycleCalcsDetail'])) > 0)){
               ?>
  <?php 
                    if($p == 0){?>
<h1 class="overall-heading">PRODUCT ANALYSIS</h1>
                    <?php  } ?>
<?php
                  if(!empty($productDetail[$p]['product_img'])){
                                            if (strpos($productDetail[$p]['product_img'],'http://') !== false) {
                                               //http://stackoverflow.com/questions/15477232/how-to-check-url-image-is-exist-or-not-in-php
                                                $url = $productDetail[$p]['product_img'];
                                                $ch = curl_init();
                                                curl_setopt($ch, CURLOPT_URL,$url);
                                                // don't download content
                                                curl_setopt($ch, CURLOPT_NOBODY, 1);
                                                curl_setopt($ch, CURLOPT_FAILONERROR, 1);
                                                curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                                                if(curl_exec($ch)!==FALSE){
                                                     $mainImgSrc2 = $productDetail[$p]['product_img'];
                                                }else{
                                                     $mainImgSrc2 = "/images/img_unavailable.png";
                                                }
                                            }else{
                                               $mainImgSrc2 = "/batchUpload/".$productDetail[$p]['product_img'];
                                            }
                                        }else{
                                             $mainImgSrc2 = "/images/img_unavailable.png";
                                        }
                 ?>

                <div class="leed-area1"  style="padding: 10px; margin-bottom: 20px; font-family: PT Sans;">
                    <table>
                        <tr>
                            <td><a><img src="<?php echo $mainImgSrc2;?>" class="col-img" alt=""/></a></td>
                            <td class="lead-heading-main">
                                <h2 class="lead-area-heading-inner"><?php echo $productDetail[$p]['product_brand']; ?></h2>
                                <h2 class="lead-area-heading-inner"><?php echo $productDetail[$p]['product_name']; ?></h2>
                              
                               <?php     foreach ($productDetail[$p]['productAttributes'] as $key => $value) { ?>
                                <a class="leed-area-table-inner-img"><img src="/attributeImages/thumb/<?php echo $value[2]; ?>"  alt=""/></a>
<!--                                <a><img src="/images/frontPanel/man-report.png"  alt=""/></a>-->
                                <?php         }   ?>
                            </td>

                        </tr>
                    </table>
                     <!-- product detail start first page -->
        
                                <div class="view-product-block">
                                    <h3>Show Product Details</h3>
                                </div>
               <div class="product-desc-list-block">
                        <div class="product-desc-list">
                            <?php
                             if(isset($productDetail[$p]['productDetail'])){
//                                 print_r("<pre>");
//                                 print_r($masterAtt);
//                                 print_r("</pre>");
//                                 die;
                                 $masterSubAtt1 = array();
                                   $masterAtt2 = array();
                                    $masterAtt3 = array();
                                    $masterAtt = array();
                                    $masterSubAtt = array();
                                        $masterSubAtt1 = $productDetail[$p]['productDetail'][1]; 
                                        $masterAtt1 = $productDetail[$p]['productDetail'][2];  
                                  
                                  foreach ($masterSubAtt1 as $key1 => $value1) {
                                       if($value1['subatt_name'] != 'List Price Starting At ($)'){
                                           $masterSubAtt[] = $value1;
                                       }
                                  }
                                  //Att <<
                                  foreach ($masterAtt1 as $key2 => $value2) { 
                                       foreach ($masterSubAtt as $k1 => $v1) {
                                            if($value2[0] == $v1['attribute_id']){
                                                $masterAtt2[] = $value2;
                                            }
                                       }
                                  }
                                    $masterAtt3= array_unique($masterAtt2, SORT_REGULAR);
                                    $masterAtt= array_values($masterAtt3);
                                foreach($masterAtt as $key3  => $value3){ ?>
                                    <p>
                                        <span>
                                            <img src="/attributeImages/thumb/<?php echo $value3[2]; ?>" alt="<?php echo $value3[1]; ?>" class="img-responsive"/>
                                        </span>
                                        <span class="<?php //echo "class".strtolower($value3[0]); ?>">
                                            <?php echo $value3[1]; ?>
                                        </span>
                                        </p>
                                        <table border="0" cellpadding="0" cellspacing="0" class="product-desc-list-table-data">
                                            
                                        <?php //echo "<pre>"; print_r($masterSubAtt); die;
                                            foreach($masterSubAtt as $k2 => $v2){ 
                                                if($value3[0] == $v2['attribute_id']){?>
                                                    <tr class="<?php if($k2%2 == 0){ echo "even"; } else { echo "odd"; } ?>">
                                                        <td class="sub-heading-<?php if($k2%2 == 0){ echo "even"; } else { echo "odd"; } ?> divider" width="70%"><?php echo $v2['subatt_name']; ?></td>
    <?php if($v2['short_code'] == 'G_GUARD_LNK' || $v2['short_code'] == 'HPD_LNK' || $v2['short_code'] == 'EPD_LINK' || $v2['short_code'] == 'GRN_CIRC_LINK' || (preg_match('/http/', $v2['value']) && $v2['value'] != "")){?>
                                                                <td width="30%" class="last-td-cell sub-heading-<?php if($k2%2 == 0){ echo "even"; } else { echo "odd"; } ?>" ><a target="_blank" href="<?php if(isset($v2['value'])){echo $v2['value'];}else{"#";} ?>">Link</a></td>
                                                            <?php }else{?>
                                                                <td width="30%" class="last-td-cell sub-heading-<?php if($k2%2 == 0){ echo "even"; } else { echo "odd"; } ?>"><?php if(isset($v2['value'])){echo $v2['value'];} ?><?php if (preg_match('/%/', $v2['subatt_name']) && $v2['value'] != "") { echo "%";  } ?></td>
                                                            <?php }
                                                       ?>
                                                        <!--<td width="30%" class="last-td-cell"><?php //if(isset($v['value'])){echo $v['value'];} ?></td>-->
                                                    </tr>
                                                <?php }
                                            }
                                        ?>
                                            
                                        </table>
                                    
                                    
                                <?php }
                                 
                             }else{ echo "No details found."; ?>
                                  
                             <?php }
                            ?>
                            
                        </div>
                    </div>
                <!-- product detail end -->
                    <!-- Energy cals output perticular product start -->
                    <table class="leed-area-table loop-table-lead">
                          <?php   $energy = 0;    foreach ($productDetail[$p]['energyCalcsDetail'] as $key => $value) {   ?>
                        <?php if($energy == 0){ ?> 
                        <tr>
                            <td class="leed-area-table-inner-second-heading" >
                                <a class="leed-area-table-inner-img"><img src="/attributeImages/thumb/th_energyq.png"  alt=""/></a>
                                <span class="line-bottom lead-inner-second-col">Energy & Carbon</span>
                            </td>
                            <td>
                            </td>
                        </tr>
                        <?php } ?>
                        <?php       $energy++;  }    ?>
                    </table>
                   <!-- ENERGY TABLE-->
                                <?php if ($productDetail[$p]['IndividualEnergyCost'] > 0 || $productDetail[$p]['IndividualEnergy'] > 0) { ?>
                        <table class="report EnergyClass">
                            <tr class="heading green-txt">
                                <td>Energy Savings</td>
                                <td class="align-right">kWh</td>
                                <td class="align-right">$</td>
                            </tr>
                            <tr>
                                <td>Monthly</td>
                                <td class="align-right"><?php echo number_format(round($productDetail[$p]['IndividualEnergy'])); ?></td>
                                <td class="align-right"><?php echo number_format(round($productDetail[$p]['IndividualEnergyCost'])); ?></td>
                            </tr>
                            <tr>
                                <td>Yearly</td>
                                <td class="align-right"><?php echo number_format(round(12 * $productDetail[$p]['IndividualEnergy'])); ?></td>
                                <td class="align-right"><?php echo number_format(round(12 * $productDetail[$p]['IndividualEnergyCost'])); ?></td>
                            </tr>
                            <tr>
                                <td>Length of Analysis</td>
                                <td class="align-right"><?php echo number_format(round(12 * $LOA * $productDetail[$p]['IndividualEnergy'])); ?></td>
                                 <td class="align-right"><?php if ($energy_inflation > 0 ) 
                                                    { 
                                                      echo number_format(round((array_sum($sumEnergyCost))));
                                                    }  
                                                    else{
                                                        echo number_format(round($LOA*(12 * $productDetail[$p]['IndividualEnergyCost'])));
                                                    }
                                                    
                                                    ?></td>
                            </tr>
                        </table>
                   
                <?php } ?>
                     <?php if ($productDetail[$p]['IndividualEnergyCarbon'] > 0) { ?>
                   <table class="report EnergyClass">
                            <tr class="heading orange-txt">
                                <td>Carbon Savings</td>
                                <td class="align-right">lbs. CO2 eq</td>
                                <!--td class="align-right">$</td-->
                            </tr>
                            <tr>
                                <td>Monthly</td>
                                <td class="align-right"><?php echo number_format(round($productDetail[$p]['IndividualEnergyCarbon'])); ?></td>
                                <!--td class="align-right"><?php //echo number_format($allProdEnergyCostCarbon, 2); ?></td-->
                            </tr>
                            <tr>
                                <td>Yearly</td>
                                <td class="align-right"><?php echo number_format(round(12 * $productDetail[$p]['IndividualEnergyCarbon'])); ?></td>
                                <!--td class="align-right"><?php //echo number_format(12 * $allProdEnergyCostCarbon, 2); ?></td-->
                            </tr>
                            <tr>
                                <td>Length of Analysis</td>
                                <td class="align-right"><?php echo number_format(round(12 * $LOA * $productDetail[$p]['IndividualEnergyCarbon'])); ?></td>
                                
                            </tr>
                        </table>
                   <?php } ?>
                   <!-- Water TABLE start-->
 <?php if ($productDetail[$p]['IndividualWaterCost'] > 0 || $productDetail[$p]['IndividualWater'] > 0) { ?>
                        <table class="report WaterClass">
                            <tr class="heading blue-txt">
                                <td>Water Savings</td>
                                <td class="align-right">Gallons</td>
                                <td class="align-right">$</td>
                            </tr>
                            <tr>
                                <td>Monthly</td>
                                <td class="align-right"><?php echo number_format(round($productDetail[$p]['IndividualWater'])); ?></td>
                                <td class="align-right"><?php echo number_format(round($productDetail[$p]['IndividualWaterCost'])); ?></td>
                            </tr>
                            <tr>
                                <td>Yearly</td>
                                <td class="align-right"><?php echo number_format(round(12 * $productDetail[$p]['IndividualWater'])); ?></td>
                                <td class="align-right"><?php echo number_format(round(12 * $productDetail[$p]['IndividualWaterCost'])); ?></td>
                            </tr>
                            <tr>
                                <td>Length of Analysis</td>
                                <td class="align-right"><?php $sumWaterindCost =0; $waterPBIND = 0; echo number_format(round(12 * $LOA * $productDetail[$p]['IndividualWater'])); ?></td>
                                 <td class="align-right"><?php if ($water_inflation > 0 ) 
                                                    { 
                                    $waterPBIND = $productDetail[$p]['IndividualWaterCost'];
                                   // print_r($productDetail[$p]['IndividualWaterCost']);
                                for ($y = 0; $y < $LOA; $y++) {
                           //$projectDetail['water_rate']\
                               //echo "<br> WPB yr:".$y+1; echo "<br>PB".$waterPB."||";
                               $waterPBIND = $waterPBIND * (1 + $water_inflation);
                               // echo "<pre>"; print_r($waterPBIND);
                               $sumWaterindCost = $sumWaterindCost+ $waterPBIND * 12;
                               //echo "<pre>"; print_r($sumWaterindCost);
                              
                           }
                          
                                                      echo number_format(round(($sumWaterindCost)));
                                                    }  
                                                    else{
                                                        echo number_format(round($LOA*(12 * $productDetail[$p]['IndividualWaterCost'])));
                                                    }
                                                    
                                                    ?></td>
                            </tr>
                        </table>
                   
                <?php } ?>
                   <?php if ($productDetail[$p]['IndividualLifecycleCost'] > 0 || $productDetail[$p]['IndividualLifecycle'] > 0) { 
                       
                       
                       ?>
                        <table class="report LifecycleClass">
                            <tr class="heading cyan-txt">
                                <td>Life Cycle Savings</td>
                                <td class="align-right"></td>
                                <td class="align-right">$</td>
                            </tr>
                            <tr>
                                <td>Monthly</td>
                                <td class="align-right"></td>
                                <td class="align-right"><?php echo number_format(round(array_sum($productDetail[$p]['IndividualLifecycleCost']))); ?></td>
                            </tr>
                            <tr>
                                <td>Yearly</td>
                                <td class="align-right"></td>
                                <td class="align-right"><?php echo number_format(round(12 * array_sum($productDetail[$p]['IndividualLifecycleCost']))); ?></td>
                            </tr>
                            <tr>
                                <td>Length of Analysis</td>
                                <td class="align-right"></td>
                                 <td class="align-right"><?php if ($lifecycle_inflation > 0 ) 
                                                    { 
                                                      echo number_format(round((array_sum($sumLifeCycle))));
                                                    }  
                                                    else{
                                                        echo number_format(round($LOA*(12 * array_sum($productDetail[$p]['IndividualLifecycleCost']))));
                                                    }
                                                    
                                                    ?></td>
                            </tr>
                        </table>
                   
                <?php } ?>
                </div>
              <?php } } ?>
                </div>
            </div>

            <span style='display: table;margin: 20px auto;'>
                <a  style="margin: 0 4px 0 0; float: left; text-decoration: none;" href="/product-config/index/pid/<?php echo $this->pid; ?>"><div class="gray-button">BACK</div></a>
<?php if ($sessUser->fname == 'Dummy') { ?>
                    <a style="margin: 0 4px 0 0; float: left; text-decoration: none;" href="/login/account"><div class="gray-button">SAVE</div></a>
<?php } else { ?>
                    <a style="margin: 0 4px 0 0; float: left; text-decoration: none;" href="/payback-analysis/savepayback/pid/<?php echo $this->pid; ?>/savings/<?php echo 12 * $LOA * $Total_Payaback; ?>/energy/<?php echo 12 * $LOA * $allProdEnergy; ?>/water/<?php echo 12 * $LOA * $allProdGPM; ?> "><div class="gray-button">SAVE</div></a>
<?php }
?>
                <a><img src="/images/next_inactive.png"/></a>
            </span>
        </div>
        <div class="desk-side-bar" style="margin: 0;">
            <h2>Lorem <span>Ipsum</span></h2>
            <div>
                <a><img src="/images/frontPanel/sidebar-img1.jpg" alt="sidebar" class="img-responsive" /></a>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus ullamcorper augue eget ante faucibus aliquam. Nam sit amet commodo mauris. Donec sapien ligula, interdum et cursus luctus, bibend um in felis. Fusce bibendum fringilla risus ut eleifend. Sed egestas quam at dolor aliquet eget porta sapien lacinia.</p>
            </div>
            <div>
                <a><img src="/images/frontPanel/sidebar-img2.jpg" alt="sidebar" class="img-responsive" /></a>
            </div>
        </div>

    </div>
</div>

<script>
            $(function () {

            var data = [{
            y: 70,
                    color: '#c40044'}];
                    data.push({
                    y: 100 - data[0].y,
                            color: '#fff',
                            id: 'dummy'
                    });
                    // --------------- HIGHCHARTS------------
                    $('#container').highcharts({
            chart: {
            type: 'column'
            },
                    title: {
                    text: 'Combined Cumulative Cash Flow Chart'
                    },
                    yAxis:{

//            min: -100,
//            max: 100,
//            tickInterval: 800,

                    title: {
                    text: '$',
                     rotation:180
                    }
                    },
                    xAxis: {
                        title: {
                    text: 'Years'
                    },
                    categories: [<?php
for ($i = 0; $i <= $LOA; $i++) {
    echo "'$i'" . ",";
}
?>]
//                labels: {
//                rotation: 270,
//                y:40
//                
//            }

                    },
                    credits: {
                    enabled: false
                    },
                    legend : {
                    enabled: false
                    },
                    exporting: {
                    enabled: false
                    },
                    tooltip: {
                    formatter: function() {
                    if (this.series.name == 'Human' || this.series.name == 'Planet')
                    {
                    //console.log(this.series.data[0].name+"-"+this.series.data[0].y);
                    if (this.series.data[0].y != 0){

                    return this.y + '%';
                    }
                    else{
                    return '0%';
                    }
                    }

                    else{ return '$' + Math.round(this.y); }
                    }
                    },
                    plotOptions: {

                    pie: {
                    allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                            enabled: false,
                                    style: {
                                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || '#000'
                                    }
                            }
                    }
                    },
                    series: [ { // Combo
                    data: [<?php
$combo = -$Total_Investment;
$waterPBcost = $allProdCOST;
$energyPBcost = $allProdEnergyCost;
$lifecyclePBCost = $allProdLifeCycleCost;

for ($i = 0; $i <= $LOA; $i++) {
    if ($i != 0) {
        $waterPBcost = $waterPBcost * (1 + $water_inflation);
        $energyPBcost = $energyPBcost * (1 + $energy_inflation);
        $lifecyclePBCost = ($lifecyclePBCost);

        //for($k=0;$k<=12;$k++){ 
        $combo = $combo + ($energyPBcost * 12 + $waterPBcost * 12 + $lifecyclePBCost * 12);

        //}
        ?>
                            {y:<?php echo $combo; ?>, color:'#8CC63F'},
    <?php } else {
        ?>

                            {y:<?php echo $combo; ?>, color:'#8CC63F'},
    <?php }
}
?>
                    ]                   },
                    { // Energy

                    data: [<?php
$energy = -$Total_Investment;
$energyPBcost = $allProdEnergyCost;
if ($energyPBcost > 0) {
    for ($i = 0; $i <= $LOA; $i++) {
        if ($i != 0) {
            $energyPBcost = $energyPBcost * (1 + $energy_inflation);

            for ($k = 0; $k < 12; $k++) {
                $energy = $energy + $energyPBcost;
            }
            ?>
                                {y:<?php echo $energy; ?>, color:'#f7931e'},
        <?php } else {
            ?>

                                {y:<?php echo $energy; ?>, color:'#f7931e'},
        <?php
        }
    }
}
?>
                    ]
                    },
                    { // Water 
                    data: [<?php
$water = -$Total_Investment;
$waterPBcost = $allProdCOST;
if ($allProdCOST > 0) {
    for ($i = 0; $i <= $LOA; $i++) {
        if ($i != 0) {
            $waterPBcost = $waterPBcost * (1 + $water_inflation);

            for ($k = 0; $k < 12; $k++) {
                $water = $water + $waterPBcost;
            }
            ?>
                                {y:<?php echo $water; ?>, color:'#29ABE2'},
        <?php
        } else {
            ?>
                                {y:<?php echo $water; ?>, color:'#29ABE2'},
        <?php
        }
    }
}
?>
                    ]
                    },
                    { // LifeCycle
                    data: [<?php
$lc = -$Total_Investment;
$lifecyclePBCost = $allProdLifeCycleCost;

if ($allProdLifeCycleCost > 0) {
    for ($i = 0; $i <= $LOA; $i++) {
        if ($i != 0) {
            $lifecyclePBCost = $lifecyclePBCost;
            for ($k = 0; $k < 12; $k++) {
                $lc = $lc + $lifecyclePBCost;
            }
            ?>
                                {y:<?php echo $lc; ?>, color:'#46BAB1'},
        <?php
        } else {
            ?>
                                {y:<?php echo $lc; ?>, color:'#46BAB1'},
            <?php
        }
    }
}
?>
                    ]
                    },
                    {
                    type: 'pie',
                            name: 'Human',
                            data: [ {
                            name: 'humanYes',
                                    y: <?php echo $totalHumanYes; ?>,
                                    color: '#c40044'
                            }, {name: 'humanNo',
                                    y: <?php echo $totalHumanNo; ?>,
                                    color: '#ccc'}],
                            size: 150
                    }, {
                    type: 'pie',
                            name: 'Planet',
                            data: [{
                            name: 'planetYes',
                                    y: <?php echo $totalPlanetYes; ?>,
                                    color: '#662d91'

                            },
                            {
                            name: 'planetNo',
                                    y: <?php echo $totalPlanetNo; ?>,
                                    color: '#ccc'
                            }
                            ],
                            size: 150
                    }]

            });
                    // TOGGLE GRAPH BARS
                    var chart = $('#container').highcharts();
                    chart.series[1].hide();
                    chart.series[2].hide();
                    chart.series[3].hide();
                    chart.series[4].hide();
                    chart.series[5].hide();
                    $('#overall').click(function() {
            $('.counter-month').show();
                    $('.leed-area').hide();
                    $('.analysis-area').show();
                    $('.analysis-counter').show();
                    $('.counter-area').show();
                    $('.counter-label').show();
                    $('.analysis-report').show();
                    $('.boxreport').show();
                    chart.setTitle({text: "Combined Cumulative Cash Flow Chart"});
                    chart.series[0].show();
                    chart.series[1].hide();
                    chart.series[2].hide();
                    chart.series[3].hide();
                    chart.series[4].hide();
                    chart.series[5].hide();
            });
                    $('#Energy').click(function() {
            $('.leed-area').hide();
                    $('.analysis-report').show();
                    $('.analysis-area').show();
                    $('.analysis-counter').show();
                    $('.counter-month').hide();
                    $('.counter-area').show();
                    $('.counter-label').show();
                    $('.analysis-report').show();
                    $('.boxreport').show();
                    chart.setTitle({text: "Energy Cumulative Cash Flow Chart"});
                    chart.series[0].hide('slow');
                    chart.series[1].show();
                    chart.series[2].hide();
                    chart.series[3].hide();
                    chart.series[4].hide();
                    chart.series[5].hide();
            });
                    $('#Water').click(function() {
            $('.leed-area').hide();
                    $('.analysis-area').show();
                    $('.analysis-counter').show();
                    $('.counter-month').hide();
                    $('.counter-area').show();
                    $('.counter-label').show();
                    $('.analysis-report').show();
                    $('.boxreport').show();
                    chart.setTitle({text: "Water Cumulative Cash Flow Chart"});
                    chart.series[0].hide();
                    chart.series[1].hide();
                    chart.series[2].show();
                    chart.series[3].hide();
                    chart.series[4].hide();
                    chart.series[5].hide();
            });
                    $('#Lifecycle').click(function() {
            $('.leed-area').hide();
                    $('.analysis-area').show();
                    $('.analysis-counter').show();
                    $('.counter-month').hide();
                    $('.counter-area').show();
                    $('.counter-label').show();
                    $('.analysis-report').show();
                    $('.boxreport').show();
                    chart.setTitle({text: "Lifecycle Cumulative Cash Flow Chart"});
                    chart.series[0].hide();
                    chart.series[1].hide();
                    chart.series[2].hide();
                    chart.series[3].show();
                    chart.series[4].hide();
                    chart.series[5].hide();
            });
                    $('#Human').click(function() {
            $('.leed-area').hide();
                    $('.analysis-area').show();
                    $('.analysis-counter').show();
                    $('.counter-month').hide();
                    $('.counter-area').show();
                    $('.counter-label').show();
                    $('.analysis-report').show();
                    $('.boxreport').show();
                    chart.setTitle({text: "Human Health Product Contribution/Compliance"});
                    chart.series[0].hide('slow');
                    chart.series[1].hide();
                    chart.series[2].hide();
                    chart.series[3].hide();
                    chart.series[4].show();
                    chart.series[5].hide();
            });
                    $('#Planet').click(function() {
                    $('.leed-area').hide();
                    $('.analysis-area').show();
                    $('.analysis-counter').show();
                    $('.counter-month').hide();
                    $('.counter-area').show();
                    $('.counter-label').show();
                    $('.analysis-report').show();
                    $('.boxreport').show();
                    chart.setTitle({text: "Planet Health Product Contribution/Compliance"});
                    chart.series[0].hide('slow');
                    chart.series[1].hide();
                    chart.series[2].hide();
                    chart.series[3].hide();
                    chart.series[4].hide();
                    chart.series[5].show();
            });
                    $('#Leed').click(function() {
                    $('.leed-area').show();
                    $('.analysis-report').hide();
                    $('.leed-area-table').show();
                    $('.analysis-area').hide();
                    $('.analysis-area').hide();
                    $('.boxreport').hide();
                    
                   // $('.analysis-counter').hide();
            });
                    // ---------------TOGGLE JQUERY------------

                    $('.attIcons').click(function(){

            $('*').removeClass('selected');
                    $(this).addClass('selected');
                    var aid = $(this).attr('id');
                    // $('table').hide();
                    $('.report').hide();
                    $('.boxreport').hide();
                    if (aid == 'overall'){
                         $('.boxreport').show();
            $('.report').show();
            }
            else{
            $("." + aid + "Class").show();
            }
            });
        });</script>
<?php if ($showEnergyChart <= 0) { ?>
    <script>

//                $('.leed-area').show();
//                $('.leed-area-table').show();
//                $('.analysis-area').hide();
//                $('.analysis-counter').hide();
//                $('.analysis-report').hide();
    </script>
    <?php
}
?>
<style>
    .gray-button{
        background:none repeat scroll 0 0 #8c8c8c;
        cursor:pointer;  
        border:none !important;
        height: 26px;
        width: 92px !important;
        border-radius: 0 !important;
        color : #fff;   
        font-family: "Gotham SSm A","Gotham SSm B";
        font-size: 18px;
        text-align: center;
    }
</style>

   <script>
        $('.product-desc-list-block').hide();
        var count = 1;
        $('.view-product-block').click(function(){
            if(count==1)
            {
                $(this).html('<h3>Hide Product Details</h3>');
                count = 0;
            }
            else
            {
                count =1;
                $(this).html('<h3>Show Product Details</h3>');
            } 
            $(this).parent().find('.product-desc-list-block').slideToggle(); 
        });
   </script>